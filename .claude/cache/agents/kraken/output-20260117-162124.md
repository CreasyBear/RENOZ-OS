# Implementation Report: Activities/Timeline/Communications Consolidation Analysis

Generated: 2026-01-17T16:21:24

## Task

Analyze and document the overlap between Activities (DOM-ACTIVITIES), Timeline (CROSS-TIMELINE), and Communications (DOM-COMMS) domains, then create a consolidation recommendation.

## Summary

Created comprehensive consolidation analysis documenting significant overlap between three PRDs that all deal with activity logging and timeline display. The analysis recommends Option A: consolidating UI and retrieval responsibilities into CROSS-TIMELINE while keeping DOM-ACTIVITIES as the foundational audit schema.

## Files Created

### 1. Consolidation Analysis Document
**Path:** `/Users/joelchan/Documents/Coding/App-Dev/live/renoz-crm-tanstack/continuous-claude/renoz-v3/_Initiation/_meta/consolidation-activities.md`

**Contents:**
- Current State documentation for all three domains
- Story listings and purposes
- Schema creates/requires for each domain
- Overlap matrix showing duplications
- Two consolidation options with recommendations
- Action items for implementation
- Story mapping for approved consolidation
- Risk assessment
- Schema comparison appendix

### 2. Deprecation Notice Added
**Path:** `/Users/joelchan/Documents/Coding/App-Dev/live/renoz-crm-tanstack/continuous-claude/renoz-v3/_Initiation/_prd/2-domains/activities/PROMPT.md`

**Changes:** Added consolidation warning at top of file with:
- List of potentially deprecated stories
- List of stories to keep
- Reference to consolidation document

## Key Findings

### HIGH Duplication (Same Functionality, Different Domains)

| Pair | Concern |
|------|---------|
| ACTIVITY-FEED-UI vs CROSS-TIMELINE-004 | Activity feed UI component |
| ACTIVITY-TIMELINE-UI vs CROSS-TIMELINE-006 | Entity timeline display |
| COMMS-AUTO-001 vs CROSS-TIMELINE-003 | Email-to-activity creation |
| COMMS-AUTO-003 vs CROSS-TIMELINE-005 | Quick log UI (calls/notes) |

### Recommended Architecture

```
Layer 1: DOM-ACTIVITIES
         - ACTIVITY-CORE-SCHEMA (activities table)
         - ACTIVITY-LOGGING-API (Drizzle hooks only)
              |
              v
Layer 2: CROSS-TIMELINE (owns all activity UI and retrieval)
         - unified_activities table
         - All timeline components
         - Quick action logging
         - Customer 360 integration
              ^
              |
Layer 3: DOM-COMMS (creates activities via CROSS-TIMELINE API)
         - Email-specific features
         - Call scheduling
         - Templates and signatures
```

## Action Items Created

### Immediate
- [ ] Decision: Approve Option A or Option B
- [ ] Deprecate DOM-ACTIVITIES UI stories
- [ ] Update CROSS-TIMELINE dependencies
- [ ] Remove duplicate stories from DOM-COMMS
- [ ] Add source tracking to CROSS-TIMELINE schema

### Before Implementation
- [ ] Complete DOM-ACTIVITIES ACTIVITY-CORE-SCHEMA first
- [ ] Update domain PRDs referencing activities

## Notes

- Both `activities` and `unified_activities` tables should exist (different purposes)
- `activities`: Raw audit log (compliance, debugging, ipAddress/userAgent)
- `unified_activities`: CRM view (customerId denormalized, rich activityType, title/description)
- CROSS-TIMELINE-007 should be created for Activity Analytics Dashboard (moved from DOM-ACTIVITIES)
- COMMS-AUTO-002 (source tracking) is valuable and should be incorporated into CROSS-TIMELINE-001 schema

## Verification

- [x] Consolidation document created at `_meta/consolidation-activities.md`
- [x] Deprecation notice added to `activities/PROMPT.md`
- [x] All three PRDs analyzed (activities.prd.json, timeline.prd.json, communications.prd.json)
- [x] Overlap matrix documented
- [x] Specific story-to-story mappings provided
- [x] Action items with clear owners defined
