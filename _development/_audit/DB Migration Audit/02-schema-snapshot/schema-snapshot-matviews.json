[{"materialized_views":[{"schema":"public","name":"mv_current_state","ispopulated":true,"definition":" WITH orgs AS (\n         SELECT orders.organization_id\n           FROM orders\n        UNION\n         SELECT opportunities.organization_id\n           FROM opportunities\n        UNION\n         SELECT job_assignments.organization_id\n           FROM job_assignments\n        UNION\n         SELECT issues.organization_id\n           FROM issues\n        UNION\n         SELECT warranty_claims.organization_id\n           FROM warranty_claims\n        ), orders_open AS (\n         SELECT orders.organization_id,\n            (count(*))::integer AS open_orders\n           FROM orders\n          WHERE ((orders.deleted_at IS NULL) AND (orders.status <> ALL (ARRAY['delivered'::order_status, 'cancelled'::order_status])))\n          GROUP BY orders.organization_id\n        ), opportunities_open AS (\n         SELECT opportunities.organization_id,\n            (count(*))::integer AS open_opportunities\n           FROM opportunities\n          WHERE ((opportunities.deleted_at IS NULL) AND (opportunities.stage <> ALL (ARRAY['won'::opportunity_stage, 'lost'::opportunity_stage])))\n          GROUP BY opportunities.organization_id\n        ), jobs_open AS (\n         SELECT job_assignments.organization_id,\n            (count(*))::integer AS open_jobs\n           FROM job_assignments\n          WHERE (job_assignments.status = ANY (ARRAY['scheduled'::job_assignment_status, 'in_progress'::job_assignment_status, 'on_hold'::job_assignment_status]))\n          GROUP BY job_assignments.organization_id\n        ), issues_open AS (\n         SELECT issues.organization_id,\n            (count(*))::integer AS open_issues\n           FROM issues\n          WHERE ((issues.deleted_at IS NULL) AND (issues.status = ANY (ARRAY['open'::issue_status, 'in_progress'::issue_status, 'on_hold'::issue_status])))\n          GROUP BY issues.organization_id\n        ), claims_open AS (\n         SELECT warranty_claims.organization_id,\n            (count(*))::integer AS open_claims\n           FROM warranty_claims\n          WHERE (warranty_claims.status = ANY (ARRAY['submitted'::warranty_claim_status, 'under_review'::warranty_claim_status, 'approved'::warranty_claim_status]))\n          GROUP BY warranty_claims.organization_id\n        )\n SELECT orgs.organization_id,\n    CURRENT_DATE AS as_of_date,\n    COALESCE(o.open_orders, 0) AS open_orders,\n    COALESCE(op.open_opportunities, 0) AS open_opportunities,\n    COALESCE(j.open_jobs, 0) AS open_jobs,\n    COALESCE(i.open_issues, 0) AS open_issues,\n    COALESCE(c.open_claims, 0) AS open_warranty_claims\n   FROM (((((orgs\n     LEFT JOIN orders_open o ON ((o.organization_id = orgs.organization_id)))\n     LEFT JOIN opportunities_open op ON ((op.organization_id = orgs.organization_id)))\n     LEFT JOIN jobs_open j ON ((j.organization_id = orgs.organization_id)))\n     LEFT JOIN issues_open i ON ((i.organization_id = orgs.organization_id)))\n     LEFT JOIN claims_open c ON ((c.organization_id = orgs.organization_id)));"},{"schema":"public","name":"mv_daily_jobs","ispopulated":true,"definition":" SELECT organization_id,\\n    scheduled_date AS day,\\n    (count(*))::integer AS total_jobs,\\n    (sum(\\n        CASE\\n            WHEN (status = 'completed'::job_assignment_status) THEN 1\\n            ELSE 0\\n        END))::integer AS completed_jobs,\\n    (sum(\\n        CASE\\n            WHEN (status = 'cancelled'::job_assignment_status) THEN 1\\n            ELSE 0\\n        END))::integer AS cancelled_jobs,\\n    (sum(\\n        CASE\\n            WHEN (status = 'in_progress'::job_assignment_status) THEN 1\\n            ELSE 0\\n        END))::integer AS in_progress_jobs,\\n    (sum(\\n        CASE\\n            WHEN (status = 'on_hold'::job_assignment_status) THEN 1\\n            ELSE 0\\n        END))::integer AS on_hold_jobs\\n   FROM job_assignments\\n  GROUP BY organization_id, scheduled_date;"},{"schema":"public","name":"mv_daily_metrics","ispopulated":true,"definition":" WITH days AS (\\n         SELECT orders.organization_id,\\n            orders.order_date AS day\\n           FROM orders\\n        UNION\\n         SELECT opportunities.organization_id,\\n            (opportunities.created_at)::date AS day\\n           FROM opportunities\\n          WHERE (opportunities.deleted_at IS NULL)\\n        UNION\\n         SELECT issues.organization_id,\\n            (issues.created_at)::date AS day\\n           FROM issues\\n          WHERE (issues.deleted_at IS NULL)\\n        UNION\\n         SELECT customers.organization_id,\\n            (customers.created_at)::date AS day\\n           FROM customers\\n          WHERE (customers.deleted_at IS NULL)\\n        ), orders_agg AS (\\n         SELECT orders.organization_id,\\n            orders.order_date AS day,\\n            (count(*))::integer AS orders_count,\\n            COALESCE(sum(orders.total), (0)::numeric) AS orders_total,\\n            COALESCE(sum(orders.tax_amount), (0)::numeric) AS tax_total\\n           FROM orders\\n          WHERE (orders.deleted_at IS NULL)\\n          GROUP BY orders.organization_id, orders.order_date\\n        ), opps_agg AS (\\n         SELECT opportunities.organization_id,\\n            (opportunities.created_at)::date AS day,\\n            (count(*))::integer AS opportunities_count,\\n            COALESCE(sum(opportunities.value), (0)::numeric) AS opportunities_value,\\n            COALESCE(sum(opportunities.weighted_value), (0)::numeric) AS opportunities_weighted\\n           FROM opportunities\\n          WHERE (opportunities.deleted_at IS NULL)\\n          GROUP BY opportunities.organization_id, ((opportunities.created_at)::date)\\n        ), issues_agg AS (\\n         SELECT issues.organization_id,\\n            (issues.created_at)::date AS day,\\n            (count(*))::integer AS issues_count\\n           FROM issues\\n          WHERE (issues.deleted_at IS NULL)\\n          GROUP BY issues.organization_id, ((issues.created_at)::date)\\n        ), customers_agg AS (\\n         SELECT customers.organization_id,\\n            (customers.created_at)::date AS day,\\n            (count(*))::integer AS customers_count\\n           FROM customers\\n          WHERE (customers.deleted_at IS NULL)\\n          GROUP BY customers.organization_id, ((customers.created_at)::date)\\n        )\\n SELECT d.organization_id,\\n    d.day,\\n    COALESCE(o.orders_count, 0) AS orders_count,\\n    COALESCE(o.orders_total, (0)::numeric) AS orders_total,\\n    COALESCE(o.tax_total, (0)::numeric) AS tax_total,\\n    COALESCE(op.opportunities_count, 0) AS opportunities_count,\\n    COALESCE(op.opportunities_value, (0)::numeric) AS opportunities_value,\\n    COALESCE(op.opportunities_weighted, (0)::numeric) AS opportunities_weighted,\\n    COALESCE(i.issues_count, 0) AS issues_count,\\n    COALESCE(c.customers_count, 0) AS customers_count\\n   FROM ((((days d\\n     LEFT JOIN orders_agg o ON (((o.organization_id = d.organization_id) AND (o.day = d.day))))\\n     LEFT JOIN opps_agg op ON (((op.organization_id = d.organization_id) AND (op.day = d.day))))\\n     LEFT JOIN issues_agg i ON (((i.organization_id = d.organization_id) AND (i.day = d.day))))\\n     LEFT JOIN customers_agg c ON (((c.organization_id = d.organization_id) AND (c.day = d.day))));"},{"schema":"public","name":"mv_daily_pipeline","ispopulated":true,"definition":" SELECT organization_id,\\n    (created_at)::date AS day,\\n    stage,\\n    (count(*))::integer AS opportunities_count,\\n    COALESCE(sum(value), (0)::numeric) AS total_value,\\n    COALESCE(sum(weighted_value), (0)::numeric) AS weighted_value\\n   FROM opportunities\\n  WHERE (deleted_at IS NULL)\\n  GROUP BY organization_id, ((created_at)::date), stage;"},{"schema":"public","name":"mv_daily_warranty","ispopulated":true,"definition":" SELECT organization_id,\\n    (submitted_at)::date AS day,\\n    (count(*))::integer AS total_claims,\\n    (sum(\\n        CASE\\n            WHEN (status = 'submitted'::warranty_claim_status) THEN 1\\n            ELSE 0\\n        END))::integer AS submitted_claims,\\n    (sum(\\n        CASE\\n            WHEN (status = 'under_review'::warranty_claim_status) THEN 1\\n            ELSE 0\\n        END))::integer AS under_review_claims,\\n    (sum(\\n        CASE\\n            WHEN (status = 'approved'::warranty_claim_status) THEN 1\\n            ELSE 0\\n        END))::integer AS approved_claims,\\n    (sum(\\n        CASE\\n            WHEN (status = 'denied'::warranty_claim_status) THEN 1\\n            ELSE 0\\n        END))::integer AS denied_claims,\\n    (sum(\\n        CASE\\n            WHEN (status = 'resolved'::warranty_claim_status) THEN 1\\n            ELSE 0\\n        END))::integer AS resolved_claims\\n   FROM warranty_claims\\n  GROUP BY organization_id, ((submitted_at)::date);"}]}]
