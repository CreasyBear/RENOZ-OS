{
  "id": "WF-FULFILLMENT",
  "name": "Order Fulfillment Workflow",
  "description": "Complete fulfillment process from order confirmation through delivery. Coordinates inventory, warehouse operations, and shipping.",
  "created": "2026-01-09",
  "priority": 2,
  "phase": "workflow",
  "dependencies": {
    "phase": "Workflow",
    "executionOrder": 2,
    "schemaRequired": [
      {
        "table": "orders",
        "status": "EXISTS"
      },
      {
        "table": "products",
        "status": "EXISTS"
      },
      {
        "table": "customers",
        "status": "EXISTS"
      },
      {
        "table": "notifications",
        "status": "EXISTS"
      }
    ],
    "schemaCreates": [],
    "serverFunctionsRequired": [
      {
        "function": "listOrders",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "getOrder",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "updateOrderStatus",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "allocateStock",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "deallocateStock",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "shipOrder",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "reportShortPick",
        "status": "EXISTS",
        "domain": "DOM-ORDERS"
      },
      {
        "function": "getInventoryByProduct",
        "status": "EXISTS",
        "domain": "DOM-INVENTORY"
      }
    ],
    "serverFunctionsCreates": [
      {
        "function": "getFulfillmentQueue",
        "story": "WF-FF-001"
      },
      {
        "function": "autoAllocateOnConfirmation",
        "story": "WF-FF-002"
      },
      {
        "function": "confirmPick",
        "story": "WF-FF-003"
      },
      {
        "function": "recordPackageDetails",
        "story": "WF-FF-004"
      },
      {
        "function": "getFulfillmentMetrics",
        "story": "WF-FF-006a"
      },
      {
        "function": "getPickAccuracy",
        "story": "WF-FF-006a"
      },
      {
        "function": "getOnTimeShippingRate",
        "story": "WF-FF-006a"
      }
    ],
    "prdDependencies": [
      {
        "prdId": "DOM-ORDERS",
        "status": "REQUIRED",
        "reason": "Core order management and status workflow"
      },
      {
        "prdId": "DOM-INVENTORY",
        "status": "REQUIRED",
        "reason": "Stock allocation and tracking"
      },
      {
        "prdId": "DOM-PRODUCTS",
        "status": "REQUIRED",
        "reason": "Product data for pick lists"
      }
    ],
    "enables": []
  },
  "domains_involved": [
    "orders",
    "inventory",
    "products"
  ],
  "references": {
    "internal": [
      "memory-bank/prd/domain/orders.prd.json",
      "memory-bank/prd/domain/inventory.prd.json"
    ]
  },
  "workflow_stages": [
    "Order Confirmed -> Allocate Stock -> Pick Items -> Pack Order -> Ship -> Deliver"
  ],
  "current_state": {
    "implemented": [
      "Complete status progression (pending_fulfillment -> ready_to_pick -> picking -> ready_to_ship -> shipped -> delivered)",
      "FIFO stock allocation with serial number support",
      "Pick list PDF sorted by bin location",
      "Batch pick dialog for multiple orders",
      "Packing slip PDF generation",
      "Ship order dialog with carrier/tracking",
      "Order list metrics by status",
      "Short pick handling"
    ],
    "gaps": [
      "No dedicated /fulfillment route (Kanban-style)",
      "No priority ordering in queue",
      "No auto-allocation on order confirmation",
      "No package/box details recording",
      "No fulfillment metrics dashboard"
    ]
  },
  "stories": [
    {
      "id": "WF-FF-001",
      "name": "Create Fulfillment Queue",
      "description": "Centralized view of orders to fulfill with Kanban-style layout",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Fulfillment queue page for warehouse team",
        "Queue organized by status: to allocate, to pick, to ship",
        "Priority ordering: ship date, customer priority",
        "Bulk actions: allocate selected, assign picker",
        "Quick filters: today's shipments, priority, backorders",
        "Real-time updates as status changes",
        "Kanban board visualization with drag-and-drop between columns",
        "Column headers showing count per status",
        "Progress indicator showing overall fulfillment pipeline health",
        "Toast notifications on bulk action completion",
        "Confirmation dialog before bulk status changes",
        "Loading skeleton while queue data loads",
        "Error state with retry for failed operations",
        "Responsive: horizontal scroll on mobile, full board on desktop",
        "Breakpoints: mobile (<640px stacked), tablet (640-1024px scroll), desktop (>1024px full)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-ORD-007"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_FF_001_COMPLETE",
      "ui_spec": {
        "component_type": "KanbanBoard",
        "workflow_visualization": "Multi-column Kanban with status lanes and card counts per column",
        "accessibility": {
          "drag_drop_alternative": "Keyboard-accessible move menu on each card",
          "aria_live_regions": "Column counts and card moves announced",
          "focus_management": "Focus follows card on move",
          "keyboard_navigation": "Arrow keys to navigate cards, Enter to open actions"
        }
      }
    },
    {
      "id": "WF-FF-002",
      "name": "Add Automated Stock Allocation",
      "description": "Auto-allocate stock when order confirmed",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Auto-allocate on order confirmation (if stock available)",
        "FIFO allocation for non-serialized (already exists)",
        "Serial number reservation for serialized (already exists)",
        "Partial allocation if insufficient stock (already exists)",
        "Notification if allocation fails",
        "Manual allocation override option (already exists)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-INV-004"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_FF_002_COMPLETE"
    },
    {
      "id": "WF-FF-003",
      "name": "Add Optimized Pick Lists",
      "description": "Generate pick lists optimized for efficiency (enhancement)",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Pick list sorted by warehouse location (already exists)",
        "Combine multiple orders if same picker (already exists)",
        "Print pick list PDF (already exists)",
        "Mobile-friendly pick list view (already exists)",
        "Pick confirmation with scan/tap",
        "Shortage handling during picking (already exists)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-ORD-008",
        "DOM-INV-002"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_FF_003_COMPLETE"
    },
    {
      "id": "WF-FF-004",
      "name": "Add Packing Workflow",
      "description": "Packing slip generation and verification enhancements",
      "priority": 4,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Packing slip generation after picking (already exists)",
        "Verify picked items before packing (already exists)",
        "Record box/package details",
        "Package weight for shipping",
        "Packing slip PDF in shipment (already exists)",
        "Packing station UI optimized for speed",
        "Step-by-step packing wizard: Verify Items -> Add Package -> Review -> Complete",
        "Progress stepper showing current packing step",
        "Toast notification on packing completion",
        "Confirmation dialog before marking order packed",
        "Loading state during package weight submission",
        "Error handling with clear messaging for verification failures",
        "Responsive: single-column flow on mobile, side-by-side on desktop",
        "Breakpoints: mobile (<640px), tablet (640-1024px), desktop (>1024px)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-FF-003"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_FF_004_COMPLETE",
      "ui_spec": {
        "component_type": "Wizard",
        "workflow_visualization": "4-step horizontal stepper for packing process with item checklist",
        "accessibility": {
          "aria_live_regions": "Step completion and errors announced",
          "focus_management": "Focus moves to first item of each step",
          "keyboard_navigation": "Tab through items, Enter to confirm",
          "screen_reader": "Item verification status clearly announced"
        }
      }
    },
    {
      "id": "WF-FF-005",
      "name": "Add Shipping Workflow",
      "description": "Carrier selection and shipment creation (enhancement)",
      "priority": 5,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Carrier selection from configured options (already exists)",
        "Manual tracking number entry (already exists)",
        "Shipment notification to customer (already exists)",
        "Multiple packages per shipment (already exists)",
        "Shipping label generation (future: carrier API)",
        "Mark as shipped with timestamp (already exists)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-ORD-001"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_FF_005_COMPLETE"
    },
    {
      "id": "WF-FF-006a",
      "name": "Fulfillment Metrics Server Functions",
      "description": "New analytics queries for fulfillment operations",
      "priority": 6,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Metrics: orders fulfilled today, backlog, avg time",
        "Pick accuracy tracking calculation",
        "On-time shipping rate calculation",
        "Bottleneck identification by stage",
        "Team performance comparison queries",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-FF-001"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_FF_006A_COMPLETE"
    },
    {
      "id": "WF-FF-006b",
      "name": "Fulfillment Metrics Dashboard",
      "description": "Operational metrics dashboard for fulfillment",
      "priority": 7,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Dashboard with fulfillment metrics widgets",
        "Trend analysis over time",
        "Team performance comparison chart",
        "Export for management reporting",
        "KPI cards showing: orders fulfilled, backlog, avg time, on-time rate",
        "Workflow funnel showing orders at each stage",
        "Progress bars for daily/weekly targets",
        "Toast notification when export completes",
        "Loading skeleton while metrics load",
        "Error state with refresh option",
        "Responsive: single column on mobile, grid on desktop",
        "Breakpoints: mobile (<640px), tablet (640-1024px), desktop (>1024px)",
        "Date range selector with quick presets",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-FF-006a"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_FF_006B_COMPLETE",
      "ui_spec": {
        "component_type": "Dashboard",
        "workflow_visualization": "Funnel chart showing order progression through fulfillment stages with bottleneck highlighting",
        "accessibility": {
          "chart_alternatives": "Data tables available for all charts",
          "aria_labels": "All metrics have descriptive labels",
          "keyboard_navigation": "All controls and filters keyboard accessible",
          "screen_reader": "Key performance indicators announced on load"
        }
      }
    }
  ],
  "success_criteria": [
    "Fulfillment queue provides clear work list",
    "Auto-allocation reduces manual work",
    "Optimized pick lists improve efficiency",
    "Packing verification reduces errors",
    "Metrics enable continuous improvement"
  ],
  "out_of_scope": [
    "Carrier API integration",
    "Automated barcode scanning",
    "Multiple warehouse support"
  ]
}
