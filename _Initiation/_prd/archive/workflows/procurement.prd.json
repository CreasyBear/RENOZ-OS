{
  "id": "WF-PROCUREMENT",
  "name": "Procurement Workflow",
  "description": "End-to-end procurement process from demand identification through PO creation, approval, and goods receipt.",
  "created": "2026-01-09",
  "priority": 6,
  "phase": "workflow",
  "dependencies": {
    "phase": "Workflow",
    "executionOrder": 6,
    "schemaRequired": [
      {
        "table": "products",
        "status": "EXISTS"
      },
      {
        "table": "suppliers",
        "status": "EXISTS"
      },
      {
        "table": "purchase-orders",
        "status": "EXISTS"
      },
      {
        "table": "notifications",
        "status": "EXISTS"
      }
    ],
    "schemaCreates": [
      {
        "table": "supplier_prices",
        "story": "WF-PROC-002a"
      }
    ],
    "serverFunctionsRequired": [
      {
        "function": "listProducts",
        "status": "EXISTS",
        "domain": "DOM-PRODUCTS"
      },
      {
        "function": "getProduct",
        "status": "EXISTS",
        "domain": "DOM-PRODUCTS"
      },
      {
        "function": "listSuppliers",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "getSupplier",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "createPurchaseOrder",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "updatePurchaseOrder",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "receivePurchaseOrder",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "getSuggestedOrderItems",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "getSupplierPerformanceMetrics",
        "status": "EXISTS",
        "domain": "DOM-SUPPLIERS"
      },
      {
        "function": "getInventorySummary",
        "status": "EXISTS",
        "domain": "DOM-INVENTORY"
      }
    ],
    "serverFunctionsCreates": [
      {
        "function": "getEnhancedDemandSuggestions",
        "story": "WF-PROC-001"
      },
      {
        "function": "createSupplierPrice",
        "story": "WF-PROC-002b"
      },
      {
        "function": "updateSupplierPrice",
        "story": "WF-PROC-002b"
      },
      {
        "function": "compareSupplierPrices",
        "story": "WF-PROC-002b"
      },
      {
        "function": "groupDemandBySupplier",
        "story": "WF-PROC-003"
      },
      {
        "function": "recordSupplierAcknowledgement",
        "story": "WF-PROC-004"
      },
      {
        "function": "autoAllocateOnReceipt",
        "story": "WF-PROC-005"
      },
      {
        "function": "getSpendAnalytics",
        "story": "WF-PROC-006b"
      },
      {
        "function": "getSupplierScorecard",
        "story": "WF-PROC-006c"
      }
    ],
    "prdDependencies": [
      {
        "prdId": "DOM-SUPPLIERS",
        "status": "REQUIRED",
        "reason": "Core supplier and PO management"
      },
      {
        "prdId": "DOM-INVENTORY",
        "status": "REQUIRED",
        "reason": "Demand identification and goods receipt"
      },
      {
        "prdId": "DOM-PRODUCTS",
        "status": "REQUIRED",
        "reason": "Product catalog and reorder points"
      }
    ],
    "enables": []
  },
  "domains_involved": [
    "procurement",
    "inventory",
    "products"
  ],
  "references": {
    "internal": [
      "memory-bank/prd/domain/procurement.prd.json",
      "memory-bank/prd/domain/inventory.prd.json"
    ]
  },
  "workflow_stages": [
    "Demand \u2192 Supplier Selection \u2192 Create PO \u2192 Approve \u2192 Send \u2192 Receive \u2192 Complete"
  ],
  "current_state": {
    "implemented": [
      "Full PO lifecycle (draft \u2192 sent \u2192 in_transit \u2192 received)",
      "getSuggestedOrderItems for demand identification",
      "Complete goods receipt with serial numbers and bin locations",
      "Procurement metrics on PO list page",
      "Supplier performance metrics",
      "PO PDF generation"
    ],
    "gaps": [
      "Demand suggestions don't consider pending POs",
      "No supplier price comparison",
      "No approval workflow",
      "No supplier acknowledgement tracking",
      "No dedicated procurement analytics dashboard"
    ]
  },
  "stories": [
    {
      "id": "WF-PROC-001",
      "name": "Enhance Demand Identification",
      "description": "Improve demand suggestions with pending PO consideration",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Daily check for below-reorder-point items (enhance existing)",
        "Demand queue with recommended quantities",
        "Factor in lead times for timing",
        "Consider open POs already in transit",
        "Manual add items to demand queue",
        "Demand forecast integration (optional)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-INV-001",
        "DOM-PROC-003"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_PROC_001_COMPLETE"
    },
    {
      "id": "WF-PROC-002a",
      "name": "Supplier Prices Schema",
      "description": "Create supplier_prices table for price comparison",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "supplier_prices table (supplierId, productId, unitPrice, minQty, effectiveDate)",
        "Add products.preferredSupplierId FK",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "WF_PROC_002A_COMPLETE"
    },
    {
      "id": "WF-PROC-002b",
      "name": "Supplier Price CRUD Server Functions",
      "description": "Server functions for managing supplier prices",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Create supplier price CRUD server functions",
        "Compare: price, lead time, performance score",
        "Preferred supplier highlighted",
        "Total cost calculation",
        "Record selection reasoning",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-PROC-002a",
        "DOM-PROC-005",
        "DOM-PROC-001"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_PROC_002B_COMPLETE"
    },
    {
      "id": "WF-PROC-002c",
      "name": "Supplier Comparison UI",
      "description": "UI for comparing suppliers during PO creation",
      "priority": 4,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "View multiple suppliers for same product",
        "Comparison view showing prices and performance",
        "Select supplier for PO",
        "Show supplier performance score",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-PROC-002b"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_PROC_002C_COMPLETE"
    },
    {
      "id": "WF-PROC-003",
      "name": "Enhance PO Creation Wizard",
      "description": "Add supplier grouping to PO creation from demand",
      "priority": 5,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Create PO from demand queue items (enhance existing)",
        "Group by supplier automatically",
        "Adjust quantities before creating (already exists)",
        "Add non-demand items manually (already exists)",
        "Preview PO before creation (already exists)",
        "Submit for approval if required",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-PROC-002c"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_PROC_003_COMPLETE"
    },
    {
      "id": "WF-PROC-004",
      "name": "Enhance PO Status Tracking",
      "description": "Add supplier acknowledgement and notifications",
      "priority": 6,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "PO statuses (already exists): draft, pending approval, approved, sent, acknowledged, shipped, received",
        "Expected delivery date tracking (already exists)",
        "Supplier acknowledgment capture",
        "Overdue PO alerts (already exists - enhance with email)",
        "Status history with timestamps",
        "Email notifications on key events",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-PROC-002"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_PROC_004_COMPLETE"
    },
    {
      "id": "WF-PROC-005",
      "name": "Add Goods Receipt Process",
      "description": "Streamlined receipt of incoming goods (already complete - optional enhancements)",
      "priority": 7,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Receipt from pending PO list (already exists)",
        "Scan/enter serial numbers for serialized (already exists)",
        "Record actual quantities received (already exists)",
        "Quality inspection checklist (optional)",
        "Handle discrepancies (short/over/damaged) (already exists)",
        "Auto-allocate to waiting orders",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-PROC-004",
        "DOM-INV-002"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_PROC_005_COMPLETE"
    },
    {
      "id": "WF-PROC-006a",
      "name": "Procurement Dashboard Route",
      "description": "Create dedicated /procurement/dashboard route",
      "priority": 8,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Create /procurement/dashboard route with layout",
        "Widget slots for analytics components",
        "Date range filter",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 3,
      "completion_promise": "WF_PROC_006A_COMPLETE"
    },
    {
      "id": "WF-PROC-006b",
      "name": "Spend Analysis Widgets",
      "description": "Add spend analysis by supplier and category",
      "priority": 9,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Spend analysis by supplier/category/period",
        "Spend by category breakdown chart",
        "Lead time trend chart",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-PROC-006a",
        "DOM-PROC-008"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_PROC_006B_COMPLETE"
    },
    {
      "id": "WF-PROC-006c",
      "name": "Supplier Scorecard Widget",
      "description": "Supplier comparison scorecard widget",
      "priority": 10,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Supplier comparison scorecard",
        "Lead time performance vs promised",
        "Price trend analysis",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-PROC-006b"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_PROC_006C_COMPLETE"
    },
    {
      "id": "WF-PROC-006d",
      "name": "Procurement Report Export",
      "description": "Export procurement reports for management",
      "priority": 11,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Demand accuracy vs actual",
        "Export for management review",
        "CSV/PDF export options",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-PROC-006c"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_PROC_006D_COMPLETE"
    }
  ],
  "success_criteria": [
    "Demand identified proactively",
    "Supplier selection is data-driven",
    "POs created efficiently",
    "Status tracking provides visibility",
    "Receipt process captures accuracy"
  ],
  "out_of_scope": [
    "Automated supplier ordering",
    "EDI integration",
    "Complex approval hierarchies"
  ]
}
