{
  "id": "WF-SUPPORT",
  "name": "Support Resolution Workflow",
  "description": "End-to-end customer support process from issue creation through resolution and customer feedback.",
  "created": "2026-01-09",
  "priority": 4,
  "phase": "workflow",
  "dependencies": {
    "phase": "Workflow",
    "executionOrder": 4,
    "schemaRequired": [
      {
        "table": "issues",
        "status": "EXISTS"
      },
      {
        "table": "customers",
        "status": "EXISTS"
      },
      {
        "table": "contacts",
        "status": "EXISTS"
      },
      {
        "table": "users",
        "status": "EXISTS"
      },
      {
        "table": "activities",
        "status": "EXISTS"
      },
      {
        "table": "email-history",
        "status": "EXISTS"
      },
      {
        "table": "notifications",
        "status": "EXISTS"
      }
    ],
    "schemaCreates": [
      {
        "table": "assignment_rules",
        "story": "WF-SUP-002a"
      },
      {
        "table": "user_skills",
        "story": "WF-SUP-002b"
      },
      {
        "table": "email_templates",
        "story": "WF-SUP-004a"
      }
    ],
    "serverFunctionsRequired": [
      {
        "function": "listIssues",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "getIssue",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "createIssue",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "updateIssue",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "assignIssue",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "resolveIssue",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "logIssueActivity",
        "status": "EXISTS",
        "domain": "DOM-SUPPORT"
      },
      {
        "function": "getCustomer",
        "status": "EXISTS",
        "domain": "DOM-CUSTOMERS"
      }
    ],
    "serverFunctionsCreates": [
      {
        "function": "completeTriage",
        "story": "WF-SUP-001a"
      },
      {
        "function": "getTriageQueue",
        "story": "WF-SUP-001b"
      },
      {
        "function": "evaluateAssignmentRules",
        "story": "WF-SUP-002a"
      },
      {
        "function": "calculateUserWorkload",
        "story": "WF-SUP-002b"
      },
      {
        "function": "autoAssignIssue",
        "story": "WF-SUP-002b"
      },
      {
        "function": "createResolutionTemplate",
        "story": "WF-SUP-003"
      },
      {
        "function": "applyResolutionTemplate",
        "story": "WF-SUP-003"
      },
      {
        "function": "sendIssueCreationEmail",
        "story": "WF-SUP-004a"
      },
      {
        "function": "reopenIssue",
        "story": "WF-SUP-004b"
      },
      {
        "function": "requestFeedback",
        "story": "WF-SUP-005"
      },
      {
        "function": "submitFeedback",
        "story": "WF-SUP-005"
      },
      {
        "function": "getSupportWorkflowMetrics",
        "story": "WF-SUP-006"
      }
    ],
    "prdDependencies": [
      {
        "prdId": "DOM-SUPPORT",
        "status": "REQUIRED",
        "reason": "Core issue management"
      },
      {
        "prdId": "DOM-CUSTOMERS",
        "status": "REQUIRED",
        "reason": "Customer context for issues"
      },
      {
        "prdId": "DOM-COMMS",
        "status": "REQUIRED",
        "reason": "Email notifications and templates"
      }
    ],
    "enables": [
      {
        "prdId": "WF-WARRANTY",
        "reason": "Warranty claims use support workflow"
      }
    ]
  },
  "domains_involved": [
    "support",
    "customers",
    "communications"
  ],
  "references": {
    "internal": [
      "memory-bank/prd/domain/support.prd.json",
      "memory-bank/prd/domain/communications.prd.json"
    ]
  },
  "workflow_stages": [
    "Issue Created -> Triage -> Investigate -> Resolve -> Customer Feedback"
  ],
  "current_state": {
    "implemented": [
      "Issue creation and CRUD",
      "Status workflow (open, in_progress, on_hold, escalated, resolved, closed)",
      "Activity tracking (comment, status_change, assignment, attachment)",
      "Manual assignment via assignIssue function",
      "Resolution workflow with types (closed, replaced, refunded, repaired)",
      "Email on status change via Trigger.dev",
      "Basic metrics (open_count, urgent_count, overdue_count)"
    ],
    "gaps": [
      "No triage queue or triage status",
      "No auto-assignment rules",
      "No resolution templates",
      "No auto-email on issue creation",
      "No feedback collection",
      "No triage/response time metrics"
    ]
  },
  "stories": [
    {
      "id": "WF-SUP-001a",
      "name": "Triage Schema and Status",
      "description": "Add triage status tracking columns and server logic",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "issues table has triageStatus column (pending, in_progress, completed)",
        "issues table has triageCompletedAt timestamp column",
        "issues table has triageCompletedBy user reference",
        "New issues default to triageStatus='pending'",
        "listIssues supports triageStatus filter",
        "Server function completeTriage updates status and records timestamp",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "WF_SUP_001A_COMPLETE"
    },
    {
      "id": "WF-SUP-001b",
      "name": "Triage Queue UI and Auto-Suggest",
      "description": "Triage queue view with priority auto-suggestion",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Triage queue view shows only triageStatus='pending' issues",
        "Triage form enforces: type, priority, category before completion",
        "Auto-suggest priority based on customer tier and issue type",
        "Triage completion moves issue to assigned queue",
        "Triage time displayed in issue detail",
        "Queue table with sortable columns: created date, customer tier, issue type",
        "Step indicator: Pending Triage -> In Triage -> Triaged",
        "Form wizard for triage: Classify Type -> Set Priority -> Assign Category -> Review",
        "Toast notification on triage completion",
        "Confirmation dialog before completing triage",
        "Loading state during triage submission",
        "Error handling with validation messages",
        "Responsive: card view on mobile, table on desktop",
        "Breakpoints: mobile (<640px), tablet (640-1024px), desktop (>1024px)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-SUP-001a",
        "DOM-SUP-004"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_SUP_001B_COMPLETE",
      "ui_spec": {
        "component_type": "DataTable",
        "workflow_visualization": "Queue table with triage form wizard accessible from each row",
        "accessibility": {
          "aria_live_regions": "Queue count and triage completion announced",
          "focus_management": "Focus moves to triage form when opened",
          "keyboard_navigation": "Full table and form keyboard support",
          "form_validation": "Inline validation with clear error messages"
        }
      }
    },
    {
      "id": "WF-SUP-002a",
      "name": "Assignment Rules Schema and Basic Engine",
      "description": "Create assignment_rules table and implement basic rule matching",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "assignment_rules table (id, name, condition_type, condition_value, assigned_user_id, priority, organizationId)",
        "Condition types: issue_type, customer_id, product_category",
        "Server function evaluateAssignmentRules returns matching rule",
        "Manual assignment override always takes precedence",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "WF_SUP_002A_COMPLETE"
    },
    {
      "id": "WF-SUP-002b",
      "name": "Load Balancing and Skill Routing",
      "description": "Add workload-aware assignment and skill-based routing",
      "priority": 4,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "user_skills table (userId, skill, proficiency) if not exists",
        "Workload calculation: count of open issues per user",
        "Load balancing distributes to user with lowest open count",
        "Skill routing matches issue type/product to user skills",
        "Round-robin fallback when no rules match",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-SUP-002a"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_SUP_002B_COMPLETE"
    },
    {
      "id": "WF-SUP-002c",
      "name": "Assignment Rules UI and Notification",
      "description": "Rules configuration UI and assignment notification",
      "priority": 5,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Assignment rules management page in settings",
        "Rule CRUD with condition builder",
        "Assignment notification email sent on auto-assign",
        "Preview which user would be assigned for given criteria",
        "Rule builder with visual condition blocks",
        "Step-by-step rule creation: Define Trigger -> Set Conditions -> Choose Assignee -> Test",
        "Sortable rule list showing priority order",
        "Toast notification on rule save/delete",
        "Confirmation dialog before deleting rule",
        "Loading state during rule testing",
        "Error handling with validation for rule conflicts",
        "Responsive: stacked form on mobile, side-by-side preview on desktop",
        "Breakpoints: mobile (<640px), tablet (640-1024px), desktop (>1024px)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-SUP-002b"
      ],
      "estimated_iterations": 3,
      "completion_promise": "WF_SUP_002C_COMPLETE",
      "ui_spec": {
        "component_type": "FormBuilder",
        "workflow_visualization": "Visual rule builder with condition blocks and test preview panel",
        "accessibility": {
          "aria_labels": "Rule conditions and actions clearly labeled",
          "focus_management": "Focus follows rule creation flow",
          "keyboard_navigation": "All builder controls keyboard accessible",
          "screen_reader": "Rule logic announced as conditions are added"
        }
      }
    },
    {
      "id": "WF-SUP-003",
      "name": "Add Resolution Templates",
      "description": "Pre-configured resolution responses with variable substitution",
      "priority": 6,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Resolution templates by issue type",
        "Template includes: description, steps, email",
        "Insert template into resolution notes",
        "Personalization variables",
        "Template effectiveness tracking",
        "Suggest templates based on issue",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 4,
      "completion_promise": "WF_SUP_003_COMPLETE"
    },
    {
      "id": "WF-SUP-004a",
      "name": "Creation Email and Template Customization",
      "description": "Auto-email on issue creation and customizable templates",
      "priority": 7,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "email_templates table (id, type, subject_template, body_template, organizationId)",
        "Auto-email on issue creation confirmation",
        "Update email when assigned/status change",
        "Template customization UI in settings",
        "Variable support: {issueNumber}, {customerName}, {status}",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-SUP-003"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_SUP_004A_COMPLETE"
    },
    {
      "id": "WF-SUP-004b",
      "name": "Reopen Mechanism and Communication History",
      "description": "Email-based issue reopen and communication tracking",
      "priority": 8,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Secure reopen token in resolution email (expires in 7 days)",
        "Public reopen endpoint validates token and reopens issue",
        "Communication history tracked in issueActivities (type='email_sent')",
        "Communication timeline visible on issue detail page",
        "Timeline showing all communications: emails sent, customer responses, status changes",
        "Step indicator: Created -> Email Sent -> Viewed -> Resolved -> Reopened (if applicable)",
        "Toast notification on reopen with link to issue",
        "Confirmation dialog on public reopen page before submitting",
        "Loading state during reopen processing",
        "Error state for expired/invalid tokens with clear messaging",
        "Responsive: timeline collapses to list on mobile",
        "Breakpoints: mobile (<640px), tablet (640-1024px), desktop (>1024px)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "WF-SUP-004a"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_SUP_004B_COMPLETE",
      "ui_spec": {
        "component_type": "Timeline",
        "workflow_visualization": "Vertical timeline showing communication events with email/status/action icons",
        "accessibility": {
          "aria_live_regions": "New events announced as they occur",
          "focus_management": "Focus moves to new timeline entry",
          "keyboard_navigation": "Timeline navigable via arrow keys",
          "screen_reader": "Full event context including timestamp and action"
        }
      }
    },
    {
      "id": "WF-SUP-005",
      "name": "Add Post-Resolution Feedback",
      "description": "Collect customer satisfaction after resolution",
      "priority": 9,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Feedback request email 24h after resolution",
        "Simple rating form (1-5 stars)",
        "Optional comment field",
        "Feedback linked to issue",
        "Low rating triggers follow-up task",
        "CSAT tracking over time",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-005"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_SUP_005_COMPLETE"
    },
    {
      "id": "WF-SUP-006",
      "name": "Add Support Workflow Metrics",
      "description": "Track workflow efficiency and quality",
      "priority": 10,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Metrics: avg time to triage, assign, resolve",
        "First response time tracking",
        "Resolution rate by type/priority",
        "Reopen rate (quality indicator)",
        "Team workload distribution",
        "Trend analysis and alerts",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-006",
        "WF-SUP-001a",
        "WF-SUP-002a"
      ],
      "estimated_iterations": 4,
      "completion_promise": "WF_SUP_006_COMPLETE"
    }
  ],
  "success_criteria": [
    "Triage ensures consistent assessment",
    "Smart assignment distributes work fairly",
    "Templates speed up resolution",
    "Communication keeps customers informed",
    "Feedback measures success"
  ],
  "out_of_scope": [
    "Customer self-service portal",
    "Live chat integration",
    "AI-powered issue resolution"
  ]
}
