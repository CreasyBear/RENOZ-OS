{
  "prd_id": "CC-LOADING",
  "audit_date": "2026-01-09",
  "auditor": "Claude Opus 4.5",
  "summary": {
    "total_stories": 6,
    "verified_gaps": 2,
    "invalidated_gaps": 4,
    "new_gaps_found": 1,
    "implementation_status": "partially_complete"
  },
  "codebase_findings": {
    "existing_components": {
      "skeleton_base": {
        "file": "/renoz-v2/src/components/ui/skeleton.tsx",
        "description": "Base Skeleton component with pulse animation using bg-accent",
        "status": "implemented"
      },
      "skeleton_patterns": {
        "file": "/renoz-v2/src/components/ui/skeleton-patterns.tsx",
        "description": "TableSkeleton, CardSkeleton, FormSkeleton, ListSkeleton components",
        "status": "implemented"
      },
      "loading_state": {
        "file": "/renoz-v2/src/components/shared/loading-state.tsx",
        "description": "LoadingState component with variants: table, list, card, page, inline. Includes accessibility attributes (role='status', aria-live='polite')",
        "status": "implemented"
      },
      "page_skeletons": {
        "files": [
          "/renoz-v2/src/components/shared/skeletons/list-page-skeleton.tsx",
          "/renoz-v2/src/components/shared/skeletons/detail-page-skeleton.tsx",
          "/renoz-v2/src/components/shared/skeletons/dashboard-skeleton.tsx"
        ],
        "description": "Page-level skeleton components matching actual page layouts",
        "status": "implemented"
      },
      "list_page_pending": {
        "file": "/renoz-v2/src/components/shared/list-page-pending.tsx",
        "description": "Wrapper combining AppShell with ListPageSkeleton for route pending states",
        "status": "implemented"
      }
    },
    "route_loading_patterns": {
      "tanstack_router_pending": {
        "description": "Routes use pendingComponent with page-specific skeletons",
        "coverage": "35+ routes have pendingComponent defined",
        "examples": [
          "/customers/index.tsx uses ListPagePending",
          "/orders/$orderId.tsx has pendingComponent",
          "/reports/* routes use useSuspenseQuery + pendingComponent"
        ]
      },
      "loader_pattern": {
        "description": "Routes use loader + ensureQueryData for SSR-compatible loading",
        "status": "implemented"
      }
    },
    "data_table_loading": {
      "file": "/renoz-v2/src/components/shared/data-table/data-table.tsx",
      "description": "DataTable has isLoading prop that shows LoadingState variant='table' when data.length === 0",
      "gap": "No overlay loading state for subsequent operations (pagination, sorting, filtering)"
    },
    "form_loading": {
      "file": "/renoz-v2/src/components/shared/forms/form-footer.tsx",
      "description": "FormFooter supports primaryAction.loading and primaryAction.loadingLabel but no inline spinner icon",
      "gap": "Button shows text change only, no visual spinner indicator"
    },
    "spinner_components": {
      "dedicated_file": "NONE",
      "inline_usage": "LoadingState page variant has a spinning border div, Loader2 from lucide-react used inline in some components",
      "gap": "No dedicated reusable Spinner component library"
    },
    "suspense_usage": {
      "tanstack_query": "useSuspenseQuery used in report routes",
      "react_suspense": "Not explicitly used - TanStack Router's pendingComponent handles loading states"
    }
  },
  "gap_verification": {
    "no_skeleton_screen_components": {
      "prd_claim": "No skeleton screen components exist",
      "actual_status": "INVALIDATED",
      "evidence": "Multiple skeleton components exist: Skeleton base, TableSkeleton, CardSkeleton, FormSkeleton, ListSkeleton, ListPageSkeleton, DetailPageSkeleton, DashboardSkeleton"
    },
    "no_progressive_loading": {
      "prd_claim": "No progressive loading patterns implemented",
      "actual_status": "PARTIALLY_INVALIDATED",
      "evidence": "Route loaders use Promise.all for parallel data fetching. Individual component sections don't have independent loading states yet."
    },
    "no_standardized_spinner": {
      "prd_claim": "No standardized spinner component",
      "actual_status": "VERIFIED",
      "evidence": "No dedicated Spinner component file. LoadingState uses inline CSS spinner. Some components use Loader2 from lucide-react ad-hoc."
    },
    "no_suspense_boundary_strategy": {
      "prd_claim": "No Suspense boundary strategy defined",
      "actual_status": "PARTIALLY_INVALIDATED",
      "evidence": "TanStack Router's pendingComponent pattern IS the Suspense boundary strategy. 35+ routes have pendingComponent defined. This is idiomatic for TanStack Router."
    },
    "no_loading_state_for_data_tables": {
      "prd_claim": "No loading state for data tables",
      "actual_status": "PARTIALLY_INVALIDATED",
      "evidence": "DataTable has isLoading prop showing table skeleton. Missing: overlay loading for pagination/sort/filter changes."
    },
    "no_form_submission_loading_states": {
      "prd_claim": "No form submission loading states",
      "actual_status": "PARTIALLY_INVALIDATED",
      "evidence": "FormFooter has loading prop with text change. CustomerForm tracks isSubmitting. Missing: inline spinner in button, field disabling pattern."
    },
    "no_page_transition_indicator": {
      "prd_claim": "No page transition loading indicator",
      "actual_status": "VERIFIED",
      "evidence": "No global navigation progress bar or header indicator during route transitions. Only per-route pendingComponent skeletons exist."
    }
  },
  "stories_status": {
    "CC-LOAD-001": {
      "name": "Spinner Component Library",
      "status": "valid",
      "change": "adjust_scope",
      "reason": "Gap verified - no dedicated Spinner component exists. Reduce scope to leverage existing Loader2 icon styling rather than creating from scratch.",
      "layers": ["ui"],
      "estimated_iterations": 2,
      "adjusted_acceptance_criteria": [
        "Spinner component wraps Loader2 with consistent styling",
        "Size variants: sm (16px), md (24px), lg (32px), xl (48px)",
        "InlineSpinner for buttons (includes text label support)",
        "PageSpinner for full-page centered display",
        "Accessible aria-label",
        "Export from index for easy imports"
      ]
    },
    "CC-LOAD-002": {
      "name": "Skeleton Screen Components",
      "status": "invalid",
      "change": "remove",
      "reason": "Gap does not exist. Comprehensive skeleton components already implemented: Skeleton base, TableSkeleton, CardSkeleton, FormSkeleton, ListSkeleton, page-level skeletons (ListPageSkeleton, DetailPageSkeleton, DashboardSkeleton). All have proper accessibility (aria-hidden implied via non-interactive elements).",
      "layers": ["ui"],
      "estimated_iterations": 0
    },
    "CC-LOAD-003": {
      "name": "Page-Level Suspense Boundaries",
      "status": "invalid",
      "change": "remove",
      "reason": "Gap does not exist. TanStack Router's pendingComponent pattern is the idiomatic Suspense boundary strategy. 35+ routes already have pendingComponent with appropriate skeletons. No additional Suspense boundaries needed.",
      "layers": ["ui"],
      "estimated_iterations": 0
    },
    "CC-LOAD-004": {
      "name": "Data Table Loading States",
      "status": "valid",
      "change": "adjust_scope",
      "reason": "Partial gap - initial skeleton exists via isLoading prop. Missing overlay/subtle loading state for subsequent operations (pagination, sorting, filtering). Some inline implementations exist (customers/index.tsx uses opacity transition during page loading).",
      "layers": ["ui"],
      "estimated_iterations": 3,
      "adjusted_acceptance_criteria": [
        "Standardize subtle overlay loading state for table during pagination/filter/sort",
        "Pagination controls show spinner during data fetch",
        "Extract opacity transition pattern from customers/index.tsx into DataTable",
        "Ensure table renders within 100ms for 100 rows (existing virtualizer supports this)"
      ]
    },
    "CC-LOAD-005": {
      "name": "Form Submission Loading States",
      "status": "valid",
      "change": "adjust_scope",
      "reason": "Partial gap - FormFooter has loading prop but lacks visual spinner. Need to integrate Spinner component from CC-LOAD-001 and standardize field disabling pattern.",
      "layers": ["ui"],
      "estimated_iterations": 2,
      "adjusted_acceptance_criteria": [
        "FormFooter uses InlineSpinner when loading",
        "Create useFormLoadingState hook or pattern for consistent field disabling",
        "Document pattern in forms/README.md",
        "Verify CustomerForm and similar forms follow pattern"
      ],
      "dependencies": ["CC-LOAD-001"]
    },
    "CC-LOAD-006": {
      "name": "Progressive Loading Pattern",
      "status": "invalid",
      "change": "remove",
      "reason": "Low priority and existing patterns sufficient. Route loaders already use Promise.all for parallel data loading. Individual component progressive loading is an optimization that can be deferred. Current architecture supports adding this later if needed.",
      "layers": ["ui", "server"],
      "estimated_iterations": 0
    }
  },
  "new_gaps_found": {
    "navigation_progress_indicator": {
      "description": "No global navigation progress bar or header indicator during route transitions",
      "recommended_story": {
        "id": "CC-LOAD-007",
        "name": "Navigation Progress Indicator",
        "description": "Add a subtle progress indicator in the header/app shell during route transitions to complement page skeletons",
        "priority": 2,
        "acceptance_criteria": [
          "NProgress-style bar at top of page during navigation",
          "Or subtle spinner in sidebar/header",
          "Uses TanStack Router's isTransitioning state",
          "Does not flash for fast transitions (< 100ms)"
        ],
        "layers": ["ui"],
        "estimated_iterations": 2
      }
    }
  },
  "recommended_stories": [
    "CC-LOAD-001",
    "CC-LOAD-004",
    "CC-LOAD-005",
    "CC-LOAD-007"
  ],
  "atomization_notes": {
    "CC-LOAD-001": {
      "atomic": true,
      "reason": "Single layer (UI), focused scope, 2 iterations appropriate"
    },
    "CC-LOAD-004": {
      "atomic": true,
      "reason": "Single layer (UI), builds on existing DataTable, 3 iterations appropriate"
    },
    "CC-LOAD-005": {
      "atomic": true,
      "reason": "Single layer (UI), depends on CC-LOAD-001, 2 iterations appropriate"
    },
    "CC-LOAD-007": {
      "atomic": true,
      "reason": "Single layer (UI), isolated to app shell/layout, 2 iterations appropriate"
    }
  },
  "execution_order": [
    {
      "phase": 1,
      "stories": ["CC-LOAD-001"],
      "reason": "Foundation - Spinner component needed by other stories"
    },
    {
      "phase": 2,
      "stories": ["CC-LOAD-004", "CC-LOAD-005"],
      "reason": "Can run in parallel - DataTable loading independent of Form loading"
    },
    {
      "phase": 3,
      "stories": ["CC-LOAD-007"],
      "reason": "Enhancement - can be done after core loading states complete"
    }
  ],
  "total_estimated_iterations": 9,
  "risk_assessment": {
    "low_risk": [
      "CC-LOAD-001: Wrapper around existing Loader2, minimal risk",
      "CC-LOAD-007: Additive enhancement, non-breaking"
    ],
    "medium_risk": [
      "CC-LOAD-004: Changes DataTable behavior, needs thorough testing of all table instances",
      "CC-LOAD-005: Pattern change may require updating multiple form components"
    ]
  }
}
