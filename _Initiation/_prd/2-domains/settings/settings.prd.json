{
  "id": "DOM-SETTINGS",
  "name": "Configuration Management System",
  "description": "Complete organizational and system configuration platform providing centralized management of settings, preferences, defaults, and customizations across the entire application.",
  "created": "2026-01-10",
  "updated": "2026-01-10",
  "priority": 4,
  "phase": "core-business",
  "version": "1.1",
  "business_value": {
    "configuration_centralization": true,
    "user_experience_personalization": true,
    "organizational_governance": true,
    "description": "Unified configuration system enabling consistent behavior and user preferences"
  },
  "system_requirements": {
    "database": {
      "organizations": {
        "description": "Organization-level settings and metadata",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "name": "varchar(255) NOT NULL",
          "domain": "varchar(255) UNIQUE",
          "settings": "jsonb DEFAULT '{}'",
          "timezone": "varchar(50) DEFAULT 'Australia/Sydney'",
          "locale": "varchar(10) DEFAULT 'en-AU'",
          "currency": "varchar(3) DEFAULT 'AUD'",
          "version": "integer NOT NULL DEFAULT 1",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "domain",
          "name"
        ],
        "constraints": [
          "settings IS NOT NULL"
        ]
      },
      "users": {
        "description": "User accounts with preferences",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "email": "varchar(255) UNIQUE NOT NULL",
          "firstName": "varchar(100)",
          "lastName": "varchar(100)",
          "role": "enum('owner', 'admin', 'manager', 'sales', 'operations', 'support', 'viewer') DEFAULT 'viewer'",
          "preferences": "jsonb DEFAULT '{}'",
          "lastLoginAt": "timestamp",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "email",
          "role"
        ],
        "constraints": [
          "preferences IS NOT NULL"
        ]
      },
      "userPreferences": {
        "description": "Detailed user preference settings",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "userId": "uuid NOT NULL REFERENCES users(id)",
          "category": "varchar(50) NOT NULL",
          "key": "varchar(100) NOT NULL",
          "value": "jsonb NOT NULL",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "userId",
          "category",
          "key"
        ],
        "constraints": [
          "value IS NOT NULL"
        ],
        "unique": [
          "userId",
          "category",
          "key"
        ]
      },
      "systemSettings": {
        "description": "Global system defaults and configuration",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "category": "varchar(50) NOT NULL",
          "key": "varchar(100) NOT NULL",
          "value": "jsonb NOT NULL",
          "type": "enum('string', 'number', 'boolean', 'json') NOT NULL",
          "description": "text",
          "isPublic": "boolean DEFAULT false",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "version": "integer NOT NULL DEFAULT 1",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "category",
          "key",
          "isPublic"
        ],
        "constraints": [
          "value IS NOT NULL"
        ],
        "unique": [
          "organizationId",
          "category",
          "key"
        ]
      },
      "businessHours": {
        "description": "Organization business hours configuration",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "dayOfWeek": "integer NOT NULL CHECK (dayOfWeek >= 0 AND dayOfWeek <= 6)",
          "startTime": "time",
          "endTime": "time",
          "isEnabled": "boolean DEFAULT true",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "dayOfWeek"
        ],
        "constraints": [
          "endTime > startTime OR (startTime IS NULL AND endTime IS NULL)"
        ]
      },
      "holidays": {
        "description": "Organization holiday calendar",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "name": "varchar(255) NOT NULL",
          "date": "date NOT NULL",
          "isRecurring": "boolean DEFAULT false",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "version": "integer NOT NULL DEFAULT 1",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "date"
        ],
        "unique": [
          "organizationId",
          "name",
          "date"
        ]
      },
      "auditLogs": {
        "description": "Comprehensive audit trail for all system changes",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "userId": "uuid REFERENCES users(id)",
          "action": "varchar(100) NOT NULL",
          "entityType": "varchar(50) NOT NULL",
          "entityId": "uuid",
          "oldValues": "jsonb",
          "newValues": "jsonb",
          "ipAddress": "inet",
          "userAgent": "text",
          "timestamp": "timestamp NOT NULL DEFAULT NOW()",
          "metadata": "jsonb DEFAULT '{}'"
        },
        "indexes": [
          "organizationId",
          "userId",
          "entityType",
          "entityId",
          "timestamp"
        ],
        "constraints": [
          "timestamp IS NOT NULL"
        ]
      },
      "customFields": {
        "description": "Dynamic field definitions for entities",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "entityType": "varchar(50) NOT NULL",
          "name": "varchar(100) NOT NULL",
          "fieldType": "enum('text', 'number', 'date', 'select', 'checkbox', 'textarea') NOT NULL",
          "options": "jsonb",
          "isRequired": "boolean DEFAULT false",
          "isActive": "boolean DEFAULT true",
          "sortOrder": "integer DEFAULT 0",
          "defaultValue": "jsonb",
          "validationRules": "jsonb DEFAULT '{}'",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "version": "integer NOT NULL DEFAULT 1",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "entityType",
          "isActive",
          "sortOrder"
        ],
        "constraints": [
          "name IS NOT NULL",
          "fieldType IS NOT NULL"
        ]
      },
      "customFieldValues": {
        "description": "Values for custom fields on specific entities",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "customFieldId": "uuid NOT NULL REFERENCES customFields(id)",
          "entityId": "uuid NOT NULL",
          "value": "jsonb",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "version": "integer NOT NULL DEFAULT 1",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "customFieldId",
          "entityId"
        ],
        "unique": [
          "customFieldId",
          "entityId"
        ]
      },
      "dataExports": {
        "description": "Tracking of data export jobs",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "requestedBy": "uuid NOT NULL REFERENCES users(id)",
          "entities": "text[] NOT NULL",
          "format": "enum('csv', 'json', 'xlsx') NOT NULL",
          "status": "enum('pending', 'processing', 'completed', 'failed') DEFAULT 'pending'",
          "fileUrl": "text",
          "fileSize": "bigint",
          "recordCount": "integer",
          "expiresAt": "timestamp",
          "errorMessage": "text",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "completedAt": "timestamp"
        },
        "indexes": [
          "organizationId",
          "requestedBy",
          "status",
          "createdAt"
        ],
        "constraints": [
          "array_length(entities, 1) > 0"
        ]
      }
    },
    "api_endpoints": {
      "organizations": {
        "get": {
          "method": "GET",
          "path": "/api/organizations/current",
          "response": {
            "organization": "Organization",
            "settings": "SystemSettings[]",
            "businessHours": "BusinessHours[]",
            "holidays": "Holiday[]"
          },
          "description": "Get current organization with all settings"
        },
        "update": {
          "method": "PUT",
          "path": "/api/organizations/current",
          "body": {
            "name": "string?",
            "timezone": "string?",
            "locale": "string?",
            "currency": "string?",
            "settings": "Record<string, any>?"
          },
          "response": {
            "organization": "Organization"
          },
          "description": "Update organization settings"
        }
      },
      "users": {
        "getProfile": {
          "method": "GET",
          "path": "/api/users/profile",
          "response": {
            "user": "User",
            "preferences": "UserPreferences[]",
            "organization": "Organization"
          },
          "description": "Get current user profile with preferences"
        },
        "updateProfile": {
          "method": "PUT",
          "path": "/api/users/profile",
          "body": {
            "firstName": "string?",
            "lastName": "string?",
            "preferences": "Record<string, any>?"
          },
          "response": {
            "user": "User"
          },
          "description": "Update user profile and preferences"
        },
        "updatePreferences": {
          "method": "PUT",
          "path": "/api/users/preferences",
          "body": {
            "preferences": "Record<string, any>"
          },
          "response": {
            "success": "boolean"
          },
          "description": "Update user preferences"
        }
      },
      "systemSettings": {
        "list": {
          "method": "GET",
          "path": "/api/system-settings",
          "query_params": [
            "category"
          ],
          "response": {
            "settings": "SystemSettings[]"
          },
          "description": "Get system settings, optionally filtered by category"
        },
        "get": {
          "method": "GET",
          "path": "/api/system-settings/:category/:key",
          "response": {
            "setting": "SystemSettings"
          },
          "description": "Get specific system setting"
        },
        "update": {
          "method": "PUT",
          "path": "/api/system-settings/:category/:key",
          "body": {
            "value": "any",
            "type": "SettingType?"
          },
          "response": {
            "setting": "SystemSettings"
          },
          "description": "Update system setting value"
        },
        "bulkUpdate": {
          "method": "PUT",
          "path": "/api/system-settings/bulk",
          "body": {
            "settings": "Record<string, {value: any, type?: SettingType}>"
          },
          "response": {
            "settings": "SystemSettings[]"
          },
          "description": "Update multiple system settings"
        }
      },
      "businessHours": {
        "get": {
          "method": "GET",
          "path": "/api/business-hours",
          "response": {
            "hours": "BusinessHours[]"
          },
          "description": "Get business hours configuration"
        },
        "update": {
          "method": "PUT",
          "path": "/api/business-hours",
          "body": {
            "hours": "BusinessHoursInput[]"
          },
          "response": {
            "hours": "BusinessHours[]"
          },
          "description": "Update business hours configuration"
        },
        "isBusinessTime": {
          "method": "GET",
          "path": "/api/business-hours/is-open",
          "query_params": [
            "timestamp"
          ],
          "response": {
            "isOpen": "boolean",
            "nextOpen": "date?",
            "nextClose": "date?"
          },
          "description": "Check if given timestamp is within business hours"
        }
      },
      "holidays": {
        "list": {
          "method": "GET",
          "path": "/api/holidays",
          "query_params": [
            "year"
          ],
          "response": {
            "holidays": "Holiday[]"
          },
          "description": "Get holidays, optionally filtered by year"
        },
        "create": {
          "method": "POST",
          "path": "/api/holidays",
          "body": {
            "name": "string",
            "date": "date",
            "isRecurring": "boolean?"
          },
          "response": {
            "holiday": "Holiday"
          },
          "description": "Create new holiday"
        },
        "update": {
          "method": "PUT",
          "path": "/api/holidays/:id",
          "body": {
            "name": "string?",
            "date": "date?",
            "isRecurring": "boolean?"
          },
          "response": {
            "holiday": "Holiday"
          },
          "description": "Update holiday"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/holidays/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Delete holiday"
        }
      },
      "auditLogs": {
        "list": {
          "method": "GET",
          "path": "/api/audit-logs",
          "query_params": [
            "page",
            "limit",
            "userId",
            "entityType",
            "entityId",
            "action",
            "dateFrom",
            "dateTo",
            "search"
          ],
          "response": {
            "logs": "AuditLog[]",
            "total": "number",
            "page": "number",
            "limit": "number"
          },
          "description": "Get audit logs with comprehensive filtering"
        },
        "export": {
          "method": "POST",
          "path": "/api/audit-logs/export",
          "body": {
            "filters": "AuditLogFilters",
            "format": "ExportFormat"
          },
          "response": {
            "exportId": "string"
          },
          "description": "Export audit logs to file"
        }
      },
      "customFields": {
        "list": {
          "method": "GET",
          "path": "/api/custom-fields",
          "query_params": [
            "entityType"
          ],
          "response": {
            "fields": "CustomField[]"
          },
          "description": "Get custom fields for entity type"
        },
        "create": {
          "method": "POST",
          "path": "/api/custom-fields",
          "body": {
            "entityType": "string",
            "name": "string",
            "fieldType": "FieldType",
            "options": "any?",
            "isRequired": "boolean?",
            "defaultValue": "any?",
            "validationRules": "Record<string, any>?"
          },
          "response": {
            "field": "CustomField"
          },
          "description": "Create custom field"
        },
        "update": {
          "method": "PUT",
          "path": "/api/custom-fields/:id",
          "body": {
            "name": "string?",
            "fieldType": "FieldType?",
            "options": "any?",
            "isRequired": "boolean?",
            "isActive": "boolean?",
            "sortOrder": "number?",
            "defaultValue": "any?",
            "validationRules": "Record<string, any>?"
          },
          "response": {
            "field": "CustomField"
          },
          "description": "Update custom field"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/custom-fields/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Delete custom field"
        },
        "reorder": {
          "method": "PUT",
          "path": "/api/custom-fields/reorder",
          "body": {
            "fieldIds": "string[]"
          },
          "response": {
            "success": "boolean"
          },
          "description": "Reorder custom fields"
        }
      },
      "customFieldValues": {
        "get": {
          "method": "GET",
          "path": "/api/custom-field-values/:entityType/:entityId",
          "response": {
            "values": "CustomFieldValue[]"
          },
          "description": "Get custom field values for entity"
        },
        "set": {
          "method": "PUT",
          "path": "/api/custom-field-values/:entityType/:entityId",
          "body": {
            "values": "Record<string, any>"
          },
          "response": {
            "values": "CustomFieldValue[]"
          },
          "description": "Set custom field values for entity"
        }
      },
      "dataExports": {
        "list": {
          "method": "GET",
          "path": "/api/data-exports",
          "response": {
            "exports": "DataExport[]"
          },
          "description": "Get user's data export history"
        },
        "create": {
          "method": "POST",
          "path": "/api/data-exports",
          "body": {
            "entities": "string[]",
            "format": "ExportFormat"
          },
          "response": {
            "export": "DataExport"
          },
          "description": "Create new data export job"
        },
        "get": {
          "method": "GET",
          "path": "/api/data-exports/:id",
          "response": {
            "export": "DataExport"
          },
          "description": "Get export job status and details"
        },
        "download": {
          "method": "GET",
          "path": "/api/data-exports/:id/download",
          "response": "file",
          "description": "Download completed export file"
        }
      }
    },
    "ui_components": {
      "settingsNavigation": {
        "description": "Central navigation for all settings sections",
        "sections": [
          "Organization",
          "Users & Permissions",
          "System Defaults",
          "Business Hours",
          "Custom Fields",
          "Integrations",
          "Audit Log",
          "Data Export",
          "Search"
        ],
        "features": [
          "Search across all settings",
          "Recent settings history",
          "Quick access to frequently used settings",
          "Admin-only sections clearly marked"
        ]
      },
      "organizationSettings": {
        "description": "Organization profile and basic settings",
        "fields": [
          "Organization name",
          "Domain/subdomain",
          "Timezone selection",
          "Locale/language",
          "Currency settings",
          "Logo and branding",
          "Contact information"
        ]
      },
      "userManagement": {
        "description": "User accounts, roles, and permissions",
        "features": [
          "User list with roles and status",
          "Add/edit user accounts",
          "Role assignment (Owner, Admin, Manager, Sales, Operations, Support, Viewer)",
          "Password reset and account locking",
          "User activity and login history",
          "Bulk user operations"
        ]
      },
      "systemDefaults": {
        "description": "Global system default values",
        "categories": {
          "orders": [
            "Default status",
            "Payment terms",
            "Shipping settings"
          ],
          "quotes": [
            "Validity period",
            "Default terms",
            "Pricing rules"
          ],
          "financial": [
            "Tax rates",
            "Payment terms",
            "Currency settings"
          ],
          "formatting": [
            "Date formats",
            "Number formats",
            "Time zone"
          ]
        }
      },
      "businessHours": {
        "description": "Business hours and holiday configuration",
        "features": [
          "Weekly schedule with time ranges",
          "Day enable/disable toggles",
          "Holiday calendar management",
          "Time zone configuration",
          "Business hours validation and conflict detection"
        ]
      },
      "customFields": {
        "description": "Dynamic field creation and management",
        "entityTypes": [
          "customers",
          "orders",
          "products",
          "suppliers"
        ],
        "fieldTypes": [
          "text",
          "number",
          "date",
          "select",
          "checkbox",
          "textarea"
        ],
        "features": [
          "Field creation wizard",
          "Validation rule configuration",
          "Field ordering and grouping",
          "Usage analytics and reporting",
          "Field migration and data handling"
        ]
      },
      "integrationsHub": {
        "description": "Third-party integration management",
        "integrations": [
          {
            "name": "Xero",
            "purpose": "Accounting sync"
          },
          {
            "name": "Resend",
            "purpose": "Email delivery"
          },
          {
            "name": "Trigger.dev",
            "purpose": "Background jobs"
          },
          {
            "name": "Supabase",
            "purpose": "File storage"
          }
        ],
        "features": [
          "Connection status monitoring",
          "Configuration management",
          "Health checks and testing",
          "Usage statistics and limits",
          "Disconnect and reconnect workflows"
        ]
      },
      "auditLogViewer": {
        "description": "Comprehensive audit trail interface",
        "features": [
          "Advanced filtering (user, action, entity, date range)",
          "Search across all audit fields",
          "Export capabilities (CSV, PDF)",
          "Real-time audit streaming",
          "Audit retention and archiving",
          "Compliance reporting"
        ]
      },
      "dataExport": {
        "description": "Data portability and backup tools",
        "features": [
          "Entity selection for export",
          "Multiple format support (CSV, JSON, XLSX)",
          "Background processing for large exports",
          "Export history and download management",
          "Data anonymization options",
          "Scheduled automated exports"
        ]
      },
      "settingsSearch": {
        "description": "Global search across all settings",
        "features": [
          "Real-time search with highlighting",
          "Category filtering and navigation",
          "Recent searches and bookmarks",
          "Keyboard shortcuts (Cmd/Ctrl+K)",
          "Search result previews and quick actions"
        ]
      }
    },
    "business_rules": {
      "user_permissions": {
        "owner": "Full access, billing, org settings, can delete org",
        "admin": "Full data access, user management, cannot delete org",
        "manager": "Department-level access, report generation",
        "sales": "Customer, pipeline, order access",
        "operations": "Inventory, fulfillment, supplier access",
        "support": "Issue, warranty, customer read access",
        "viewer": "Read-only access across all domains"
      },
      "setting_inheritance": {
        "organization": "Default settings applied organization-wide",
        "user": "User preferences override organization defaults",
        "entity": "Entity-specific settings override user preferences",
        "contextual": "Context-specific overrides for specific operations"
      },
      "audit_requirements": {
        "all_changes": "All setting changes are audited with user, timestamp, old/new values",
        "sensitive_data": "Passwords and API keys are masked in audit logs",
        "retention": "Audit logs retained for 7 years for compliance",
        "export": "Audit logs exportable for regulatory compliance"
      },
      "data_export": {
        "formats": "CSV for spreadsheets, JSON for APIs, XLSX for business users",
        "size_limits": "Maximum 1GB per export, pagination for larger datasets",
        "anonymization": "Personal data can be anonymized for testing/development",
        "expiration": "Export files expire after 7 days for security",
        "rate_limiting": "Maximum 5 concurrent exports per organization"
      },
      "custom_fields": {
        "validation": "Required fields validated, custom regex patterns supported",
        "performance": "Maximum 50 custom fields per entity type",
        "indexing": "Frequently searched fields automatically indexed",
        "migration": "Safe data migration when field definitions change",
        "permissions": "Field-level permissions for viewing/editing"
      },
      "business_hours": {
        "timezone": "All times stored in organization timezone, converted for display",
        "overlaps": "Business hour ranges cannot overlap",
        "holidays": "Holidays override business hours (closed)",
        "weekends": "Saturday/Sunday treated as non-business days by default",
        "exceptions": "Support for special business hours on specific dates"
      }
    },
    "integrations": {
      "authentication": {
        "user_context": "All settings operations include authenticated user context",
        "role_validation": "Settings access validated against user roles",
        "audit_trail": "All setting changes include user attribution",
        "session_management": "Settings respect user sessions and timeouts"
      },
      "audit_system": {
        "automatic_logging": "All CRUD operations automatically logged",
        "change_tracking": "Old and new values captured for all changes",
        "search_indexing": "Audit logs indexed for fast searching and filtering",
        "compliance_export": "Audit data exportable for regulatory requirements"
      },
      "file_storage": {
        "export_files": "Data exports stored securely with access controls",
        "temp_files": "Temporary files cleaned up automatically",
        "file_validation": "Uploaded files validated for type and size",
        "cdn_delivery": "Large export files delivered via CDN for performance"
      },
      "email_system": {
        "export_notifications": "Email notifications for completed exports",
        "audit_alerts": "Email alerts for sensitive setting changes",
        "scheduled_reports": "Email delivery for automated report exports",
        "template_support": "Customizable email templates for notifications"
      },
      "background_jobs": {
        "export_processing": "Large data exports processed asynchronously",
        "scheduled_reports": "Automated report generation and delivery",
        "cleanup_tasks": "Automatic cleanup of expired files and temp data",
        "maintenance_jobs": "Database optimization and index rebuilding"
      }
    },
    "performance_requirements": {
      "response_times": {
        "settings_load": "< 500 milliseconds",
        "search_results": "< 200 milliseconds",
        "setting_save": "< 300 milliseconds",
        "audit_query": "< 1 second for 1000 records"
      },
      "scalability": {
        "concurrent_users": "50 simultaneous settings users",
        "audit_throughput": "1000 audit events per minute",
        "export_capacity": "10 concurrent export jobs",
        "search_performance": "Sub-second search across 100k settings"
      },
      "data_volume": {
        "audit_retention": "10 million audit records",
        "user_preferences": "10,000 active user preference sets",
        "custom_fields": "1,000 active custom field definitions",
        "data_exports": "100 active export files"
      },
      "reliability": {
        "uptime_target": "99.9% availability for settings operations",
        "data_durability": "100% audit log durability",
        "backup_frequency": "Daily automated backups",
        "disaster_recovery": "4-hour RTO, 1-hour RPO for critical settings"
      }
    }
  },
  "stories": [
    {
      "id": "SET-CORE-SCHEMA",
      "name": "Configuration Core Schema",
      "description": "Create all settings-related database tables with proper relationships and constraints",
      "type": "schema",
      "acceptance_criteria": [
        "Complete organizations, users, userPreferences tables with all fields",
        "systemSettings table for global configuration",
        "businessHours and holidays tables for scheduling",
        "auditLogs table for comprehensive change tracking",
        "customFields and customFieldValues tables for extensibility",
        "dataExports table for backup and portability",
        "All foreign key relationships and indexes properly defined",
        "RLS policies for organization-level data isolation",
        "TypeScript types exported for all entities"
      ],
      "files_to_modify": [
        "src/lib/schema/organizations.ts",
        "src/lib/schema/users.ts",
        "src/lib/schema/user-preferences.ts",
        "src/lib/schema/system-settings.ts",
        "src/lib/schema/business-hours.ts",
        "src/lib/schema/holidays.ts",
        "src/lib/schema/audit-logs.ts",
        "src/lib/schema/custom-fields.ts",
        "src/lib/schema/custom-field-values.ts",
        "src/lib/schema/data-exports.ts",
        "src/lib/schema/index.ts",
        "drizzle/migrations/007_settings.ts"
      ],
      "completion_promise": "SET_CORE_SCHEMA_COMPLETE",
      "estimated_iterations": 2,
      "uiPatterns": {
        "pattern": "n/a",
        "description": "Schema-only story - no UI components"
      },
      "status": "pending"
    },
    {
      "id": "SET-CORE-API",
      "name": "Configuration Core API",
      "description": "Implement CRUD operations and queries for all settings entities",
      "type": "server-function",
      "acceptance_criteria": [
        "Complete organizations API with settings management",
        "Full users API with preferences and profile management",
        "Comprehensive systemSettings API with validation",
        "Business hours and holidays management endpoints",
        "Audit log API with advanced filtering and search",
        "Custom fields CRUD with validation and ordering",
        "Data export job management and file handling",
        "All endpoints include proper error handling and RLS",
        "Zod schemas for all request/response validation"
      ],
      "files_to_modify": [
        "src/server/functions/organizations.ts",
        "src/server/functions/users.ts",
        "src/server/functions/system-settings.ts",
        "src/server/functions/business-hours.ts",
        "src/server/functions/holidays.ts",
        "src/server/functions/audit-logs.ts",
        "src/server/functions/custom-fields.ts",
        "src/server/functions/data-exports.ts",
        "src/lib/schemas/settings.ts"
      ],
      "dependencies": [
        "SET-CORE-SCHEMA"
      ],
      "completion_promise": "SET_CORE_API_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "n/a",
        "description": "Server API-only story - no UI components"
      },
      "status": "pending"
    },
    {
      "id": "SET-NAVIGATION-UI",
      "name": "Settings Navigation System",
      "description": "Create unified navigation and layout for all settings sections",
      "type": "ui-component",
      "acceptance_criteria": [
        "Responsive sidebar navigation with all settings sections",
        "Search functionality across all settings pages",
        "Breadcrumb navigation for deep settings",
        "Role-based menu visibility (admin vs regular users)",
        "Recently visited settings tracking",
        "Keyboard shortcuts for quick navigation",
        "Mobile-responsive drawer navigation",
        "Loading states and error boundaries"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/index.tsx",
        "src/components/settings/settings-navigation.tsx",
        "src/components/settings/settings-layout.tsx",
        "src/components/settings/settings-search.tsx"
      ],
      "dependencies": [
        "SET-CORE-API"
      ],
      "completion_promise": "SET_NAVIGATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "SecondaryMenu Navigation + Max-Width Layout",
        "components": [
          "SecondaryMenu (Midday) - Horizontal tab-style navigation with border-bottom",
          "Max-width container (800px) for content focus",
          "Nested route layout with shared navigation wrapper"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/layout.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/secondary-menu.tsx"
        ],
        "implementation_notes": [
          "Use SecondaryMenu with items array for tab-like navigation",
          "Wrap content in max-w-[800px] container for readability",
          "Navigation persists across all settings pages via shared layout",
          "Active state automatically handled by routing"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-ORGANIZATION-UI",
      "name": "Organization Settings Interface",
      "description": "Organization profile, branding, and basic configuration UI",
      "type": "ui-component",
      "acceptance_criteria": [
        "Organization name, domain, and contact information forms",
        "Timezone, locale, and currency selection",
        "Logo upload and branding customization",
        "Settings validation and conflict detection",
        "Change preview and confirmation dialogs",
        "Integration status display for connected systems",
        "Audit trail for organization changes"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/organization.tsx",
        "src/components/settings/organization-form.tsx",
        "src/components/settings/branding-upload.tsx",
        "src/components/settings/integration-status.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_ORGANIZATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Vertical Card Stack Pattern",
        "components": [
          "Card (shadcn/ui) - Container for each setting section",
          "CardHeader with CardTitle and CardDescription",
          "CardContent for form inputs",
          "CardFooter for help text + SubmitButton",
          "Form + FormField (react-hook-form + zod)"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/company-name.tsx",
          "_reference/.midday-reference/apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/page.tsx"
        ],
        "implementation_notes": [
          "Each setting = separate Card in space-y-12 container",
          "Form validation with zod schema",
          "SubmitButton shows loading state during mutation",
          "CardFooter split: left for help text, right for action button",
          "Use max-w-[300px] on inputs for visual consistency"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-USERS-UI",
      "name": "User Management Interface",
      "description": "Complete user administration with roles and permissions",
      "type": "ui-component",
      "acceptance_criteria": [
        "User list with roles, status, and activity indicators",
        "Add/edit user forms with role assignment",
        "Bulk user operations (activate, deactivate, change roles)",
        "Password reset and account recovery",
        "User activity logs and login history",
        "Permission matrix visualization",
        "Two-factor authentication setup",
        "Account deactivation and data export"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/users.tsx",
        "src/components/settings/user-list.tsx",
        "src/components/settings/user-form.tsx",
        "src/components/settings/role-management.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_USERS_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Tabs + DataTable Pattern",
        "components": [
          "Tabs (shadcn/ui) - Section switcher",
          "TabsList with transparent background + border-bottom",
          "DataTable component for user lists",
          "Suspense boundaries with skeleton loaders"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/team-members.tsx",
          "_reference/.midday-reference/apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/members/page.tsx"
        ],
        "implementation_notes": [
          "Tabs for Active Users vs Pending Invitations",
          "TabsList uses transparent bg + border-bottom styling",
          "DataTable wrapped in Suspense with custom skeleton",
          "Each tab fetches data independently via tRPC prefetch",
          "Use TabsTrigger with minimal padding (p-0 m-0)"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-SYSTEM-DEFAULTS-UI",
      "name": "System Defaults Configuration",
      "description": "Global default values for orders, quotes, and business rules",
      "type": "ui-component",
      "acceptance_criteria": [
        "Organized categories: Orders, Quotes, Financial, Formatting",
        "Default value forms with validation",
        "Preview of how defaults appear in forms",
        "Override capability indicators",
        "Default usage analytics and adoption tracking",
        "Reset to system defaults option",
        "Change impact assessment before saving"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/defaults.tsx",
        "src/components/settings/defaults-form.tsx",
        "src/components/settings/defaults-preview.tsx",
        "src/components/settings/defaults-analytics.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_SYSTEM_DEFAULTS_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Vertical Card Stack with Category Grouping",
        "components": [
          "Card components for each category (Orders, Quotes, Financial, Formatting)",
          "Nested CardContent sections for related settings",
          "Form components with Zod validation",
          "SubmitButton with loading states"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/company-name.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/display-name.tsx"
        ],
        "implementation_notes": [
          "Group related defaults in single Card (e.g., all financial settings together)",
          "Use descriptive CardDescription to explain impact of defaults",
          "Consider accordion pattern for collapsible category sections",
          "Show visual preview or example when default value changes"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-BUSINESS-HOURS-UI",
      "name": "Business Hours Configuration",
      "description": "Weekly schedule and holiday management interface",
      "type": "ui-component",
      "acceptance_criteria": [
        "Visual weekly calendar with time slot selection",
        "Day enable/disable toggles with visual feedback",
        "Holiday calendar with recurring holiday support",
        "Timezone selection with automatic conversion",
        "Business hours conflict detection",
        "SLA calculation preview",
        "Bulk schedule operations",
        "Schedule export and import"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/business-hours.tsx",
        "src/components/settings/business-hours-calendar.tsx",
        "src/components/settings/holidays-manager.tsx",
        "src/components/settings/timezone-selector.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_BUSINESS_HOURS_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Card-Based Form with Visual Schedule",
        "components": [
          "Card wrapper for business hours section",
          "Custom weekly calendar component (7 rows for days)",
          "Time pickers for start/end times",
          "Switch/Toggle for day enable/disable",
          "Separate Card for holidays list/calendar"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/base-currency/base-currency.tsx"
        ],
        "implementation_notes": [
          "Use grid layout for days of week (Monday-Sunday)",
          "Each day row: Day name + Enable toggle + Start time + End time",
          "Validate end time > start time client-side",
          "Highlight conflicts visually (overlapping times)",
          "Holiday management in separate card below schedule"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-CUSTOM-FIELDS-UI",
      "name": "Custom Fields Builder",
      "description": "Dynamic field creation and management for all entity types",
      "type": "ui-component",
      "acceptance_criteria": [
        "Entity type selection and field list management",
        "Field creation wizard with type selection",
        "Field configuration: validation rules, options, defaults",
        "Drag-and-drop field ordering",
        "Field usage analytics and reporting",
        "Field migration tools for existing data",
        "Field permissions and visibility controls",
        "Field testing and validation tools"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/custom-fields.tsx",
        "src/components/settings/field-builder.tsx",
        "src/components/settings/field-configurator.tsx",
        "src/components/settings/field-ordering.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_CUSTOM_FIELDS_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Tabs + DataTable + Dialog Pattern",
        "components": [
          "Tabs for entity type selection (Customers, Orders, Products, Suppliers)",
          "DataTable showing existing custom fields",
          "Dialog for adding/editing fields",
          "Drag-and-drop reorder component",
          "Form with conditional fields based on field type"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/team-members.tsx"
        ],
        "implementation_notes": [
          "Top-level tabs for entity types",
          "Each tab shows DataTable of fields for that entity",
          "Add Field button opens Dialog with multi-step form",
          "Field list supports drag-and-drop reordering",
          "Field type selection changes available configuration options"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-INTEGRATIONS-UI",
      "name": "Integrations Management Hub",
      "description": "Third-party integration configuration and monitoring",
      "type": "ui-component",
      "acceptance_criteria": [
        "Integration cards with status indicators",
        "Connection configuration forms",
        "Health check and testing capabilities",
        "Usage statistics and rate limiting display",
        "Integration event logs and error tracking",
        "Reconnect and disconnect workflows",
        "API key management with security",
        "Integration documentation and help"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/integrations.tsx",
        "src/components/settings/integration-card.tsx",
        "src/components/settings/integration-config.tsx",
        "src/components/settings/integration-monitor.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_INTEGRATIONS_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Grid of Integration Cards",
        "components": [
          "Grid layout for integration cards (2-3 columns)",
          "Card per integration with logo/icon",
          "Badge for connection status (Connected/Disconnected/Error)",
          "Dialog for configuration settings",
          "Alert/Banner for connection issues"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/apps.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/app.tsx"
        ],
        "implementation_notes": [
          "Grid of Cards, each representing one integration",
          "Card shows: Integration logo, name, status badge, brief description",
          "Click card to open Dialog with configuration form",
          "Visual status indicators (green dot = connected, red = error)",
          "Test Connection button to verify integration health"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-AUDIT-UI",
      "name": "Audit Log Explorer",
      "description": "Comprehensive audit trail viewing and analysis",
      "type": "ui-component",
      "acceptance_criteria": [
        "Advanced filtering: user, action, entity, date range",
        "Real-time audit streaming",
        "Search across all audit fields",
        "Export capabilities with format options",
        "Audit visualization and trends",
        "Compliance reporting tools",
        "Audit retention management",
        "Anomaly detection and alerting"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/audit-log.tsx",
        "src/components/settings/audit-filters.tsx",
        "src/components/settings/audit-table.tsx",
        "src/components/settings/audit-export.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_AUDIT_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Filters + DataTable + Export Actions",
        "components": [
          "Filter bar with user, action, entity, date range selectors",
          "DataTable with expandable rows for details",
          "Export button with format selection (CSV, PDF)",
          "Badge components for action types",
          "Pagination for large result sets"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/team-members.tsx"
        ],
        "implementation_notes": [
          "Filter bar above DataTable with common filters always visible",
          "Advanced filters in collapsible section or Dialog",
          "Expandable table rows show old/new values diff",
          "Use Badge components to color-code action types (create=green, delete=red, etc.)",
          "Export button in table header with format dropdown"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-DATA-EXPORT-UI",
      "name": "Data Export Portal",
      "description": "Data portability and backup management interface",
      "type": "ui-component",
      "acceptance_criteria": [
        "Entity selection with dependency awareness",
        "Export format options with previews",
        "Background job status tracking",
        "Download management with expiration handling",
        "Scheduled export configuration",
        "Export history and re-download",
        "Data anonymization options",
        "Export size and performance warnings"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/data-export.tsx",
        "src/components/settings/export-wizard.tsx",
        "src/components/settings/export-history.tsx",
        "src/components/settings/export-scheduler.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_DATA_EXPORT_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Wizard Form + Status Table",
        "components": [
          "Multi-step wizard in Card for new export",
          "Checkbox group for entity selection",
          "Radio group for format selection (CSV, JSON, XLSX)",
          "DataTable showing export history with status badges",
          "Progress indicator for in-progress exports"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/company-name.tsx"
        ],
        "implementation_notes": [
          "Top section: Create New Export card with wizard steps",
          "Step 1: Select entities (checkboxes with dependency warnings)",
          "Step 2: Choose format with preview",
          "Step 3: Review and submit",
          "Bottom section: Export History table with download links",
          "Show progress bar or spinner for processing exports"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-PREFERENCES-UI",
      "name": "User Preferences Interface",
      "description": "Personal user settings and preferences management",
      "type": "ui-component",
      "acceptance_criteria": [
        "Theme and appearance preferences",
        "Notification and communication settings",
        "Language and localization options",
        "Dashboard and layout preferences",
        "Shortcut and accessibility settings",
        "Data export and privacy preferences",
        "Preference categories with search",
        "Preference reset and backup"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/preferences.tsx",
        "src/components/settings/preference-categories.tsx",
        "src/components/settings/theme-selector.tsx",
        "src/components/settings/notification-settings.tsx"
      ],
      "dependencies": [
        "SET-NAVIGATION-UI"
      ],
      "completion_promise": "SET_PREFERENCES_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "Vertical Card Stack Pattern",
        "components": [
          "Card per preference category",
          "Theme selector with visual previews",
          "Switch/Toggle components for boolean preferences",
          "Select dropdowns for options (language, locale)",
          "CardFooter with save buttons per section"
        ],
        "references": [
          "_reference/.midday-reference/apps/dashboard/src/components/account-settings.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/display-name.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/change-theme.tsx"
        ],
        "implementation_notes": [
          "Each preference category in separate Card (space-y-12 container)",
          "Personal settings like avatar, display name first",
          "Theme selector shows visual theme previews",
          "Use Switch components for toggles (notifications on/off)",
          "Separate save button per card for granular updates"
        ]
      },
      "status": "pending"
    },
    {
      "id": "SET-INTEGRATION-API",
      "name": "Settings Integration Layer",
      "description": "Integration points for settings usage throughout the application",
      "type": "server-function",
      "acceptance_criteria": [
        "Settings context provider for React components",
        "Settings hooks for common setting access patterns",
        "Settings caching and performance optimization",
        "Settings validation middleware",
        "Settings change broadcasting and cache invalidation",
        "Settings migration utilities for updates",
        "Settings testing utilities and mocks"
      ],
      "files_to_modify": [
        "src/contexts/settings-context.tsx",
        "src/hooks/use-settings.ts",
        "src/lib/settings-cache.ts",
        "src/middleware/settings-validation.ts"
      ],
      "dependencies": [
        "SET-CORE-API"
      ],
      "completion_promise": "SET_INTEGRATION_API_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "pattern": "n/a",
        "description": "Integration layer - uses React hooks and context patterns but no direct UI"
      },
      "status": "pending"
    }
  ],
  "success_criteria": [
    "Complete configuration management system with centralized settings",
    "Role-based access control for all settings operations",
    "Comprehensive audit trail for all configuration changes",
    "Flexible custom fields system for business-specific data",
    "Business hours integration with SLA and scheduling systems",
    "Data portability with comprehensive export capabilities",
    "Real-time settings synchronization across all application components",
    "Performance-optimized settings loading and caching",
    "Mobile-responsive settings interfaces with touch interactions",
    "Complete internationalization and localization support",
    "Integration monitoring and health checking for connected systems",
    "Automated settings validation and conflict detection",
    "Settings search and discovery capabilities",
    "Granular permission system for settings access and modification"
  ],
  "out_of_scope": [
    "Multi-organization management (single org focus)",
    "Advanced user permission matrices beyond basic roles",
    "Real-time collaborative settings editing",
    "Settings version control and rollback",
    "Advanced analytics on settings usage patterns",
    "Machine learning-based settings optimization",
    "Third-party settings marketplace or templates",
    "Settings API for external integrations"
  ],
  "migration_notes": {
    "existing_data": "If existing user preferences or basic organization settings exist, migration scripts needed to transform to new schema structure",
    "audit_history": "Existing audit logs may need transformation to new structured format",
    "custom_fields": "Any existing custom field implementations need mapping to new flexible system",
    "permissions": "User roles and permissions need alignment with new settings access controls"
  }
}