{
  "id": "DOM-USERS",
  "name": "User Management and Team Administration System",
  "description": "Complete identity management, team organization, and user lifecycle platform providing secure user access control, team collaboration tools, delegation workflows, and comprehensive user administration capabilities across the entire application.",
  "created": "2026-01-10",
  "updated": "2026-01-10",
  "priority": 5,
  "phase": "core-foundation",
  "version": "1.0",
  "enumSource": "$ref:../foundation/canonical-enums.json",
  "business_value": {
    "security_foundation": true,
    "team_collaboration": true,
    "user_experience": true,
    "description": "Essential identity and access management system enabling secure, collaborative, and personalized user experiences"
  },
  "system_requirements": {
    "database": {
      "organizations": {
        "description": "Organization-level configuration and settings",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "name": "varchar(255) NOT NULL",
          "domain": "varchar(255) UNIQUE",
          "settings": "jsonb DEFAULT '{}'",
          "timezone": "varchar(50) DEFAULT 'Australia/Sydney'",
          "locale": "varchar(10) DEFAULT 'en-AU'",
          "currency": "varchar(3) DEFAULT 'AUD'",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "domain",
          "name"
        ],
        "constraints": [
          "settings IS NOT NULL"
        ]
      },
      "users": {
        "description": "Complete user identity and profile management",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id) ON DELETE CASCADE",
          "email": "varchar(255) UNIQUE NOT NULL",
          "firstName": "varchar(100)",
          "lastName": "varchar(100)",
          "avatarUrl": "text",
          "role": "enum('owner', 'admin', 'manager', 'sales', 'operations', 'support', 'viewer') DEFAULT 'viewer'",
          "status": "enum('active', 'invited', 'suspended', 'deactivated') DEFAULT 'invited'",
          "lastLoginAt": "timestamp",
          "lastActiveAt": "timestamp",
          "passwordResetToken": "varchar(255)",
          "passwordResetExpires": "timestamp",
          "emailVerified": "boolean DEFAULT false",
          "emailVerificationToken": "varchar(255)",
          "invitedBy": "uuid REFERENCES users(id)",
          "invitedAt": "timestamp",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "organizationId",
          "email",
          "role",
          "status",
          "lastLoginAt"
        ],
        "constraints": [
          "email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$'",
          "firstName IS NOT NULL OR lastName IS NOT NULL"
        ]
      },
      "userPreferences": {
        "description": "Personalized user settings and preferences",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "userId": "uuid NOT NULL REFERENCES users(id)",
          "category": "varchar(50) NOT NULL",
          "key": "varchar(100) NOT NULL",
          "value": "jsonb NOT NULL",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "userId",
          "category",
          "key"
        ],
        "constraints": [
          "value IS NOT NULL"
        ],
        "unique": [
          "userId",
          "category",
          "key"
        ]
      },
      "userGroups": {
        "description": "Team and group organization for collaboration",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "name": "varchar(100) NOT NULL",
          "description": "text",
          "color": "varchar(7)",
          "isActive": "boolean DEFAULT true",
          "createdBy": "uuid NOT NULL REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "organizationId",
          "name",
          "isActive"
        ],
        "constraints": [
          "name IS NOT NULL"
        ]
      },
      "userGroupMembers": {
        "description": "Group membership with roles",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id) ON DELETE CASCADE",
          "groupId": "uuid NOT NULL REFERENCES userGroups(id)",
          "userId": "uuid NOT NULL REFERENCES users(id)",
          "role": "enum('member', 'lead', 'manager') DEFAULT 'member'",
          "joinedAt": "timestamp NOT NULL DEFAULT NOW()",
          "addedBy": "uuid NOT NULL REFERENCES users(id)",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "organizationId",
          "groupId",
          "userId",
          "role"
        ],
        "unique": [
          "groupId",
          "userId"
        ]
      },
      "userDelegations": {
        "description": "Out-of-office delegation management",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "delegatorId": "uuid NOT NULL REFERENCES users(id)",
          "delegateId": "uuid NOT NULL REFERENCES users(id)",
          "startDate": "timestamp NOT NULL",
          "endDate": "timestamp NOT NULL",
          "reason": "text",
          "isActive": "boolean DEFAULT true",
          "createdBy": "uuid NOT NULL REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "organizationId",
          "delegatorId",
          "delegateId",
          "startDate",
          "endDate",
          "isActive"
        ],
        "constraints": [
          "startDate < endDate",
          "delegatorId != delegateId"
        ]
      },
      "userInvitations": {
        "description": "User invitation tracking and management",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "email": "varchar(255) NOT NULL",
          "role": "enum('owner', 'admin', 'manager', 'sales', 'operations', 'support', 'viewer') NOT NULL",
          "invitedBy": "uuid NOT NULL REFERENCES users(id)",
          "invitedAt": "timestamp NOT NULL DEFAULT NOW()",
          "expiresAt": "timestamp NOT NULL",
          "acceptedAt": "timestamp",
          "personalMessage": "text",
          "token": "varchar(255) UNIQUE NOT NULL",
          "status": "enum('pending', 'accepted', 'expired', 'cancelled') DEFAULT 'pending'",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "organizationId",
          "email",
          "token",
          "status",
          "expiresAt"
        ],
        "constraints": [
          "expiresAt > invitedAt"
        ]
      },
      "userOnboarding": {
        "description": "Per-user onboarding progress tracking",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "userId": "uuid NOT NULL REFERENCES users(id)",
          "stepKey": "varchar(50) NOT NULL",
          "stepName": "varchar(100) NOT NULL",
          "isCompleted": "boolean DEFAULT false",
          "completedAt": "timestamp",
          "dismissedAt": "timestamp",
          "metadata": "jsonb DEFAULT '{}'",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "userId",
          "stepKey",
          "isCompleted"
        ],
        "unique": [
          "userId",
          "stepKey"
        ]
      },
      "userSessions": {
        "description": "Active user session tracking for security",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "userId": "uuid NOT NULL REFERENCES users(id)",
          "sessionToken": "varchar(255) UNIQUE NOT NULL",
          "ipAddress": "inet",
          "userAgent": "text",
          "expiresAt": "timestamp NOT NULL",
          "createdBy": "uuid REFERENCES users(id)",
          "updatedBy": "uuid REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()",
          "version": "integer NOT NULL DEFAULT 1"
        },
        "indexes": [
          "userId",
          "sessionToken",
          "expiresAt"
        ],
        "constraints": [
          "expiresAt > createdAt"
        ]
      },
      "auditLogs": {
        "description": "Comprehensive audit trail for all user-related changes",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "userId": "uuid REFERENCES users(id)",
          "action": "varchar(100) NOT NULL",
          "entityType": "varchar(50) NOT NULL",
          "entityId": "uuid",
          "oldValues": "jsonb",
          "newValues": "jsonb",
          "ipAddress": "inet",
          "userAgent": "text",
          "timestamp": "timestamp NOT NULL DEFAULT NOW()",
          "metadata": "jsonb DEFAULT '{}'"
        },
        "indexes": [
          "organizationId",
          "userId",
          "entityType",
          "entityId",
          "timestamp"
        ],
        "constraints": [
          "timestamp IS NOT NULL"
        ]
      }
    },
    "api_endpoints": {
      "auth": {
        "login": {
          "method": "POST",
          "path": "/api/auth/login",
          "body": {
            "email": "string",
            "password": "string",
            "rememberMe": "boolean?"
          },
          "response": {
            "user": "User",
            "session": "Session",
            "organization": "Organization"
          },
          "description": "Authenticate user and create session"
        },
        "logout": {
          "method": "POST",
          "path": "/api/auth/logout",
          "response": {
            "success": "boolean"
          },
          "description": "Destroy current user session"
        },
        "register": {
          "method": "POST",
          "path": "/api/auth/register",
          "body": {
            "email": "string",
            "password": "string",
            "firstName": "string?",
            "lastName": "string?",
            "organizationName": "string?"
          },
          "response": {
            "user": "User",
            "organization": "Organization"
          },
          "description": "Register new user and organization"
        },
        "verifyEmail": {
          "method": "POST",
          "path": "/api/auth/verify-email",
          "body": {
            "token": "string"
          },
          "response": {
            "success": "boolean"
          },
          "description": "Verify user email address"
        },
        "resetPassword": {
          "method": "POST",
          "path": "/api/auth/reset-password",
          "body": {
            "email": "string"
          },
          "response": {
            "success": "boolean"
          },
          "description": "Send password reset email"
        },
        "updatePassword": {
          "method": "POST",
          "path": "/api/auth/update-password",
          "body": {
            "token": "string",
            "password": "string"
          },
          "response": {
            "success": "boolean"
          },
          "description": "Update password using reset token"
        }
      },
      "users": {
        "list": {
          "method": "GET",
          "path": "/api/users",
          "query_params": [
            "page",
            "limit",
            "role",
            "status",
            "groupId",
            "search",
            "sortBy",
            "sortDir"
          ],
          "response": {
            "users": "User[]",
            "total": "number",
            "page": "number",
            "limit": "number"
          },
          "description": "List users with filtering and pagination"
        },
        "get": {
          "method": "GET",
          "path": "/api/users/:id",
          "response": {
            "user": "User",
            "groups": "UserGroup[]",
            "delegations": "UserDelegation[]",
            "preferences": "UserPreferences[]",
            "activity": "AuditLog[]"
          },
          "description": "Get complete user details"
        },
        "create": {
          "method": "POST",
          "path": "/api/users",
          "body": {
            "email": "string",
            "firstName": "string?",
            "lastName": "string?",
            "role": "UserRole",
            "groups": "uuid[]?"
          },
          "response": {
            "user": "User",
            "invitation": "UserInvitation"
          },
          "description": "Create user and send invitation"
        },
        "update": {
          "method": "PUT",
          "path": "/api/users/:id",
          "body": {
            "firstName": "string?",
            "lastName": "string?",
            "role": "UserRole?",
            "status": "UserStatus?",
            "groups": "uuid[]?"
          },
          "response": {
            "user": "User"
          },
          "description": "Update user information"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/users/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Deactivate user account"
        },
        "bulkUpdate": {
          "method": "PUT",
          "path": "/api/users/bulk",
          "body": {
            "userIds": "uuid[]",
            "updates": "Partial<User>"
          },
          "response": {
            "updated": "number",
            "failed": "number"
          },
          "description": "Bulk update multiple users"
        },
        "uploadAvatar": {
          "method": "POST",
          "path": "/api/users/:id/avatar",
          "body": {
            "file": "file"
          },
          "response": {
            "user": "User"
          },
          "description": "Upload user avatar image"
        }
      },
      "invitations": {
        "invite": {
          "method": "POST",
          "path": "/api/invitations",
          "body": {
            "email": "string",
            "role": "UserRole",
            "personalMessage": "string?",
            "groups": "uuid[]?"
          },
          "response": {
            "invitation": "UserInvitation"
          },
          "description": "Send user invitation"
        },
        "accept": {
          "method": "POST",
          "path": "/api/invitations/:token/accept",
          "body": {
            "password": "string",
            "firstName": "string?",
            "lastName": "string?"
          },
          "response": {
            "user": "User",
            "session": "Session"
          },
          "description": "Accept invitation and create account"
        },
        "resend": {
          "method": "POST",
          "path": "/api/invitations/:id/resend",
          "response": {
            "invitation": "UserInvitation"
          },
          "description": "Resend invitation email"
        },
        "cancel": {
          "method": "DELETE",
          "path": "/api/invitations/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Cancel pending invitation"
        },
        "list": {
          "method": "GET",
          "path": "/api/invitations",
          "query_params": [
            "status",
            "page",
            "limit"
          ],
          "response": {
            "invitations": "UserInvitation[]",
            "total": "number"
          },
          "description": "List invitations with filtering"
        }
      },
      "groups": {
        "list": {
          "method": "GET",
          "path": "/api/groups",
          "response": {
            "groups": "UserGroup[]"
          },
          "description": "Get all user groups"
        },
        "create": {
          "method": "POST",
          "path": "/api/groups",
          "body": {
            "name": "string",
            "description": "string?",
            "color": "string?"
          },
          "response": {
            "group": "UserGroup"
          },
          "description": "Create new user group"
        },
        "update": {
          "method": "PUT",
          "path": "/api/groups/:id",
          "body": {
            "name": "string?",
            "description": "string?",
            "color": "string?"
          },
          "response": {
            "group": "UserGroup"
          },
          "description": "Update group information"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/groups/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Delete user group"
        },
        "addMember": {
          "method": "POST",
          "path": "/api/groups/:id/members",
          "body": {
            "userId": "uuid",
            "role": "GroupRole?"
          },
          "response": {
            "membership": "UserGroupMember"
          },
          "description": "Add user to group"
        },
        "removeMember": {
          "method": "DELETE",
          "path": "/api/groups/:id/members/:userId",
          "response": {
            "success": "boolean"
          },
          "description": "Remove user from group"
        },
        "getMembers": {
          "method": "GET",
          "path": "/api/groups/:id/members",
          "response": {
            "members": "UserGroupMember[]"
          },
          "description": "Get group members"
        }
      },
      "delegations": {
        "create": {
          "method": "POST",
          "path": "/api/delegations",
          "body": {
            "delegateId": "uuid",
            "startDate": "date",
            "endDate": "date",
            "reason": "string?"
          },
          "response": {
            "delegation": "UserDelegation"
          },
          "description": "Create delegation for current user"
        },
        "update": {
          "method": "PUT",
          "path": "/api/delegations/:id",
          "body": {
            "startDate": "date?",
            "endDate": "date?",
            "reason": "string?"
          },
          "response": {
            "delegation": "UserDelegation"
          },
          "description": "Update delegation"
        },
        "cancel": {
          "method": "DELETE",
          "path": "/api/delegations/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Cancel delegation"
        },
        "getActive": {
          "method": "GET",
          "path": "/api/delegations/active",
          "response": {
            "delegations": "UserDelegation[]"
          },
          "description": "Get active delegations for current user"
        },
        "getAssigned": {
          "method": "GET",
          "path": "/api/delegations/assigned",
          "response": {
            "delegations": "UserDelegation[]"
          },
          "description": "Get delegations where current user is delegate"
        }
      },
      "preferences": {
        "get": {
          "method": "GET",
          "path": "/api/preferences",
          "query_params": [
            "category"
          ],
          "response": {
            "preferences": "UserPreferences[]"
          },
          "description": "Get user preferences"
        },
        "set": {
          "method": "PUT",
          "path": "/api/preferences",
          "body": {
            "preferences": "Record<string, any>"
          },
          "response": {
            "preferences": "UserPreferences[]"
          },
          "description": "Update user preferences"
        },
        "reset": {
          "method": "DELETE",
          "path": "/api/preferences",
          "query_params": [
            "category"
          ],
          "response": {
            "success": "boolean"
          },
          "description": "Reset preferences to defaults"
        }
      },
      "onboarding": {
        "getStatus": {
          "method": "GET",
          "path": "/api/onboarding/status",
          "response": {
            "steps": "UserOnboarding[]",
            "completed": "number",
            "total": "number"
          },
          "description": "Get onboarding progress"
        },
        "completeStep": {
          "method": "POST",
          "path": "/api/onboarding/steps/:stepKey/complete",
          "response": {
            "step": "UserOnboarding"
          },
          "description": "Mark onboarding step as complete"
        },
        "dismiss": {
          "method": "POST",
          "path": "/api/onboarding/dismiss",
          "response": {
            "success": "boolean"
          },
          "description": "Dismiss onboarding for user"
        }
      },
      "audit": {
        "getUserActivity": {
          "method": "GET",
          "path": "/api/users/:id/activity",
          "query_params": [
            "page",
            "limit",
            "action",
            "dateFrom",
            "dateTo"
          ],
          "response": {
            "activity": "AuditLog[]",
            "total": "number"
          },
          "description": "Get user activity log"
        },
        "exportUserData": {
          "method": "GET",
          "path": "/api/users/:id/export",
          "response": "file",
          "description": "Export user data for GDPR compliance"
        },
        "bulkExport": {
          "method": "POST",
          "path": "/api/users/bulk-export",
          "body": {
            "userIds": "uuid[]",
            "format": "ExportFormat"
          },
          "response": {
            "jobId": "string"
          },
          "description": "Bulk export user data"
        }
      }
    },
    "ui_components": {
      "authentication": {
        "description": "Complete authentication and registration flow",
        "loginForm": {
          "fields": [
            "email",
            "password",
            "remember me"
          ],
          "features": [
            "password reset",
            "email verification",
            "social login options"
          ]
        },
        "registrationForm": {
          "fields": [
            "email",
            "password",
            "organization name",
            "user details"
          ],
          "features": [
            "email verification",
            "organization setup",
            "invitation acceptance"
          ]
        },
        "passwordReset": {
          "features": [
            "secure token generation",
            "email delivery",
            "password strength validation"
          ]
        }
      },
      "userManagement": {
        "description": "Comprehensive user administration interface",
        "userList": {
          "columns": [
            "Name",
            "Email",
            "Role",
            "Status",
            "Last Login",
            "Groups"
          ],
          "features": [
            "filtering",
            "sorting",
            "bulk actions",
            "export"
          ],
          "actions": [
            "view",
            "edit",
            "deactivate",
            "reset password",
            "add to groups"
          ]
        },
        "userDetail": {
          "tabs": [
            "Profile",
            "Groups",
            "Delegations",
            "Activity",
            "Security"
          ],
          "features": [
            "complete profile editing",
            "group management",
            "delegation setup",
            "activity timeline",
            "security settings"
          ]
        },
        "userCreation": {
          "steps": [
            "Basic Info",
            "Role Assignment",
            "Group Membership",
            "Send Invitation"
          ],
          "features": [
            "bulk creation",
            "CSV import",
            "invitation customization"
          ]
        }
      },
      "teamOrganization": {
        "description": "Team and group management system",
        "groupList": {
          "features": [
            "create groups",
            "edit group details",
            "member management",
            "group hierarchy"
          ],
          "display": [
            "group cards",
            "member counts",
            "activity indicators"
          ]
        },
        "groupDetail": {
          "features": [
            "member management",
            "role assignment",
            "group settings",
            "activity tracking"
          ],
          "permissions": [
            "member",
            "lead",
            "manager roles with different access levels"
          ]
        },
        "memberManagement": {
          "features": [
            "add members",
            "change roles",
            "remove members",
            "bulk operations"
          ],
          "validation": [
            "role conflicts",
            "permission checks",
            "group capacity limits"
          ]
        }
      },
      "delegationSystem": {
        "description": "Out-of-office delegation management",
        "delegationSetup": {
          "fields": [
            "delegate selection",
            "date range",
            "reason",
            "notification preferences"
          ],
          "validation": [
            "date conflicts",
            "delegate availability",
            "permission delegation"
          ]
        },
        "delegationDisplay": {
          "features": [
            "active delegation banner",
            "assigned tasks view",
            "delegation history"
          ],
          "notifications": [
            "delegation start/end alerts",
            "task assignment notifications"
          ]
        },
        "delegationManagement": {
          "features": [
            "edit delegation",
            "early termination",
            "extend dates",
            "transfer tasks"
          ]
        }
      },
      "invitationSystem": {
        "description": "User invitation and onboarding management",
        "invitationCreation": {
          "features": [
            "email validation",
            "role selection",
            "personal messages",
            "bulk invitations"
          ],
          "templates": [
            "welcome emails",
            "role-specific instructions",
            "getting started guides"
          ]
        },
        "invitationManagement": {
          "features": [
            "resend invitations",
            "cancel invitations",
            "invitation history",
            "expiration tracking"
          ],
          "status": [
            "pending",
            "accepted",
            "expired",
            "cancelled"
          ]
        },
        "onboardingFlow": {
          "steps": [
            "profile completion",
            "preference setup",
            "feature introduction",
            "role training"
          ],
          "progress": [
            "step completion tracking",
            "progress indicators",
            "completion rewards"
          ]
        }
      },
      "userPreferences": {
        "description": "Personalized user settings and customization",
        "categories": [
          "appearance",
          "notifications",
          "dashboard",
          "data display",
          "shortcuts"
        ],
        "features": [
          "theme selection",
          "language preferences",
          "timezone settings",
          "notification controls"
        ],
        "persistence": [
          "local storage",
          "server sync",
          "device synchronization"
        ]
      },
      "securityManagement": {
        "description": "User security and access control",
        "passwordManagement": {
          "features": [
            "password change",
            "password strength validation",
            "password history"
          ],
          "security": [
            "password policies",
            "breach checking",
            "secure reset flow"
          ]
        },
        "sessionManagement": {
          "features": [
            "active session display",
            "session termination",
            "device tracking"
          ],
          "security": [
            "suspicious activity detection",
            "automatic logout",
            "session limits"
          ]
        },
        "accessLogs": {
          "features": [
            "login history",
            "device tracking",
            "security events",
            "export capabilities"
          ],
          "compliance": [
            "GDPR compliance",
            "audit trails",
            "data retention policies"
          ]
        }
      },
      "bulkOperations": {
        "description": "Efficient bulk user management operations",
        "operations": [
          "bulk role changes",
          "bulk group assignments",
          "bulk status updates",
          "bulk invitations"
        ],
        "interface": [
          "selection interface",
          "confirmation dialogs",
          "progress tracking",
          "error reporting"
        ],
        "validation": [
          "permission checks",
          "conflict detection",
          "rollback capabilities"
        ]
      }
    },
    "business_rules": {
      "user_lifecycle": {
        "creation": "User created with pending status, invitation sent, email verification required",
        "activation": "User activated after email verification and password setup",
        "status_transitions": "active \u2194 inactive \u2194 suspended with proper authorization checks",
        "deactivation": "Soft delete with data retention, access revocation, notification to user"
      },
      "authentication_security": {
        "password_policy": "Minimum 12 characters, complexity requirements, dictionary check",
        "session_management": "Automatic logout after inactivity, concurrent session limits",
        "failed_attempts": "Progressive lockout after failed login attempts",
        "password_reset": "Secure token generation, single-use, expiration within 1 hour"
      },
      "authorization_model": {
        "role_hierarchy": "admin > manager > sales/warehouse/support > viewer",
        "permission_inheritance": "Higher roles include all lower role permissions",
        "resource_ownership": "Users can only modify resources they own or have explicit access to",
        "delegation_permissions": "Delegates inherit delegator's permissions for specified time period"
      },
      "team_collaboration": {
        "group_membership": "Users can belong to multiple groups with different roles per group",
        "group_permissions": "Group membership grants access to shared resources and workflows",
        "group_hierarchy": "Support for nested groups with permission inheritance",
        "cross_group_collaboration": "Users can collaborate across groups on shared projects"
      },
      "delegation_workflow": {
        "delegation_scope": "Task assignment, notification routing, approval workflows",
        "delegation_limits": "Maximum delegation duration, delegate workload limits",
        "notification_routing": "All delegator notifications route to delegate during delegation period",
        "delegation_auditing": "Complete audit trail of delegation actions and decisions"
      },
      "invitation_management": {
        "invitation_expiration": "Invitations expire after 7 days by default",
        "invitation_limits": "Rate limiting on invitation sending to prevent abuse",
        "invitation_customization": "Personal messages, role-specific instructions",
        "invitation_tracking": "Complete invitation lifecycle tracking and analytics"
      },
      "onboarding_experience": {
        "onboarding_steps": "Progressive disclosure of features based on user role",
        "onboarding_personalization": "Custom onboarding based on user goals and preferences",
        "onboarding_tracking": "Detailed analytics on onboarding completion and drop-off points",
        "onboarding_support": "Contextual help and guided tours throughout onboarding"
      },
      "data_privacy": {
        "gdpr_compliance": "Right to access, rectify, erase personal data",
        "data_retention": "Configurable retention periods for different data types",
        "data_portability": "Export user data in standard formats",
        "consent_management": "User consent tracking for data processing activities"
      },
      "audit_compliance": {
        "comprehensive_logging": "All user actions logged with full context",
        "audit_retention": "Audit logs retained for regulatory compliance periods",
        "audit_search": "Advanced search and filtering capabilities for audit logs",
        "audit_export": "Secure export of audit data for compliance reporting"
      }
    },
    "integrations": {
      "authentication_providers": {
        "supabase_auth": "Primary authentication with email/password and social login",
        "social_login": "Google, Microsoft, GitHub OAuth integration",
        "sso_saml": "Enterprise SSO integration (future enhancement)",
        "multi_factor": "TOTP and SMS-based multi-factor authentication"
      },
      "notification_system": {
        "email_delivery": "Transactional emails for invitations, password reset, notifications",
        "in_app_notifications": "Real-time notifications within the application",
        "push_notifications": "Mobile push notifications for important events",
        "notification_preferences": "Granular user control over notification types and channels"
      },
      "file_storage": {
        "avatar_storage": "User avatar images stored in Supabase Storage",
        "document_storage": "User documents and exports in secure storage",
        "cdn_delivery": "Fast image delivery through CDN",
        "storage_optimization": "Automatic image resizing and optimization"
      },
      "audit_system": {
        "activity_logging": "All user actions automatically logged",
        "security_monitoring": "Suspicious activity detection and alerting",
        "compliance_reporting": "Automated compliance report generation",
        "data_retention": "Configurable audit log retention and archiving"
      },
      "organization_management": {
        "multi_tenant_isolation": "Complete data isolation between organizations",
        "organization_settings": "Organization-level configuration and branding",
        "user_provisioning": "Automated user provisioning and deprovisioning",
        "resource_limits": "Organization-level resource usage limits and monitoring"
      },
      "communication_platforms": {
        "email_service": "SMTP integration for all email communications",
        "sms_service": "SMS delivery for critical notifications",
        "slack_integration": "Team notifications and collaboration",
        "microsoft_teams": "Enterprise communication integration"
      }
    },
    "performance_requirements": {
      "response_times": {
        "authentication": "< 500 milliseconds",
        "user_listing": "< 1 second for 1000 users",
        "user_detail_load": "< 500 milliseconds",
        "search_results": "< 300 milliseconds",
        "bulk_operations": "< 30 seconds for 1000 users"
      },
      "scalability": {
        "concurrent_users": "1000+ simultaneous authenticated users",
        "user_database_size": "Unlimited user growth with proper indexing",
        "session_management": "10,000+ active sessions with efficient caching",
        "audit_throughput": "1000+ audit events per minute",
        "file_storage": "Scalable avatar and document storage"
      },
      "reliability": {
        "uptime_target": "99.9% availability for user services",
        "data_durability": "100% user data durability with multi-region replication",
        "backup_frequency": "Continuous backup with point-in-time recovery",
        "disaster_recovery": "4-hour RTO, 1-hour RPO for critical user services",
        "security_incidents": "Zero data breaches through comprehensive security controls"
      },
      "monitoring": {
        "authentication_metrics": "Login success/failure rates, geographic distribution",
        "user_engagement": "Active users, feature usage, session duration",
        "security_monitoring": "Failed login attempts, suspicious activity detection",
        "performance_monitoring": "Response times, error rates, resource utilization"
      }
    }
  },
  "stories": [
    {
      "id": "USER-CORE-SCHEMA",
      "name": "User Management Core Schema",
      "description": "Create complete user management database schema with all tables and relationships",
      "type": "schema",
      "acceptance_criteria": [
        "Complete organizations, users, userPreferences tables with all fields",
        "userGroups and userGroupMembers for team organization",
        "userDelegations for out-of-office management",
        "userInvitations and userOnboarding for lifecycle management",
        "userSessions and auditLogs for security and compliance",
        "All foreign key relationships and proper indexing",
        "RLS policies for organization-level data isolation",
        "TypeScript types exported for all entities"
      ],
      "files_to_modify": [
        "src/lib/schema/organizations.ts",
        "src/lib/schema/users.ts",
        "src/lib/schema/user-preferences.ts",
        "src/lib/schema/user-groups.ts",
        "src/lib/schema/user-delegations.ts",
        "src/lib/schema/user-invitations.ts",
        "src/lib/schema/user-onboarding.ts",
        "src/lib/schema/user-sessions.ts",
        "src/lib/schema/audit-logs.ts",
        "src/lib/schema/index.ts",
        "drizzle/migrations/009_users.ts"
      ],
      "completion_promise": "USER_CORE_SCHEMA_COMPLETE",
      "estimated_iterations": 2,
      "uiPatterns": {
        "components": [
          "Schema visualization using Mermaid ERD diagrams",
          "Database migration status dashboard",
          "Type generation confirmation UI"
        ],
        "reference": {
          "reui": [
            "base-badge (for migration status)",
            "base-alert (for migration warnings)"
          ],
          "midday": [
            "Schema inspection tools from accounting package"
          ]
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-CORE-API",
      "name": "User Management Core API",
      "description": "Implement complete user lifecycle and management endpoints",
      "type": "server-function",
      "acceptance_criteria": [
        "Complete authentication API (login, logout, register, password reset)",
        "Full user CRUD operations with proper authorization",
        "Invitation management with token validation and acceptance",
        "Group and team management with membership controls",
        "Delegation system with automatic task reassignment",
        "User preferences and personalization APIs",
        "Audit and activity logging endpoints",
        "All endpoints include proper error handling and RLS",
        "Comprehensive Zod validation schemas"
      ],
      "files_to_modify": [
        "src/server/functions/auth.ts",
        "src/server/functions/users.ts",
        "src/server/functions/invitations.ts",
        "src/server/functions/groups.ts",
        "src/server/functions/delegations.ts",
        "src/server/functions/preferences.ts",
        "src/server/functions/audit.ts",
        "src/lib/schemas/users.ts"
      ],
      "dependencies": [
        "USER-CORE-SCHEMA"
      ],
      "completion_promise": "USER_CORE_API_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "API endpoint testing UI",
          "Zod validation error display",
          "API documentation viewer"
        ],
        "reference": {
          "reui": [
            "form (Zod integration)",
            "base-alert-dialog (error handling)"
          ],
          "midday": [
            "TRPC pattern from dashboard apps"
          ]
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-AUTHENTICATION-UI",
      "name": "Authentication and Registration Interface",
      "description": "Complete user authentication and account creation flow",
      "type": "ui-component",
      "acceptance_criteria": [
        "Responsive login form with email/password validation",
        "Registration form with organization setup",
        "Email verification flow with token handling",
        "Password reset with secure token validation",
        "Social login integration options",
        "Multi-factor authentication setup",
        "Remember me functionality with secure tokens",
        "Mobile-responsive design with touch optimization"
      ],
      "files_to_modify": [
        "src/routes/_authed/login.tsx",
        "src/routes/_authed/register.tsx",
        "src/routes/_authed/forgot-password.tsx",
        "src/routes/_authed/reset-password.tsx",
        "src/components/auth/login-form.tsx",
        "src/components/auth/register-form.tsx",
        "src/components/auth/email-verification.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_AUTHENTICATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Card-based auth forms with centered layout",
          "Progressive form validation with live feedback",
          "Social login buttons with brand icons",
          "Password strength indicator",
          "Email verification success/error states",
          "Toast notifications for auth events"
        ],
        "reference": {
          "reui": [
            "form (React Hook Form + Zod validation)",
            "card (auth form containers)",
            "input (email/password fields)",
            "button (submit, social login)",
            "base-toast (notifications)",
            "base-progress (password strength)"
          ],
          "midday": [
            "apple-sign-in.tsx (social auth pattern)",
            "change-email.tsx (form with Card layout)"
          ]
        },
        "layout": {
          "desktop": "Centered card (max-w-md) with gradient background",
          "mobile": "Full-width form with sticky submit button",
          "states": [
            "idle",
            "loading",
            "success",
            "error",
            "verification-sent"
          ]
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-MANAGEMENT-UI",
      "name": "User Administration Interface",
      "description": "Complete user management dashboard with team administration",
      "type": "ui-component",
      "acceptance_criteria": [
        "User list with advanced filtering and search",
        "User detail view with complete profile management",
        "Bulk user operations with progress tracking",
        "Role and permission management interface",
        "User status management (active, inactive, suspended)",
        "User activity and login history display",
        "Export capabilities for user data and reports",
        "Real-time user status updates and notifications"
      ],
      "files_to_modify": [
        "src/routes/_authed/admin/users/index.tsx",
        "src/routes/_authed/admin/users/$userId.tsx",
        "src/components/admin/user-list.tsx",
        "src/components/admin/user-detail.tsx",
        "src/components/admin/bulk-user-actions.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_MANAGEMENT_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "TanStack Table with sorting, filtering, pagination",
          "Avatar with fallback initials",
          "Role badges with color coding",
          "Status indicators (active, pending, suspended)",
          "Bulk action toolbar with confirmation dialogs",
          "User detail tabs (Profile, Groups, Activity, Security)",
          "Inline editing with optimistic updates",
          "Export menu with format options (CSV, JSON, PDF)"
        ],
        "reference": {
          "reui": [
            "data-grid (user list table)",
            "avatar (user profile pictures)",
            "badge (role, status indicators)",
            "base-tabs (user detail sections)",
            "dropdown-menu (row actions, bulk actions)",
            "base-dialog (edit user, confirm delete)",
            "filters (role, status, date range)"
          ],
          "midday": [
            "avatar-upload.tsx (profile picture)",
            "bulk-actions.tsx (selection toolbar)",
            "assigned-user.tsx (user display pattern)"
          ]
        },
        "layout": {
          "list": "Full-width DataGrid with sticky header, column filters",
          "detail": "Two-column layout: sidebar (avatar, quick actions) + main (tabs)",
          "bulk": "Floating action bar appears when rows selected"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-TEAM-ORGANIZATION-UI",
      "name": "Team Organization Interface",
      "description": "Group and team management with collaboration features",
      "type": "ui-component",
      "acceptance_criteria": [
        "Group creation and management interface",
        "Member addition and role assignment",
        "Group hierarchy visualization",
        "Cross-group collaboration tools",
        "Group activity and performance tracking",
        "Group communication and notification settings",
        "Bulk group operations and member management",
        "Group permission and access control settings"
      ],
      "files_to_modify": [
        "src/routes/_authed/admin/groups/index.tsx",
        "src/routes/_authed/admin/groups/$groupId.tsx",
        "src/components/admin/group-list.tsx",
        "src/components/admin/group-detail.tsx",
        "src/components/admin/group-members.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_TEAM_ORGANIZATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Group cards grid with color-coded headers",
          "Member avatars in avatar-group component",
          "Drag-and-drop member assignment",
          "Group hierarchy tree visualization",
          "Role assignment dropdown with permissions preview",
          "Activity timeline for group actions",
          "Invite members dialog with bulk email input"
        ],
        "reference": {
          "reui": [
            "card (group card container)",
            "avatar-group (member display)",
            "base-combobox (member selection)",
            "base-select (role assignment)",
            "base-tree (group hierarchy)",
            "base-dialog (add members, edit group)"
          ],
          "midday": [
            "assign-user.tsx (user assignment pattern)",
            "assigned-user.tsx (display assigned members)"
          ]
        },
        "layout": {
          "list": "Responsive grid (1-3 columns) of group cards",
          "detail": "Header (group info, actions) + Tabs (Members, Settings, Activity)",
          "members": "DataGrid with drag handles for reordering"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-DELEGATION-UI",
      "name": "Delegation Management Interface",
      "description": "Out-of-office delegation setup and management",
      "type": "ui-component",
      "acceptance_criteria": [
        "Delegation creation with delegate selection",
        "Date range picker with validation",
        "Delegation status and progress tracking",
        "Task reassignment during delegation period",
        "Delegation history and audit trail",
        "Delegate task management interface",
        "Delegation conflict detection and resolution",
        "Automatic delegation expiration handling"
      ],
      "files_to_modify": [
        "src/components/user/delegation-setup.tsx",
        "src/components/user/delegation-list.tsx",
        "src/components/user/delegation-banner.tsx",
        "src/components/user/delegation-tasks.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_DELEGATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Date range picker for delegation period",
          "User combobox for delegate selection",
          "Active delegation banner (dismissible alert)",
          "Delegation timeline with status badges",
          "Task reassignment checklist",
          "Conflict warning dialog",
          "Auto-expiration countdown timer"
        ],
        "reference": {
          "reui": [
            "date-picker (delegation period)",
            "base-combobox (delegate selection)",
            "alert (active delegation banner)",
            "badge (delegation status)",
            "base-dialog (create delegation)",
            "calendar (date visualization)"
          ],
          "midday": [
            "Pattern: Inline status indicators",
            "Pattern: Dismissible notification banners"
          ]
        },
        "layout": {
          "banner": "Full-width alert at top of dashboard when delegation active",
          "setup": "Dialog with stepped form (Delegate > Dates > Reason > Confirm)",
          "list": "Timeline view showing past, active, future delegations"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-INVITATION-UI",
      "name": "Invitation and Onboarding Interface",
      "description": "User invitation and onboarding experience management",
      "type": "ui-component",
      "acceptance_criteria": [
        "Invitation creation with customization options",
        "Bulk invitation management and tracking",
        "Invitation acceptance flow with account setup",
        "Onboarding checklist and progress tracking",
        "Personalized onboarding based on user role",
        "Onboarding analytics and completion reporting",
        "Invitation expiration and renewal handling",
        "Welcome email and notification management"
      ],
      "files_to_modify": [
        "src/components/admin/invitation-form.tsx",
        "src/components/admin/invitation-list.tsx",
        "src/routes/_authed/accept-invitation.tsx",
        "src/components/onboarding/onboarding-checklist.tsx",
        "src/components/onboarding/onboarding-progress.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_INVITATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Multi-step invitation form with preview",
          "Bulk email input with CSV upload",
          "Invitation status badges (pending, accepted, expired)",
          "Onboarding progress bar with step indicators",
          "Interactive checklist with completion animations",
          "Role-specific welcome cards",
          "Resend/cancel action buttons"
        ],
        "reference": {
          "reui": [
            "form (invitation creation)",
            "file-upload (bulk CSV import)",
            "badge (invitation status)",
            "base-progress (onboarding completion)",
            "checkbox (onboarding tasks)",
            "base-dialog (invitation preview)",
            "base-toast (invitation sent confirmation)"
          ],
          "midday": [
            "Pattern: Multi-step forms",
            "Pattern: Status tracking with visual indicators"
          ]
        },
        "layout": {
          "invite": "Dialog with tabbed interface (Single, Bulk, Template)",
          "onboarding": "Sidebar checklist + main content area for current step",
          "progress": "Horizontal stepper showing completed/pending steps"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-PREFERENCES-UI",
      "name": "User Preferences Interface",
      "description": "Personalized user settings and customization",
      "type": "ui-component",
      "acceptance_criteria": [
        "Comprehensive preference categories",
        "Theme and appearance customization",
        "Notification preference management",
        "Language and localization settings",
        "Dashboard and layout personalization",
        "Data display and formatting preferences",
        "Keyboard shortcuts and accessibility settings",
        "Preference synchronization across devices"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/preferences.tsx",
        "src/components/settings/preference-categories.tsx",
        "src/components/settings/theme-selector.tsx",
        "src/components/settings/notification-settings.tsx",
        "src/components/settings/accessibility-settings.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_PREFERENCES_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Settings page with sidebar navigation",
          "Theme switcher with live preview",
          "Toggle groups for notification channels",
          "Select dropdowns for locale/timezone/currency",
          "Color picker for theme customization",
          "Keyboard shortcut editor",
          "Reset to defaults button with confirmation"
        ],
        "reference": {
          "reui": [
            "base-tabs (preference categories)",
            "base-switch (toggle preferences)",
            "base-select (locale, timezone)",
            "base-toggle-group (theme selection)",
            "card (preference sections)",
            "base-alert-dialog (reset confirmation)"
          ],
          "midday": [
            "change-theme.tsx (theme selection pattern)",
            "change-timezone.tsx (timezone selector)",
            "change-email.tsx (Card-based settings form)"
          ]
        },
        "layout": {
          "desktop": "Two-column: sidebar (categories) + main (settings forms)",
          "mobile": "Accordion-style category expansion",
          "autosave": "Preferences save automatically with success toast"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-SECURITY-UI",
      "name": "Security Management Interface",
      "description": "User security settings and access control",
      "type": "ui-component",
      "acceptance_criteria": [
        "Password change and security settings",
        "Active session management and monitoring",
        "Security event history and alerts",
        "Two-factor authentication setup and management",
        "Login attempt monitoring and blocking",
        "Device and location tracking",
        "Security preference configuration",
        "Account recovery and emergency access"
      ],
      "files_to_modify": [
        "src/routes/_authed/settings/security.tsx",
        "src/components/settings/password-settings.tsx",
        "src/components/settings/session-management.tsx",
        "src/components/settings/security-events.tsx",
        "src/components/settings/two-factor-setup.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_SECURITY_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Password change form with strength indicator",
          "Active sessions list with device icons",
          "Security event timeline with severity badges",
          "2FA setup wizard with QR code",
          "Session location map visualization",
          "Suspicious activity alerts",
          "Terminate session buttons with confirmation"
        ],
        "reference": {
          "reui": [
            "form (password change)",
            "base-progress (password strength)",
            "data-grid (sessions, security events)",
            "badge (severity levels)",
            "base-dialog (2FA setup)",
            "alert (security warnings)",
            "base-tabs (Security sections)"
          ],
          "midday": [
            "Pattern: Security-critical actions require confirmation",
            "Pattern: Real-time activity monitoring"
          ]
        },
        "layout": {
          "main": "Card-based sections: Password, Sessions, 2FA, Activity",
          "sessions": "DataGrid with device/location/time columns",
          "events": "Timeline with filtering by severity/type"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-BULK-OPERATIONS-UI",
      "name": "Bulk User Operations Interface",
      "description": "Efficient bulk user management and operations",
      "type": "ui-component",
      "acceptance_criteria": [
        "Advanced user selection interface",
        "Bulk operation confirmation and validation",
        "Progress tracking for long-running operations",
        "Error handling and partial failure recovery",
        "Operation history and audit trail",
        "Bulk import from CSV with validation",
        "Bulk export with filtering options",
        "Rollback capabilities for failed operations"
      ],
      "files_to_modify": [
        "src/components/admin/bulk-user-selection.tsx",
        "src/components/admin/bulk-operation-progress.tsx",
        "src/components/admin/bulk-import-wizard.tsx",
        "src/components/admin/bulk-export-config.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_BULK_OPERATIONS_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Floating action bar for bulk operations",
          "CSV import with drag-and-drop",
          "Column mapping interface for imports",
          "Progress dialog with step-by-step status",
          "Error summary with failed rows highlighted",
          "Export configuration form with field selection",
          "Undo/rollback confirmation dialog"
        ],
        "reference": {
          "reui": [
            "file-upload (CSV import)",
            "base-progress (operation progress)",
            "base-dialog (bulk action confirmation)",
            "data-grid (preview import data)",
            "base-alert (error summary)",
            "checkbox (row selection)",
            "dropdown-menu (bulk actions)"
          ],
          "midday": [
            "bulk-actions.tsx (floating action bar pattern)",
            "Pattern: Multi-step wizards for complex operations"
          ]
        },
        "layout": {
          "selection": "Checkbox column in DataGrid + floating action bar",
          "import": "Wizard: Upload > Map Columns > Validate > Confirm > Import",
          "progress": "Modal dialog with progress bar + live status updates"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-AUDIT-COMPLIANCE-UI",
      "name": "Audit and Compliance Interface",
      "description": "Comprehensive audit trail and compliance management",
      "type": "ui-component",
      "acceptance_criteria": [
        "Advanced audit log searching and filtering",
        "User activity timeline and visualization",
        "Compliance report generation and export",
        "Data retention and deletion management",
        "GDPR compliance tools and user data export",
        "Security incident investigation interface",
        "Audit log retention policy management",
        "Automated compliance reporting"
      ],
      "files_to_modify": [
        "src/routes/_authed/admin/audit/index.tsx",
        "src/components/admin/audit-search.tsx",
        "src/components/admin/audit-timeline.tsx",
        "src/components/admin/compliance-reports.tsx",
        "src/components/admin/data-export.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_AUDIT_COMPLIANCE_UI_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Advanced filter panel with multiple criteria",
          "Activity timeline with expandable entries",
          "Report builder with template selection",
          "Data export wizard with GDPR options",
          "Retention policy editor",
          "Incident investigation workspace",
          "Before/after diff viewer for changes"
        ],
        "reference": {
          "reui": [
            "filters (audit search)",
            "data-grid (audit logs)",
            "base-collapsible (expandable log entries)",
            "date-picker (date range filtering)",
            "base-dialog (report generation)",
            "base-tabs (compliance sections)"
          ],
          "midday": [
            "Pattern: Advanced filtering with saved filters",
            "Pattern: Export with format options"
          ]
        },
        "layout": {
          "main": "Filter sidebar + DataGrid with expandable rows",
          "timeline": "Vertical timeline with grouped events by date",
          "reports": "Template library + custom report builder"
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-INTEGRATION-API",
      "name": "User System Integration Layer",
      "description": "Integration hooks and utilities for user system usage throughout the application",
      "type": "server-function",
      "acceptance_criteria": [
        "User context provider for React components",
        "Authentication middleware and guards",
        "Permission checking utilities and hooks",
        "User data caching and performance optimization",
        "Delegation-aware permission checking",
        "Audit logging integration hooks",
        "User preference management utilities",
        "Session management and validation"
      ],
      "files_to_modify": [
        "src/contexts/user-context.tsx",
        "src/hooks/use-user.ts",
        "src/hooks/use-permissions.ts",
        "src/middleware/auth-guard.ts",
        "src/lib/user-cache.ts",
        "src/lib/permission-checker.ts"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_INTEGRATION_API_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Permission-gated components (hide/disable based on user role)",
          "User context provider wrapper",
          "Auth guard redirect components",
          "Loading states during auth checks"
        ],
        "reference": {
          "reui": [
            "base-skeleton (loading states)"
          ],
          "midday": [
            "hooks/use-user.ts (user query pattern)",
            "hooks/use-user-mutation.ts (user mutation pattern)"
          ]
        }
      },
      "status": "pending"
    },
    {
      "id": "USER-ONBOARDING-SYSTEM",
      "name": "User Onboarding System",
      "description": "Complete onboarding experience with progress tracking and personalization",
      "type": "ui-component",
      "acceptance_criteria": [
        "Role-based onboarding flow creation",
        "Interactive onboarding checklist",
        "Progress tracking and completion rewards",
        "Contextual help and guided tours",
        "Onboarding analytics and optimization",
        "Personalized onboarding based on user behavior",
        "Onboarding completion incentives",
        "Onboarding effectiveness measurement"
      ],
      "files_to_modify": [
        "src/components/onboarding/onboarding-flow.tsx",
        "src/components/onboarding/onboarding-checklist.tsx",
        "src/components/onboarding/guided-tour.tsx",
        "src/components/onboarding/onboarding-analytics.tsx"
      ],
      "dependencies": [
        "USER-CORE-API"
      ],
      "completion_promise": "USER_ONBOARDING_SYSTEM_COMPLETE",
      "estimated_iterations": 3,
      "uiPatterns": {
        "components": [
          "Persistent checklist sidebar/popover",
          "Step-by-step guided tour with spotlight",
          "Completion celebration animations",
          "Skip/dismiss options with persistence",
          "Role-specific welcome screens",
          "Video tutorials embedded in steps",
          "Achievement badges for milestones"
        ],
        "reference": {
          "reui": [
            "base-progress (onboarding completion)",
            "checkbox (task checklist)",
            "base-popover (guided tour tooltips)",
            "card (welcome screens)",
            "badge (achievement indicators)",
            "base-sheet (onboarding sidebar)"
          ],
          "midday": [
            "Pattern: Progressive disclosure of features",
            "Pattern: Contextual help overlays"
          ]
        },
        "layout": {
          "checklist": "Floating sidebar (collapsible) or popover trigger",
          "tour": "Overlay with spotlight on target element + tooltip",
          "welcome": "Full-screen modal with role-specific content"
        }
      },
      "status": "pending"
    }
  ],
  "success_criteria": [
    "Complete identity and access management system with secure authentication",
    "Role-based access control with granular permissions and delegation",
    "Team collaboration features with groups and cross-functional workflows",
    "Comprehensive audit trail and compliance management",
    "Personalized user experience with preferences and customization",
    "Scalable user management supporting 1000+ concurrent users",
    "Mobile-responsive interfaces with touch-optimized interactions",
    "Automated onboarding and user lifecycle management",
    "Bulk operations and efficient user administration tools",
    "GDPR and privacy compliance with data export capabilities",
    "Real-time user activity monitoring and security alerting",
    "Integration with email, file storage, and notification systems",
    "Complete user session management and security monitoring",
    "Advanced user search and filtering capabilities",
    "Comprehensive user preference synchronization across devices"
  ],
  "out_of_scope": [
    "Multi-organization user sharing and collaboration",
    "Advanced SSO/SAML integration (OAuth only)",
    "Biometric authentication methods",
    "Third-party user directory synchronization",
    "Advanced user analytics and behavioral tracking",
    "Real-time collaborative document editing",
    "Blockchain-based identity verification",
    "Quantum-resistant cryptographic authentication"
  ],
  "migration_notes": {
    "existing_data": "If existing Supabase Auth users exist, migration scripts needed to populate local user tables with profile data and preferences",
    "authentication": "Existing Supabase Auth sessions should be preserved during transition to maintain user experience",
    "permissions": "Role and permission mappings need careful alignment with new granular permission system",
    "user_data": "Existing user profile data and preferences should be migrated to new schema structure"
  }
}