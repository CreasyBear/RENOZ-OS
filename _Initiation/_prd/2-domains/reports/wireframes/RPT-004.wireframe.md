# DOM-RPT-004: Financial Summary Report

> **PRD**: reports.prd.json
> **Story**: DOM-RPT-004 - Add Financial Summary Report
> **Priority**: 1
> **Route**: `/reports/financial`

---

## UI Patterns (Reference Implementation)

### Core Components from reui-reference

| Wireframe Element | Reference Component | Path | Implementation Notes |
|-------------------|---------------------|------|----------------------|
| **KPI Cards** | Card | `_reference/.reui-reference/registry/default/ui/card.tsx` | Use CardHeader for title+icon, CardContent for value+change |
| **P&L Table** | Table / DataGrid | `_reference/.reui-reference/registry/default/ui/data-grid-table.tsx` | Basic table, no sorting needed - just display |
| **AR Aging Table** | Table + Badge | `_reference/.reui-reference/registry/default/ui/badge.tsx` | Custom badge colors for aging status (green/yellow/orange/red) |
| **Revenue Trend Chart** | Chart (Recharts) | `_reference/.reui-reference/registry/default/ui/chart.tsx` | LineChart with 2 lines (revenue, costs), area fill optional |
| **Cash Flow Visual** | Card + Progress | `_reference/.reui-reference/registry/default/ui/progress.tsx` | Custom dual-column layout for inflows/outflows |
| **Date Range Picker** | Calendar + Popover | `_reference/.reui-reference/registry/default/ui/calendar.tsx` | Add preset buttons (MTD, QTD, YTD) above calendar |
| **Export Dropdown** | DropdownMenu | `_reference/.reui-reference/registry/default/ui/dropdown-menu.tsx` | CSV/PDF/Excel options with icons |
| **Loading Skeleton** | Skeleton | `_reference/.reui-reference/registry/default/ui/skeleton.tsx` | Shimmer effect for cards and tables |

### Midday Reference Examples

**Relevant Patterns**:
- `/apps/dashboard/src/components/canvas/profit-canvas.tsx` - Similar profit/revenue KPI layout
- `/apps/dashboard/src/components/average-days-to-payment.tsx` - AR metrics display pattern
- `/apps/dashboard/src/components/canvas/base/canvas-chart.tsx` - Chart wrapper with error boundary

**Key Pattern: KPI Card with Trend**
```tsx
<Card>
  <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
    <CardTitle className="text-sm font-medium">Gross Revenue</CardTitle>
    <DollarSign className="h-4 w-4 text-muted-foreground" />
  </CardHeader>
  <CardContent>
    <div className="text-2xl font-bold">$125,400</div>
    <div className="flex items-center text-xs text-muted-foreground">
      <TrendingUp className="mr-1 h-3 w-3 text-green-500" />
      <span className="text-green-600">+12.5%</span>
      <span className="ml-1">vs $111,467</span>
    </div>
  </CardContent>
</Card>
```

**Key Pattern: Revenue Chart (from chart.tsx)**
```tsx
<ChartContainer config={chartConfig}>
  <LineChart data={revenueData}>
    <CartesianGrid strokeDasharray="3 3" className="stroke-muted" />
    <XAxis dataKey="month" />
    <YAxis />
    <ChartTooltip content={<ChartTooltipContent />} />
    <Line
      type="monotone"
      dataKey="revenue"
      stroke="var(--color-revenue)"
      strokeWidth={2}
    />
    <Line
      type="monotone"
      dataKey="costs"
      stroke="var(--color-costs)"
      strokeWidth={2}
    />
  </LineChart>
</ChartContainer>
```

**Key Pattern: AR Aging Badge (custom)**
```tsx
<Badge className={cn(
  "font-medium",
  status === 'current' && "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",
  status === 'warning' && "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100",
  status === 'overdue' && "bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100",
  status === 'critical' && "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100"
)}>
  {label}
</Badge>
```

### Implementation Strategy

1. **Chart Library**: Use recharts (already integrated in reui chart.tsx)
2. **Responsive Layout**:
   - Desktop: 3-column KPI grid, side-by-side sections
   - Tablet: 2-column KPI grid, stacked sections
   - Mobile: 1-column, collapsible sections using Collapsible component
3. **Animation**: Use CountingNumber component from reui for animating metric values
4. **Error Handling**: Wrap chart in ErrorBoundary (pattern from midday canvas-chart.tsx)

---

## Dependencies

> **IMPORTANT**: This wireframe requires backend stories to complete first.

| Dependency Type | Requirement | Status |
|-----------------|-------------|--------|
| **Schema Required** | report_configurations | NOT CREATED |
| **Server Functions Required** | getFinancialSummary, calculateProfitLoss, getARAgingData, getCashFlowData | NOT CREATED |
| **PRD Stories (Must Complete First)** | DOM-RPT-004 | PENDING |

### Existing Schema Available
- `orders` in `renoz-v2/lib/schema/orders.ts` - provides revenue, order totals, payment data
- `customers` in `renoz-v2/lib/schema/customers.ts` - provides AR/customer data
- `products` in `renoz-v2/lib/schema/products.ts` - provides COGS/cost data

### Renoz Business Context
- **Industry**: Australian B2B battery manufacturer
- **Key Metrics**: kWh deployed, Quote win rate, Installation completion rate, Warranty claim rate
- **Product Categories**: Battery Systems, Inverters, Solar, Services
- **Currency**: AUD with GST (10%)
- **Fiscal Year**: July-June (Australian)
- **Report Users**: Admin, Sales, Installation managers

---

## Overview

Financial performance overview with P&L summary, cash flow indicators, and AR tracking. Built on existing ReportLayout infrastructure with export to CSV/PDF.

**Design Aesthetic**: Data-Rich Scannable - financial data with clear hierarchy
**Primary Device**: Desktop (finance/admin)
**Secondary**: Tablet (executive review)

---

## Desktop Wireframe (1280px+)

### Financial Summary Report - Main View

```
+================================================================================+
| Renoz CRM                                                    [bell] [Joel v]   |
+-------------+------------------------------------------------------------------+
|             |                                                                  |
| Dashboard   |  Reports > Financial Summary                                     |
| Customers   |  ================================================================|
| Orders      |                                                                  |
| Products    |  Financial performance overview for your business.               |
| Jobs        |                                                                  |
| Reports <   |  +-- HEADER ACTIONS ------------------------------------------------+
|  > Sales    |  |                                                                |
|  > Pipeline |  |  [star] Favorite   [calendar] Schedule   [Export v]  [Print]   |
|  > Inventory|  |                                                                |
|  > Financial<|  +----------------------------------------------------------------+
|  > Customer |                                                                  |
|  > Warranty |  +-- DATE & COMPARISON CONTROLS ------------------------------------+
|             |  |                                                                |
|             |  |  Period:                         Compare to:                   |
|             |  |  +------------------------+      +------------------------+    |
|             |  |  | [cal] This Month    [v]|      | [cal] Last Month    [v]|    |
|             |  |  +------------------------+      +------------------------+    |
|             |  |                                                                |
|             |  |  Quick: [MTD] [QTD] [YTD] [Last 30] [Last 90] [Custom]         |
|             |  |                                                                |
|             |  +----------------------------------------------------------------+
|             |                                                                  |
|             |  +-- P&L SUMMARY CARDS =============================================+
|             |  |                                                                 |
|             |  |  +---------------+  +---------------+  +---------------+        |
|             |  |  | GROSS REVENUE |  | TOTAL COSTS   |  | GROSS PROFIT  |        |
|             |  |  |               |  |               |  |               |        |
|             |  |  |   $125,400    |  |   $78,250     |  |   $47,150     |        |
|             |  |  |   +12.5% ^    |  |   +8.2% ^     |  |   +18.7% ^    |        |
|             |  |  |               |  |               |  |               |        |
|             |  |  | vs $111,467   |  | vs $72,319    |  | vs $39,725    |        |
|             |  |  +---------------+  +---------------+  +---------------+        |
|             |  |                                                                 |
|             |  |  +---------------+  +---------------+  +---------------+        |
|             |  |  | GROSS MARGIN  |  | OUTSTANDING AR|  | AVG ORDER VAL |        |
|             |  |  |               |  |               |  |               |        |
|             |  |  |    37.6%      |  |   $18,450     |  |   $2,340      |        |
|             |  |  |   +2.1pp ^    |  |   -$3,200 v   |  |   +$180 ^     |        |
|             |  |  |               |  |               |  |               |        |
|             |  |  | vs 35.5%      |  | vs $21,650    |  | vs $2,160     |        |
|             |  |  +---------------+  +---------------+  +---------------+        |
|             |  |                                                                 |
|             |  +================================================================+
|             |                                                                  |
|             |  +-- P&L BREAKDOWN TABLE ==========================================+
|             |  |                                                                 |
|             |  |  INCOME STATEMENT (Period: January 2026 - FY26 H2)              |
|             |  |  ----------------------------------------------------------------|
|             |  |                                                                 |
|             |  |  +--------------------------------------------------------------+|
|             |  |  |                          |  This Period  |  Prior Period  | %  ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | REVENUE                  |               |                |    ||
|             |  |  |   Battery Systems          |   $98,200     |   $87,400      | +12%||
|             |  |  |   Installation Services        |   $27,200     |   $24,067      | +13%||
|             |  |  |   Other Income           |    $0         |    $0          | -   ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | TOTAL REVENUE            |  $125,400     |  $111,467      | +12%||
|             |  |  +--------------------------------------------------------------+|
|             |  |  |                          |               |                |    ||
|             |  |  | COST OF GOODS SOLD       |               |                |    ||
|             |  |  |   Material Costs         |   $52,100     |   $48,200      | +8% ||
|             |  |  |   Installation Labor            |   $26,150     |   $24,119      | +8% ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | TOTAL COGS               |   $78,250     |   $72,319      | +8% ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  |                          |               |                |    ||
|             |  |  | GROSS PROFIT             |   $47,150     |   $39,148      | +20%||
|             |  |  | GROSS MARGIN             |    37.6%      |    35.1%       |+2.5pp|
|             |  |  +--------------------------------------------------------------+|
|             |  |                                                                 |
|             |  +================================================================+
|             |                                                                  |
+-------------+------------------------------------------------------------------+
```

### Financial Summary - Continued (Cash Flow & AR)

```
+-------------+------------------------------------------------------------------+
|             |                                                                  |
|             |  +-- CASH FLOW INDICATORS =========================================+
|             |  |                                                                 |
|             |  |  +-------------------------------------------------------------+|
|             |  |  |                                                             ||
|             |  |  |  CASH FLOW SUMMARY                                          ||
|             |  |  |  ---------------------------------------------------------- ||
|             |  |  |                                                             ||
|             |  |  |  +-- Inflows ----------------------+-- Outflows ----------+||
|             |  |  |  |                                 |                       |||
|             |  |  |  |  Collections:     $108,200      |  Payments:   $65,400  |||
|             |  |  |  |  New AR:         -$18,450      |  Inventory:  $12,800  |||
|             |  |  |  |  Other:           $2,100       |  Other:       $4,200  |||
|             |  |  |  |  ----------------------------- |  -------------------- |||
|             |  |  |  |  Total Inflows:   $91,850      |  Total Out:   $82,400 |||
|             |  |  |  |                                 |                       |||
|             |  |  |  +---------------------------------+-----------------------+||
|             |  |  |                                                             ||
|             |  |  |  NET CASH FLOW:  +$9,450  [green]                           ||
|             |  |  |  [==============================|                        ]  ||
|             |  |  |  Positive cash flow indicator                               ||
|             |  |  |                                                             ||
|             |  |  +-------------------------------------------------------------+|
|             |  |                                                                 |
|             |  +================================================================+
|             |                                                                  |
|             |  +-- ACCOUNTS RECEIVABLE AGING ====================================+
|             |  |                                                                 |
|             |  |  Outstanding AR: $18,450 across 12 customers                    |
|             |  |                                                                 |
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Aging Bucket    | Amount    | Count | % of Total | Status   ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Current (0-30)  | $8,200    |   5   |   44.4%    | [green]  ||
|             |  |  | 31-60 Days      | $5,100    |   4   |   27.6%    | [yellow] ||
|             |  |  | 61-90 Days      | $3,450    |   2   |   18.7%    | [orange] ||
|             |  |  | 90+ Days        | $1,700    |   1   |    9.2%    | [red]    ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | TOTAL           | $18,450   |  12   |   100%     |          ||
|             |  |  +--------------------------------------------------------------+|
|             |  |                                                                 |
|             |  |  [View AR Details]                                              |
|             |  |                                                                 |
|             |  +================================================================+
|             |                                                                  |
|             |  +-- REVENUE TREND CHART ==========================================+
|             |  |                                                                 |
|             |  |  Revenue vs Costs (Last 6 Months)                               |
|             |  |                                                                 |
|             |  |  $150K|                                           *             |
|             |  |       |                                    *                    |
|             |  |  $125K|                             *                           |
|             |  |       |                      *                                  |
|             |  |  $100K|               *                                         |
|             |  |       |        *                                                |
|             |  |   $75K|-------------------------------------------------------- |
|             |  |       |   x      x       x       x       x       x              |
|             |  |   $50K|-------------------------------------------------------- |
|             |  |       |                                                         |
|             |  |       +--Aug----Sep----Oct----Nov----Dec----Jan--->             |
|             |  |                                                                 |
|             |  |  [*] Revenue   [x] Costs   [---] Target                         |
|             |  |                                                                 |
|             |  +================================================================+
|             |                                                                  |
+-------------+------------------------------------------------------------------+
```

### Target Comparison View (If targets configured)

```
+-------------+------------------------------------------------------------------+
|             |                                                                  |
|             |  +-- BUDGET VS ACTUAL =============================================+
|             |  |                                                                 |
|             |  |  Performance Against Targets (January 2026 - FY26 H2)           |
|             |  |                                                                 |
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Metric            | Target    | Actual    | Variance  |Status||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Revenue           | $120,000  | $125,400  | +$5,400   | [+] ||
|             |  |  |                   |           |           | +4.5%     |     ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Gross Margin      | 35.0%     | 37.6%     | +2.6pp    | [+] ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | New Customers     | 15        | 18        | +3        | [+] ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Orders Completed  | 50        | 47        | -3        | [-] ||
|             |  |  +--------------------------------------------------------------+|
|             |  |  | Avg Order Value   | $2,400    | $2,340    | -$60      | [~] ||
|             |  |  +--------------------------------------------------------------+|
|             |  |                                                                 |
|             |  |  [+] Exceeds target   [~] Within 5%   [-] Below target          |
|             |  |                                                                 |
|             |  +================================================================+
|             |                                                                  |
+-------------+------------------------------------------------------------------+
```

---

## Tablet Wireframe (768px)

```
+================================================================+
| < Reports                                   [Export] [Print]     |
+----------------------------------------------------------------+
| Financial Summary                                                |
| ================================================================|
+----------------------------------------------------------------+
|                                                                  |
|  Period: [This Month v]    Compare: [Last Month v]               |
|                                                                  |
|  [MTD] [QTD] [YTD] [Custom]                                      |
|                                                                  |
+----------------------------------------------------------------+
|                                                                  |
|  +--------+--------+--------+                                    |
|  | Revenue| Costs  | Profit |                                    |
|  | $125.4K| $78.3K | $47.2K |                                    |
|  | +12.5% | +8.2%  | +18.7% |                                    |
|  +--------+--------+--------+                                    |
|                                                                  |
|  +--------+--------+--------+                                    |
|  | Margin | AR Out | Avg Ord|                                    |
|  | 37.6%  | $18.5K | $2.34K |                                    |
|  | +2.1pp | -$3.2K | +$180  |                                    |
|  +--------+--------+--------+                                    |
|                                                                  |
+----------------------------------------------------------------+
|                                                                  |
|  === P&L SUMMARY ===                                             |
|                                                                  |
|  +------------------------------------------------------------+ |
|  | Revenue                                                     | |
|  |   Battery Systems             $98,200      +12%               | |
|  |   Installation Services           $27,200      +13%               | |
|  | ---------------------------------------------------------- | |
|  | TOTAL REVENUE              $125,400      +12%               | |
|  +------------------------------------------------------------+ |
|  | Costs                                                       | |
|  |   Material Costs            $52,100      +8%                | |
|  |   Installation Labor               $26,150      +8%                | |
|  | ---------------------------------------------------------- | |
|  | TOTAL COGS                  $78,250      +8%                | |
|  +------------------------------------------------------------+ |
|  | GROSS PROFIT                $47,150      +20%               | |
|  | GROSS MARGIN                 37.6%      +2.5pp              | |
|  +------------------------------------------------------------+ |
|                                                                  |
+----------------------------------------------------------------+
|                                                                  |
|  === CASH FLOW ===                                               |
|                                                                  |
|  +------------------------------------------------------------+ |
|  | Inflows:     $91,850                                        | |
|  | Outflows:    $82,400                                        | |
|  | ---------------------------------------------------------- | |
|  | Net Flow:    +$9,450  [green]                               | |
|  +------------------------------------------------------------+ |
|                                                                  |
+----------------------------------------------------------------+
|                                                                  |
|  === AR AGING ===                                                |
|                                                                  |
|  +------------------------------------------------------------+ |
|  | Current (0-30)    $8,200     44%   [==========]             | |
|  | 31-60 Days        $5,100     28%   [======]                 | |
|  | 61-90 Days        $3,450     19%   [====]                   | |
|  | 90+ Days          $1,700      9%   [==]                     | |
|  +------------------------------------------------------------+ |
|  | Total:           $18,450                      [View Details]| |
|  +------------------------------------------------------------+ |
|                                                                  |
+================================================================+
```

---

## Mobile Wireframe (375px)

```
+========================================+
| < Reports                              |
+----------------------------------------+
| Financial Summary                      |
| ====================================== |
+----------------------------------------+
|                                        |
|  [This Month v]  vs  [Last Month v]    |
|                                        |
+----------------------------------------+
|                                        |
|  KEY METRICS                           |
|                                        |
|  +----------------------------------+  |
|  | GROSS REVENUE                    |  |
|  |                                  |  |
|  |        $125,400                  |  |
|  |        +12.5% vs prior           |  |
|  +----------------------------------+  |
|                                        |
|  +----------------------------------+  |
|  | GROSS PROFIT                     |  |
|  |                                  |  |
|  |        $47,150                   |  |
|  |        37.6% margin              |  |
|  +----------------------------------+  |
|                                        |
|  +----------------------------------+  |
|  | OUTSTANDING AR                   |  |
|  |                                  |  |
|  |        $18,450                   |  |
|  |        12 customers              |  |
|  +----------------------------------+  |
|                                        |
+----------------------------------------+
|                                        |
|  [v] P&L Details                       |
|  +----------------------------------+  |
|  | Revenue:         $125,400        |  |
|  |   Products:       $98,200        |  |
|  |   Services:       $27,200        |  |
|  | Costs:            $78,250        |  |
|  |   Materials:      $52,100        |  |
|  |   Labor:          $26,150        |  |
|  | Gross Profit:     $47,150        |  |
|  | Gross Margin:      37.6%         |  |
|  +----------------------------------+  |
|                                        |
|  [>] Cash Flow Details                 |
|                                        |
|  [>] AR Aging Details                  |
|                                        |
+----------------------------------------+
|                                        |
|  [star]  [calendar]  [Export v]        |
|                                        |
+========================================+
```

---

## Loading States

### Initial Load (Skeleton)

```
+-- SUMMARY CARDS -------------------------------------------+
|                                                            |
|  +------------+  +------------+  +------------+            |
|  | [shimmer==]|  | [shimmer==]|  | [shimmer==]|            |
|  | [shimmer=] |  | [shimmer=] |  | [shimmer=] |            |
|  +------------+  +------------+  +------------+            |
|                                                            |
+-- P&L TABLE -----------------------------------------------+
|                                                            |
|  +--------------------------------------------------------+|
|  | [shimmer=================================]              ||
|  | [shimmer======================]  [shimmer=]             ||
|  | [shimmer======================]  [shimmer=]             ||
|  | [shimmer======================]  [shimmer=]             ||
|  +--------------------------------------------------------+|
|                                                            |
+------------------------------------------------------------+

aria-busy="true"
aria-label="Loading financial summary data"
```

### Refreshing Data

```
+-- SUMMARY CARDS -------------------------------------------+
|                                                            |
|  +------------+  +------------+  +------------+            |
|  | [spinner]  |  | $78,250    |  | $47,150    |            |
|  | Updating...|  | +8.2% ^    |  | +18.7% ^   |            |
|  +------------+  +------------+  +------------+            |
|                                                            |
+------------------------------------------------------------+

- Only affected component shows spinner
- Other data remains visible
- aria-live="polite" announces completion
```

### Export Progress

```
+-- EXPORT DIALOG ------------------------------------------+
|                                                           |
|  Generating Financial Report...                           |
|                                                           |
|         [spinner]                                         |
|                                                           |
|  [=====================================] 85%              |
|                                                           |
|  Preparing PDF with 6 sections...                         |
|                                                           |
|  [Cancel]                                                 |
|                                                           |
+-----------------------------------------------------------+

aria-busy="true"
aria-label="Generating report, 85% complete"
```

---

## Empty States

### No Data for Period

```
+-- FINANCIAL SUMMARY --------------------------------------+
|                                                           |
|           [illustration: empty chart]                     |
|                                                           |
|     No financial data for selected period                 |
|                                                           |
|  There are no orders or transactions recorded             |
|  between January 1 - January 31, 2026.                    |
|                                                           |
|  Try selecting a different date range or check            |
|  that orders have been created in the system.             |
|                                                           |
|  [Change Date Range]    [View All Reports]                |
|                                                           |
+-----------------------------------------------------------+
```

### No AR Outstanding

```
+-- AR AGING -----------------------------------------------+
|                                                           |
|     [checkmark icon]                                      |
|                                                           |
|     All caught up!                                        |
|                                                           |
|  No outstanding accounts receivable                       |
|  for this period.                                         |
|                                                           |
+-----------------------------------------------------------+
```

### No Targets Configured

```
+-- BUDGET VS ACTUAL ---------------------------------------+
|                                                           |
|     [target icon]                                         |
|                                                           |
|     No targets configured                                 |
|                                                           |
|  Set revenue and performance targets to track             |
|  your business against goals.                             |
|                                                           |
|  [Configure Targets]                                      |
|                                                           |
+-----------------------------------------------------------+
```

---

## Error States

### Failed to Load Financial Data

```
+-- FINANCIAL SUMMARY --------------------------------------+
|                                                           |
|     [!] Unable to load financial data                     |
|                                                           |
|  We couldn't retrieve the financial summary.              |
|  This might be a temporary connection issue.              |
|                                                           |
|  [Retry]    [View Cached Data]                            |
|                                                           |
+-----------------------------------------------------------+

role="alert"
aria-live="assertive"
```

### Partial Load Error

```
+-- P&L SUMMARY (loaded) -----------------------------------+
|  ... data displays normally ...                           |
+-----------------------------------------------------------+

+-- CASH FLOW (error) --------------------------------------+
|                                                           |
|  [!] Cash flow data unavailable                           |
|                                                           |
|  [Retry Section]                                          |
|                                                           |
+-----------------------------------------------------------+

+-- AR AGING (loaded) --------------------------------------+
|  ... data displays normally ...                           |
+-----------------------------------------------------------+

- Partial errors show inline
- Other sections remain functional
```

### Export Failed

```
+-- EXPORT ERROR DIALOG ------------------------------------+
|                                                           |
|  [!] Export Failed                              [X]       |
|                                                           |
|  We couldn't generate your financial report.              |
|                                                           |
|  Error: PDF generation service unavailable                |
|                                                           |
|  Try exporting to CSV instead, or try again later.        |
|                                                           |
|  [Export CSV]    [Retry PDF]    [Close]                   |
|                                                           |
+-----------------------------------------------------------+
```

---

## Success States

### Export Complete

```
+-- TOAST NOTIFICATION -------------------------------------+
|                                                           |
|  [check] Financial Report exported                        |
|                                                           |
|  financial-summary-jan-2026.pdf downloaded                |
|                                                           |
|  [Open File]  [x]                                         |
|                                                           |
+-----------------------------------------------------------+

role="status"
aria-live="polite"
Auto-dismiss after 5 seconds
```

### Favorite Added

```
+-- TOAST NOTIFICATION -------------------------------------+
|                                                           |
|  [star] Added to favorites                                |
|                                                           |
|  Financial Summary (MTD) saved with current filters       |
|                                                           |
|  [View Favorites]  [x]                                    |
|                                                           |
+-----------------------------------------------------------+
```

---

## Accessibility Specification

### ARIA Landmarks and Roles

```html
<!-- Page structure -->
<main aria-label="Financial Summary Report">
  <header>
    <h1>Financial Summary</h1>
    <nav aria-label="Report actions">
      <button aria-label="Add to favorites">...</button>
      <button aria-label="Schedule report">...</button>
      <button aria-expanded="false" aria-haspopup="menu">Export</button>
    </nav>
  </header>

  <!-- Date controls -->
  <section aria-label="Date range selection">
    <fieldset>
      <legend class="sr-only">Select reporting period</legend>
      ...
    </fieldset>
  </section>

  <!-- KPI Cards -->
  <section aria-label="Key financial metrics" aria-live="polite">
    <div role="region" aria-label="Gross Revenue">
      <span class="metric-value">$125,400</span>
      <span class="metric-change">up 12.5% from last month</span>
    </div>
    ...
  </section>

  <!-- P&L Table -->
  <section aria-label="Profit and Loss Statement">
    <table role="table" aria-label="Income statement breakdown">
      <thead>...</thead>
      <tbody>...</tbody>
    </table>
  </section>

  <!-- AR Aging -->
  <section aria-label="Accounts Receivable Aging">
    <table role="table" aria-label="AR aging breakdown">
      ...
    </table>
  </section>
</main>
```

### Keyboard Navigation

```
Tab Order:
1. Favorite button
2. Schedule button
3. Export dropdown
4. Print button
5. Period selector
6. Compare selector
7. Quick filter buttons (MTD, QTD, YTD, etc.)
8. P&L table rows (if interactive)
9. AR aging table rows
10. View AR Details link
11. Revenue chart (focusable for screen readers)

Shortcuts:
- R: Refresh data
- E: Open export menu
- P: Print report
- F: Toggle favorite
- Escape: Close any open dropdown/dialog
```

### Screen Reader Announcements

```
On page load:
  "Financial Summary Report. Showing data for January 2026
   compared to December 2025. Gross revenue $125,400,
   up 12.5% from prior period."

On period change:
  "Displaying financial data for Q4 2025.
   Loading updated metrics."

On data loaded:
  "Financial data updated. Gross revenue $380,000,
   gross margin 36.2%."

On favorite added:
  "Financial Summary with January 2026 filters added
   to favorites."

On export complete:
  "PDF report downloaded: financial-summary-jan-2026.pdf"
```

---

## Animation Choreography

### Page Load Sequence

```
Timeline (total: 600ms):

0ms   - Page header and controls fade in
        opacity: 0 -> 1
        duration: 150ms
        easing: ease-out

100ms - KPI cards cascade in (staggered)
        transform: translateY(8px) -> translateY(0)
        opacity: 0 -> 1
        duration: 200ms each
        stagger: 50ms between cards
        easing: ease-out

300ms - P&L table section slides in
        transform: translateY(12px) -> translateY(0)
        opacity: 0 -> 1
        duration: 250ms
        easing: ease-out

400ms - Cash flow and AR sections fade in
        opacity: 0 -> 1
        duration: 200ms
        easing: ease-out

600ms - Chart animates in
        Line draws from left to right
        duration: 400ms
        easing: ease-in-out
```

### Value Change Animation

```
When metrics update:

- Old value fades out (100ms)
- New value fades in with slight scale (150ms)
- Change indicator slides in from right (200ms)
- Subtle color pulse on card (300ms)

Respect prefers-reduced-motion:
- Skip all transform animations
- Keep opacity transitions at reduced duration (100ms)
```

### Export Progress Animation

```
Progress bar:
- Linear fill animation
- Duration matches actual progress
- Indeterminate shimmer if progress unknown

On complete:
- Progress bar fills to 100%
- Transforms to success checkmark (200ms)
- Dialog auto-closes after 1.5s
```

---

## Component Props Interfaces (TypeScript)

```typescript
// Main Report Component
interface FinancialSummaryReportProps {
  /** Initial date range for the report */
  initialPeriod?: DateRange;
  /** Optional comparison period */
  comparisonPeriod?: DateRange;
  /** Whether to show target comparisons */
  showTargets?: boolean;
  /** Callback when period changes */
  onPeriodChange?: (period: DateRange) => void;
  /** Callback when export is triggered */
  onExport?: (format: 'csv' | 'pdf') => Promise<void>;
}

// Date Range Type
interface DateRange {
  start: Date;
  end: Date;
  preset?: 'mtd' | 'qtd' | 'ytd' | 'last30' | 'last90' | 'custom';
}

// KPI Card Component
interface FinancialKPICardProps {
  /** Card title */
  title: string;
  /** Primary metric value */
  value: number | string;
  /** Format type for display */
  format: 'currency' | 'percentage' | 'number';
  /** Change from comparison period */
  change?: {
    value: number;
    direction: 'up' | 'down' | 'flat';
    /** For percentages, show as percentage points */
    isPercentagePoints?: boolean;
  };
  /** Comparison value */
  comparisonValue?: number | string;
  /** Loading state */
  isLoading?: boolean;
  /** Error state */
  error?: string;
  /** ARIA label override */
  ariaLabel?: string;
}

// P&L Table Component
interface PLStatementTableProps {
  /** Revenue line items */
  revenue: PLLineItem[];
  /** Cost line items */
  costs: PLLineItem[];
  /** Comparison period data */
  comparisonData?: {
    revenue: PLLineItem[];
    costs: PLLineItem[];
  };
  /** Loading state */
  isLoading?: boolean;
  /** Error state */
  error?: string;
}

interface PLLineItem {
  id: string;
  label: string;
  amount: number;
  category: 'revenue' | 'cost';
  isSubtotal?: boolean;
  isTotal?: boolean;
}

// AR Aging Component
interface ARAgingTableProps {
  /** Aging buckets data */
  buckets: ARAgingBucket[];
  /** Total outstanding */
  totalOutstanding: number;
  /** Number of customers with AR */
  customerCount: number;
  /** Loading state */
  isLoading?: boolean;
  /** Callback to view AR details */
  onViewDetails?: () => void;
}

interface ARAgingBucket {
  label: string;
  days: { min: number; max: number | null };
  amount: number;
  count: number;
  status: 'current' | 'warning' | 'overdue' | 'critical';
}

// Cash Flow Component
interface CashFlowSummaryProps {
  /** Total inflows */
  inflows: CashFlowLine[];
  /** Total outflows */
  outflows: CashFlowLine[];
  /** Net cash flow */
  netFlow: number;
  /** Loading state */
  isLoading?: boolean;
}

interface CashFlowLine {
  label: string;
  amount: number;
  type: 'inflow' | 'outflow';
}

// Revenue Trend Chart Component
interface RevenueTrendChartProps {
  /** Chart data points */
  data: TrendDataPoint[];
  /** Optional target line */
  targetLine?: number;
  /** Time granularity */
  granularity: 'day' | 'week' | 'month';
  /** Height in pixels */
  height?: number;
  /** Loading state */
  isLoading?: boolean;
}

interface TrendDataPoint {
  date: string;
  revenue: number;
  costs: number;
}

// Export Menu Component
interface ReportExportMenuProps {
  /** Report identifier */
  reportType: 'financial' | 'sales' | 'pipeline' | 'inventory';
  /** Current filters/parameters */
  parameters: Record<string, unknown>;
  /** Available export formats */
  formats: Array<'csv' | 'pdf' | 'excel'>;
  /** Export handler */
  onExport: (format: 'csv' | 'pdf' | 'excel') => Promise<void>;
  /** Loading state during export */
  isExporting?: boolean;
  /** Disabled state */
  disabled?: boolean;
}
```

---

## Component Mapping

| Wireframe Element | React Component | shadcn/ui Base |
|-------------------|-----------------|----------------|
| Report page wrapper | FinancialSummaryReport | - |
| Report header | ReportLayout (existing) | - |
| Date range picker | DateRangePicker | Calendar, Popover |
| Quick filter buttons | ButtonGroup | Button |
| KPI cards row | FinancialKPICards | Card |
| Single KPI card | FinancialKPICard | Card |
| P&L table | PLStatementTable | Table |
| Cash flow summary | CashFlowSummary | Card |
| AR aging table | ARAgingTable | Table |
| Status badge | AgingStatusBadge | Badge |
| Revenue trend chart | RevenueTrendChart | - (recharts) |
| Export dropdown | ReportExportMenu | DropdownMenu |
| Loading skeleton | ReportSkeleton | Skeleton |
| Empty state | ReportEmptyState | - |
| Error state | ReportErrorState | Alert |

---

## Performance Requirements

| Metric | Target | Measurement |
|--------|--------|-------------|
| Initial page load | < 1.5s | Time to first meaningful paint |
| Data fetch | < 800ms | All financial metrics loaded |
| Period change | < 500ms | New data displayed |
| Chart render | < 200ms | After data received |
| Export generation (CSV) | < 2s | Download starts |
| Export generation (PDF) | < 5s | Download starts |
| Date picker open | < 100ms | Calendar visible |

---

## Files to Create/Modify

```
src/routes/_authed/reports/financial.tsx (create)
src/components/domain/reports/financial-summary/
  - financial-summary-report.tsx (create)
  - financial-kpi-cards.tsx (create)
  - pl-statement-table.tsx (create)
  - cash-flow-summary.tsx (create)
  - ar-aging-table.tsx (create)
  - revenue-trend-chart.tsx (create)
src/server/functions/reports.ts (extend with financial report data)
```

---

## Related Wireframes

- [Report Schedule UI](./DOM-RPT-005c.wireframe.md)
- [Report Favorites](./DOM-RPT-006c.wireframe.md)
- [Dashboard Main](./dashboard-main.wireframe.md)

---

**Document Version:** 1.0
**Created:** 2026-01-10
**Author:** Claude Code
