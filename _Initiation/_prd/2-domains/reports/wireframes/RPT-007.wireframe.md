# DOM-RPT-007: Simple Report Builder

> **PRD**: reports.prd.json
> **Story**: DOM-RPT-007 - Add Simple Report Builder
> **Priority**: 8
> **Route**: `/reports/builder`
> **Note**: High complexity - comprehensive UI for custom report creation

---

## Dependencies

> **IMPORTANT**: This wireframe requires backend stories to complete first.

| Dependency Type | Requirement | Status |
|-----------------|-------------|--------|
| **Schema Required** | custom_reports, report_configs | NOT CREATED |
| **Server Functions Required** | createCustomReport, updateCustomReport, deleteCustomReport, getCustomReports, runCustomReport, getDataSourceSchema, generatePreview | NOT CREATED |
| **PRD Stories (Must Complete First)** | DOM-RPT-007 | PENDING |

### Existing Schema Available
- `orders` in `renoz-v2/lib/schema/orders.ts` - data source for custom reports
- `opportunities` in `renoz-v2/lib/schema/opportunities.ts` - data source for custom reports
- `products`, `inventoryItems` in `renoz-v2/lib/schema/products.ts` - data source for custom reports
- `customers` in `renoz-v2/lib/schema/customers.ts` - data source for custom reports

### Renoz Business Context
- **Industry**: Australian B2B battery manufacturer
- **Key Metrics**: kWh deployed, Quote win rate, Installation completion rate, Warranty claim rate
- **Product Categories**: Battery Systems, Inverters, Solar, Services
- **Currency**: AUD with GST (10%)
- **Fiscal Year**: July-June (Australian)
- **Report Users**: Admin, Sales, Installation managers

---

## Overview

Create basic custom reports with data source selection, column configuration, filtering, sorting, and grouping. Users can save and share custom reports with their team.

**Design Aesthetic**: Structured Workflow - step-by-step report creation with live preview
**Primary Device**: Desktop (report creation)
**Secondary**: Tablet (report viewing)

---

## UI Patterns (Reference Implementation)

### RadioGroup
- **Pattern**: RE-UI RadioGroup
- **Reference**: `_reference/.reui-reference/registry/default/ui/radio-group.tsx`
- **Features**:
  - Data source selection (Customers/Orders/Products)
  - Filter match mode (All filters AND vs Any filter OR)
  - Column alignment options (Left/Center/Right)

### Checkbox
- **Pattern**: RE-UI Checkbox
- **Reference**: `_reference/.reui-reference/registry/default/ui/checkbox.tsx`
- **Features**:
  - Column selection with drag handles for reordering
  - Select All / Clear All for column selection
  - Group display options (show subtotals, collapse by default)

### Select
- **Pattern**: RE-UI Select
- **Reference**: `_reference/.reui-reference/registry/default/ui/select.tsx`
- **Features**:
  - Filter operator selection (equals, contains, greater than, etc.)
  - Sort column and direction selection
  - Group by column selector

### Input
- **Pattern**: RE-UI Input
- **Reference**: `_reference/.reui-reference/registry/default/ui/input.tsx`
- **Features**:
  - Report name input with auto-save indication
  - Filter value input with type-specific validation
  - Column display label customization

### DataTable
- **Pattern**: RE-UI DataTable
- **Reference**: `_reference/.reui-reference/registry/default/ui/data-table.tsx`
- **Features**:
  - Live preview table with configurable columns
  - Grouped data display with expand/collapse
  - Full report view with pagination and sorting

### Dialog
- **Pattern**: RE-UI Dialog
- **Reference**: `_reference/.reui-reference/registry/default/ui/dialog.tsx`
- **Features**:
  - Save report dialog with name, description, and sharing options
  - Column settings dialog for formatting and alignment
  - Advanced filter configuration modal

### Card
- **Pattern**: RE-UI Card
- **Reference**: `_reference/.reui-reference/registry/default/ui/card.tsx`
- **Features**:
  - Data source option cards with descriptions
  - Saved report cards with metadata (columns, filters, last run)
  - Configuration section cards (Data Source, Columns, Filters, Sort & Group)

### Textarea
- **Pattern**: RE-UI Textarea
- **Reference**: `_reference/.reui-reference/registry/default/ui/textarea.tsx`
- **Features**:
  - Multi-line description input for saved reports
  - Notes or comments for complex filter configurations

---

## Desktop Wireframe (1280px+)

### Report Builder - Main Interface

```
+================================================================================+
| Renoz CRM                                                    [bell] [Joel v]   |
+-------------+------------------------------------------------------------------+
|             |                                                                  |
| Dashboard   |  Reports > Report Builder                                        |
| Customers   |  ================================================================|
| Installation Orders      |                                                                  |
| Battery Systems    |  +-- BUILDER HEADER -----------------------------------------------+
| Jobs        |  |                                                                |
| Reports <   |  |  [Untitled Report___________]  [Save] [Save As] [Export v]    |
|  > Builder <|  |                                                                |
|             |  |  Last saved: Not yet saved | Changes: Unsaved                  |
|             |  |                                                                |
|             |  +----------------------------------------------------------------+
|             |                                                                  |
|             |  +-- BUILDER LAYOUT (Split View) ---------------------------------+
|             |  |                                                                |
|             |  | +== CONFIGURATION (Left Panel - 380px) =====================+ |
|             |  | |                                                            | |
|             |  | | +-- STEP 1: DATA SOURCE ---------------------------------+ | |
|             |  | | |                                                        | | |
|             |  | | |  Select data source:                                   | | |
|             |  | | |                                                        | | |
|             |  | | |  (o) Customers                                         | | |
|             |  | | |  ( ) Installation Orders                                            | | |
|             |  | | |  ( ) Battery Systems                                          | | |
|             |  | | |                                                        | | |
|             |  | | |  [i] Data source determines available columns          | | |
|             |  | | |                                                        | | |
|             |  | | +--------------------------------------------------------+ | |
|             |  | |                                                            | |
|             |  | | +-- STEP 2: COLUMNS ------------------------------------+ | |
|             |  | | |                                                        | | |
|             |  | | |  Select columns to display:                            | | |
|             |  | | |                                                        | | |
|             |  | | |  [x] Name                      [drag handle]           | | |
|             |  | | |  [x] Email                     [drag handle]           | | |
|             |  | | |  [x] Total Installation Orders              [drag handle]           | | |
|             |  | | |  [x] Total Spent               [drag handle]           | | |
|             |  | | |  [ ] Last Order Date                                   | | |
|             |  | | |  [ ] Phone                                             | | |
|             |  | | |  [ ] Address                                           | | |
|             |  | | |  [ ] Customer Type                                     | | |
|             |  | | |  [ ] Created Date                                      | | |
|             |  | | |  [ ] Status                                            | | |
|             |  | | |                                                        | | |
|             |  | | |  [Select All]  [Clear All]  4 of 10 selected           | | |
|             |  | | |                                                        | | |
|             |  | | +--------------------------------------------------------+ | |
|             |  | |                                                            | |
|             |  | | +-- STEP 3: FILTERS ------------------------------------+ | |
|             |  | | |                                                        | | |
|             |  | | |  Add filters (optional):                               | | |
|             |  | | |                                                        | | |
|             |  | | |  +----------------------------------------------------+| | |
|             |  | | |  | Total Spent  | is greater than | [$1,000] [x]      || | |
|             |  | | |  +----------------------------------------------------+| | |
|             |  | | |  +----------------------------------------------------+| | |
|             |  | | |  | Status       | equals          | [Active] [x]      || | |
|             |  | | |  +----------------------------------------------------+| | |
|             |  | | |                                                        | | |
|             |  | | |  [+ Add Filter]                                        | | |
|             |  | | |                                                        | | |
|             |  | | +--------------------------------------------------------+ | |
|             |  | |                                                            | |
|             |  | | +-- STEP 4: SORT & GROUP -------------------------------+ | |
|             |  | | |                                                        | | |
|             |  | | |  Sort by:                                              | | |
|             |  | | |  +--------------------------------+ [Descending v]     | | |
|             |  | | |  | Total Spent                   v|                    | | |
|             |  | | |  +--------------------------------+                    | | |
|             |  | | |                                                        | | |
|             |  | | |  Group by (optional):                                  | | |
|             |  | | |  +--------------------------------+                    | | |
|             |  | | |  | None                          v|                    | | |
|             |  | | |  +--------------------------------+                    | | |
|             |  | | |                                                        | | |
|             |  | | +--------------------------------------------------------+ | |
|             |  | |                                                            | |
|             |  | +=============================================================+ |
|             |  |                                                                |
|             |  | +== PREVIEW (Right Panel - Remaining Width) =================+ |
|             |  | |                                                            | |
|             |  | | +-- PREVIEW HEADER ------------------------------------+ | |
|             |  | | |                                                        | | |
|             |  | | |  Preview (showing 10 of 156 results)  [Refresh]        | | |
|             |  | | |                                                        | | |
|             |  | | +--------------------------------------------------------+ | |
|             |  | |                                                            | |
|             |  | | +-- PREVIEW TABLE --------------------------------------+ | |
|             |  | | |                                                        | | |
|             |  | | |  +-- Name -----+-- Email ------------+-- Installation Orders -+-- Spent --+|
|             |  | | |  | Acme Corp   | contact@acme.com    |    45     | $125,000  ||
|             |  | | |  | Beta Inc    | info@beta.com       |    38     | $98,500   ||
|             |  | | |  | Gamma Ltd   | sales@gamma.com     |    32     | $87,200   ||
|             |  | | |  | Delta Co    | hello@delta.com     |    28     | $72,100   ||
|             |  | | |  | Epsilon     | team@epsilon.com    |    25     | $65,400   ||
|             |  | | |  | Zeta Corp   | info@zeta.com       |    22     | $54,800   ||
|             |  | | |  | Eta LLC     | contact@eta.com     |    19     | $48,200   ||
|             |  | | |  | Theta Inc   | sales@theta.com     |    17     | $42,100   ||
|             |  | | |  | Iota Co     | hello@iota.com      |    15     | $38,500   ||
|             |  | | |  | Kappa Ltd   | info@kappa.com      |    14     | $35,200   ||
|             |  | | |  +------------------------------------------------------+|
|             |  | | |                                                        | | |
|             |  | | |  ... and 146 more rows                                 | | |
|             |  | | |                                                        | | |
|             |  | | +--------------------------------------------------------+ | |
|             |  | |                                                            | |
|             |  | +=============================================================+ |
|             |  |                                                                |
|             |  +----------------------------------------------------------------+
|             |                                                                  |
+-------------+------------------------------------------------------------------+
```

### Data Source Selection (Expanded)

```
+-- STEP 1: DATA SOURCE -----------------------------------------+
|                                                                |
|  Select data source:                                           |
|                                                                |
|  +------------------------------------------------------------+|
|  |                                                            ||
|  | (o) Customers                                              ||
|  |     Customer records with contact info, orders, spending   ||
|  |     156 records available                                  ||
|  |                                                            ||
|  +------------------------------------------------------------+|
|  +------------------------------------------------------------+|
|  |                                                            ||
|  | ( ) Installation Orders                                                 ||
|  |     All orders with line items, status, amounts            ||
|  |     1,245 records available                                ||
|  |                                                            ||
|  +------------------------------------------------------------+|
|  +------------------------------------------------------------+|
|  |                                                            ||
|  | ( ) Battery Systems                                               ||
|  |     Product catalog with inventory and pricing             ||
|  |     89 records available                                   ||
|  |                                                            ||
|  +------------------------------------------------------------+|
|                                                                |
|  [i] Choose the primary data you want to analyze.              |
|      Related data can be included via columns.                 |
|                                                                |
+----------------------------------------------------------------+
```

### Column Configuration (With Drag Reorder)

```
+-- STEP 2: COLUMNS ---------------------------------------------+
|                                                                |
|  Select and arrange columns:                                   |
|                                                                |
|  SELECTED (drag to reorder)                                    |
|  +------------------------------------------------------------+|
|  | [=] [x] Name               Primary identifier       [gear] ||
|  +------------------------------------------------------------+|
|  | [=] [x] Email              Contact email            [gear] ||
|  +------------------------------------------------------------+|
|  | [=] [x] Total Installation Orders       Sum of orders            [gear] ||
|  +------------------------------------------------------------+|
|  | [=] [x] Total Spent        Sum of order amounts     [gear] ||
|  +------------------------------------------------------------+|
|                                                                |
|  AVAILABLE                                                     |
|  +------------------------------------------------------------+|
|  | [ ] Last Order Date    Most recent order                   ||
|  | [ ] Phone              Primary phone number                ||
|  | [ ] Address            Full address                        ||
|  | [ ] Customer Type      Residential/Commercial              ||
|  | [ ] Created Date       When customer was added             ||
|  | [ ] Status             Active/Inactive                     ||
|  +------------------------------------------------------------+|
|                                                                |
|  [Select All]  [Clear All]  4 of 10 selected                   |
|                                                                |
+----------------------------------------------------------------+
```

### Column Settings Dialog

```
+== COLUMN SETTINGS =============================================+
|                                                          [X]   |
+================================================================+
|                                                                |
|  Total Spent                                                   |
|                                                                |
|  Display Label:                                                |
|  +------------------------------------------------------------+|
|  | Total Revenue                                              ||
|  +------------------------------------------------------------+|
|                                                                |
|  Format:                                                       |
|  (o) Currency ($1,234.56)                                      |
|  ( ) Number (1234.56)                                          |
|  ( ) Integer (1234)                                            |
|                                                                |
|  Alignment:                                                    |
|  ( ) Left  ( ) Center  (o) Right                               |
|                                                                |
|  Width:                                                        |
|  ( ) Auto  (o) Fixed: [120px]                                  |
|                                                                |
+================================================================+
|                                                                |
|               ( Cancel )            [ Apply Settings ]         |
|                                                                |
+================================================================+
```

### Filter Builder

```
+-- STEP 3: FILTERS ---------------------------------------------+
|                                                                |
|  Add filters to narrow down results:                           |
|                                                                |
|  +-- Filter 1 -----------------------------------------------+ |
|  |                                                           | |
|  |  Field:              Operator:           Value:           | |
|  |  +------------+      +--------------+    +-------------+  | |
|  |  |Total Spent|v|    |is greater   |v|  |[$1,000     ]|  | |
|  |  +------------+      +--------------+    +-------------+  | |
|  |                                                       [x] | |
|  +-----------------------------------------------------------+ |
|                                                                |
|  +-- Filter 2 -----------------------------------------------+ |
|  |                                                           | |
|  |  Field:              Operator:           Value:           | |
|  |  +------------+      +--------------+    +-------------+  | |
|  |  |Status     |v|    |equals       |v|  |[Active    ]v|  | |
|  |  +------------+      +--------------+    +-------------+  | |
|  |                                                       [x] | |
|  +-----------------------------------------------------------+ |
|                                                                |
|  Match: (o) All filters (AND)  ( ) Any filter (OR)             |
|                                                                |
|  [+ Add Filter]                                                |
|                                                                |
+----------------------------------------------------------------+
```

### Filter Operators by Field Type

```
+-- OPERATOR OPTIONS BY TYPE ------------------------------------+
|                                                                |
|  TEXT FIELDS:                                                  |
|  - contains                                                    |
|  - does not contain                                            |
|  - equals                                                      |
|  - does not equal                                              |
|  - starts with                                                 |
|  - ends with                                                   |
|  - is empty                                                    |
|  - is not empty                                                |
|                                                                |
|  NUMBER/CURRENCY FIELDS:                                       |
|  - equals                                                      |
|  - does not equal                                              |
|  - is greater than                                             |
|  - is greater than or equal                                    |
|  - is less than                                                |
|  - is less than or equal                                       |
|  - is between                                                  |
|  - is empty                                                    |
|                                                                |
|  DATE FIELDS:                                                  |
|  - equals                                                      |
|  - is before                                                   |
|  - is after                                                    |
|  - is between                                                  |
|  - is in the last [N] days                                     |
|  - is empty                                                    |
|                                                                |
|  SELECT/ENUM FIELDS:                                           |
|  - equals                                                      |
|  - does not equal                                              |
|  - is one of                                                   |
|  - is empty                                                    |
|                                                                |
+----------------------------------------------------------------+
```

### Sort & Group Configuration

```
+-- STEP 4: SORT & GROUP ----------------------------------------+
|                                                                |
|  Primary Sort:                                                 |
|  +--------------------------------+ [Descending v]             |
|  | Total Spent                   v|                            |
|  +--------------------------------+                            |
|                                                                |
|  Secondary Sort (optional):                                    |
|  +--------------------------------+ [Ascending v]              |
|  | Name                          v|                            |
|  +--------------------------------+                            |
|                                                                |
|  ------------------------------------------------------------ |
|                                                                |
|  Group By (optional):                                          |
|  +--------------------------------+                            |
|  | Customer Type                 v|                            |
|  +--------------------------------+                            |
|                                                                |
|  [x] Show group subtotals                                      |
|  [x] Collapse groups by default                                |
|                                                                |
+----------------------------------------------------------------+
```

### Preview with Grouping

```
+-- PREVIEW TABLE (Grouped by Customer Type) --------------------+
|                                                                |
|  +-- Commercial (85 customers) --------------------------[-]--+|
|  |                                                            ||
|  | +-- Name -----+-- Email ------------+-- Installation Orders -+-- Spent --+|
|  | | Acme Corp   | contact@acme.com    |    45     | $125,000  ||
|  | | Beta Inc    | info@beta.com       |    38     | $98,500   ||
|  | | Gamma Ltd   | sales@gamma.com     |    32     | $87,200   ||
|  | +------------------------------------------------------+   ||
|  | | SUBTOTAL    |                     |   312     | $856,200  ||
|  | +------------------------------------------------------+   ||
|  |                                                            ||
|  +------------------------------------------------------------+|
|                                                                |
|  +-- Residential (71 customers) -------------------------[+]--+|
|  |  (collapsed - click to expand)                             ||
|  |  Subtotal: 198 orders, $412,800                            ||
|  +------------------------------------------------------------+|
|                                                                |
|  +-- GRAND TOTAL ---------------------------------------------+|
|  |  156 customers | 510 orders | $1,269,000                   ||
|  +------------------------------------------------------------+|
|                                                                |
+----------------------------------------------------------------+
```

---

## Save Report Dialog

```
+== SAVE REPORT =================================================+
|                                                          [X]   |
+================================================================+
|                                                                |
|  Save your custom report for future use.                       |
|                                                                |
|  Report Name *                                                 |
|  +------------------------------------------------------------+|
|  | Top Customers by Revenue                                   ||
|  +------------------------------------------------------------+|
|                                                                |
|  Description (optional):                                       |
|  +------------------------------------------------------------+|
|  | Active customers who have spent over $1,000, sorted by     ||
|  | total revenue descending.                                  ||
|  +------------------------------------------------------------+|
|                                                                |
|  Sharing:                                                      |
|  (o) Private - Only I can see this report                      |
|  ( ) Team - Share with my organization                         |
|                                                                |
+================================================================+
|                                                                |
|               ( Cancel )              [ Save Report ]          |
|                                                                |
+================================================================+
```

---

## Saved Reports List

```
+================================================================================+
| Renoz CRM                                                    [bell] [Joel v]   |
+-------------+------------------------------------------------------------------+
|             |                                                                  |
| Reports <   |  Reports > Custom Reports                                        |
|  > Builder  |  ================================================================|
|             |                                                                  |
|             |  Your saved custom reports.                          [+ New]     |
|             |                                                                  |
|             |  +-- MY REPORTS ----------------------------------------------+  |
|             |  |                                                            |  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |  | Top Customers by Revenue                               ||  |
|             |  |  | Customers | 4 columns | 2 filters | Last run: 2h ago   ||  |
|             |  |  |                                                        ||  |
|             |  |  | [Run Report]  [Edit]  [Duplicate]  [...]               ||  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |                                                            |  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |  | Installation Orders This Quarter                                    ||  |
|             |  |  | Installation Orders | 6 columns | 1 filter | Last run: Yesterday    ||  |
|             |  |  |                                                        ||  |
|             |  |  | [Run Report]  [Edit]  [Duplicate]  [...]               ||  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |                                                            |  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |  | Low Stock Battery Systems                                     ||  |
|             |  |  | Battery Systems | 5 columns | 1 filter | Last run: 3 days ago ||  |
|             |  |  |                                                        ||  |
|             |  |  | [Run Report]  [Edit]  [Duplicate]  [...]               ||  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |                                                            |  |
|             |  +------------------------------------------------------------+  |
|             |                                                                  |
|             |  +-- SHARED WITH ME -------------------------------------------+  |
|             |  |                                                            |  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |  | Sales Team Pipeline                     Shared by: Sarah||  |
|             |  |  | Customers | 5 columns | 0 filters | Last run: 1h ago   ||  |
|             |  |  |                                                        ||  |
|             |  |  | [Run Report]  [Duplicate]                              ||  |
|             |  |  +--------------------------------------------------------+|  |
|             |  |                                                            |  |
|             |  +------------------------------------------------------------+  |
|             |                                                                  |
+-------------+------------------------------------------------------------------+
```

---

## Report View (Generated Report)

```
+================================================================================+
| Renoz CRM                                                    [bell] [Joel v]   |
+-------------+------------------------------------------------------------------+
|             |                                                                  |
| Reports <   |  Reports > Top Customers by Revenue                              |
|             |  ================================================================|
|             |                                                                  |
|             |  +-- REPORT HEADER -------------------------------------------+  |
|             |  |                                                            |  |
|             |  |  Top Customers by Revenue                                  |  |
|             |  |  Active customers who have spent over $1,000               |  |
|             |  |                                                            |  |
|             |  |  [star] [calendar] [Edit Report] [Export v] [Print]        |  |
|             |  |                                                            |  |
|             |  +------------------------------------------------------------+  |
|             |                                                                  |
|             |  +-- APPLIED FILTERS -----------------------------------------+  |
|             |  |                                                            |  |
|             |  |  Total Spent > $1,000  |  Status = Active  [Clear All]     |  |
|             |  |                                                            |  |
|             |  +------------------------------------------------------------+  |
|             |                                                                  |
|             |  +-- REPORT DATA ---------------------------------------------+  |
|             |  |                                                            |  |
|             |  |  156 records | Generated: Jan 10, 2026 2:30 PM             |  |
|             |  |                                                            |  |
|             |  |  +-- Name -----+-- Email ------------+-- Installation Orders -+-- Spent --+|
|             |  |  | Acme Corp   | contact@acme.com    |    45     | $125,000  ||
|             |  |  | Beta Inc    | info@beta.com       |    38     | $98,500   ||
|             |  |  | Gamma Ltd   | sales@gamma.com     |    32     | $87,200   ||
|             |  |  | Delta Co    | hello@delta.com     |    28     | $72,100   ||
|             |  |  | Epsilon     | team@epsilon.com    |    25     | $65,400   ||
|             |  |  | ...         | ...                 |    ...    | ...       ||
|             |  |  +------------------------------------------------------+  |
|             |  |                                                            |  |
|             |  |  Showing 1-25 of 156               < 1 [2] 3 4 ... 7 >     |  |
|             |  |                                                            |  |
|             |  +------------------------------------------------------------+  |
|             |                                                                  |
+-------------+------------------------------------------------------------------+
```

---

## Tablet Wireframe (768px)

### Report Builder (Tablet - Stacked Layout)

```
+================================================================+
| < Report Builder                                                 |
+----------------------------------------------------------------+
| [Untitled Report________]                    [Save]  [Export]    |
+----------------------------------------------------------------+
|                                                                  |
|  === DATA SOURCE ===                                             |
|  +------------------------------------------------------------+ |
|  | (o) Customers  ( ) Installation Orders  ( ) Battery Systems                     | |
|  +------------------------------------------------------------+ |
|                                                                  |
|  === COLUMNS (4 selected) ===                           [Edit]   |
|  Name, Email, Total Installation Orders, Total Spent                          |
|                                                                  |
|  === FILTERS (2 applied) ===                            [Edit]   |
|  Total Spent > $1,000 | Status = Active                          |
|                                                                  |
|  === SORT ===                                           [Edit]   |
|  Total Spent (Descending)                                        |
|                                                                  |
+----------------------------------------------------------------+
|                                                                  |
|  PREVIEW (10 of 156)                                [Refresh]    |
|                                                                  |
|  +------------------------------------------------------------+ |
|  | Name          | Email              | Installation Orders | Spent         | |
|  +------------------------------------------------------------+ |
|  | Acme Corp     | contact@acme.com   | 45     | $125,000      | |
|  | Beta Inc      | info@beta.com      | 38     | $98,500       | |
|  | Gamma Ltd     | sales@gamma.com    | 32     | $87,200       | |
|  | Delta Co      | hello@delta.com    | 28     | $72,100       | |
|  | Epsilon       | team@epsilon.com   | 25     | $65,400       | |
|  +------------------------------------------------------------+ |
|  ... and 151 more                                                |
|                                                                  |
+================================================================+
```

### Column Editor (Tablet - Bottom Sheet)

```
+================================================================+
|                                                                  |
|    --- drag handle ---                                           |
|                                                                  |
+----------------------------------------------------------------+
| Select Columns                                             [X]   |
+----------------------------------------------------------------+
|                                                                  |
|  SELECTED (drag to reorder)                                      |
|  +------------------------------------------------------------+ |
|  | [=] [x] Name                                               | |
|  | [=] [x] Email                                              | |
|  | [=] [x] Total Installation Orders                                       | |
|  | [=] [x] Total Spent                                        | |
|  +------------------------------------------------------------+ |
|                                                                  |
|  AVAILABLE                                                       |
|  +------------------------------------------------------------+ |
|  | [ ] Last Order Date                                        | |
|  | [ ] Phone                                                  | |
|  | [ ] Address                                                | |
|  | [ ] Customer Type                                          | |
|  | [ ] Created Date                                           | |
|  | [ ] Status                                                 | |
|  +------------------------------------------------------------+ |
|                                                                  |
|  [Clear All]                                   [ Apply (4) ]     |
|                                                                  |
+================================================================+
```

---

## Mobile Wireframe (375px)

### Report Builder (Mobile - View/Run Only)

```
+========================================+
| < Custom Reports                       |
+----------------------------------------+
|                                        |
|  [!] Report builder works best on      |
|      larger screens. You can view      |
|      and run saved reports here.       |
|                                        |
+----------------------------------------+
|                                        |
|  MY REPORTS                            |
|                                        |
|  +----------------------------------+  |
|  | Top Customers by Revenue         |  |
|  | Customers | 4 cols | 2 filters   |  |
|  |                                  |  |
|  | [Run Report]              [...]  |  |
|  +----------------------------------+  |
|                                        |
|  +----------------------------------+  |
|  | Installation Orders This Quarter              |  |
|  | Installation Orders | 6 cols | 1 filter       |  |
|  |                                  |  |
|  | [Run Report]              [...]  |  |
|  +----------------------------------+  |
|                                        |
|  +----------------------------------+  |
|  | Low Stock Battery Systems               |  |
|  | Battery Systems | 5 cols | 1 filter     |  |
|  |                                  |  |
|  | [Run Report]              [...]  |  |
|  +----------------------------------+  |
|                                        |
+----------------------------------------+
|                                        |
|  SHARED WITH ME                        |
|                                        |
|  +----------------------------------+  |
|  | Sales Team Pipeline              |  |
|  | By: Sarah                        |  |
|  | [Run Report]              [...]  |  |
|  +----------------------------------+  |
|                                        |
+========================================+
```

### Report View (Mobile - Horizontal Scroll)

```
+========================================+
| < Top Customers by Revenue             |
+----------------------------------------+
|                                        |
|  [star]  [share]  [...]                |
|                                        |
|  Filters: Spent > $1K, Active          |
|                                        |
+----------------------------------------+
|                                        |
|  156 records                           |
|                                        |
|  +----------------------------------+  |
|  |<- scroll horizontally ->         |  |
|  |                                  |  |
|  | Name      | Email    | Installation Orders ...|  |
|  | Acme Corp | contact@ | 45     ...|  |
|  | Beta Inc  | info@    | 38     ...|  |
|  | Gamma Ltd | sales@   | 32     ...|  |
|  | Delta Co  | hello@   | 28     ...|  |
|  |                                  |  |
|  +----------------------------------+  |
|                                        |
|  < 1 2 3 4 5 >                         |
|                                        |
+----------------------------------------+
|                                        |
|  [Export CSV]                          |
|                                        |
+========================================+
```

---

## Loading States

### Builder Initial Load

```
+-- CONFIGURATION PANEL -----------------------------------------+
|                                                                |
|  +-- DATA SOURCE ---------------------------------------------+|
|  | [shimmer=================================]                 ||
|  | [shimmer=================]                                 ||
|  +------------------------------------------------------------+|
|                                                                |
|  +-- COLUMNS -------------------------------------------------+|
|  | [shimmer=================================]                 ||
|  | [shimmer=================================]                 ||
|  | [shimmer=================================]                 ||
|  +------------------------------------------------------------+|
|                                                                |
+----------------------------------------------------------------+

+-- PREVIEW PANEL -----------------------------------------------+
|                                                                |
|  [shimmer=============================================]        |
|  [shimmer=============================================]        |
|  [shimmer=============================================]        |
|  [shimmer=============================================]        |
|                                                                |
+----------------------------------------------------------------+
```

### Preview Loading

```
+-- PREVIEW PANEL -----------------------------------------------+
|                                                                |
|  Preview (loading...)                          [spinner]       |
|                                                                |
|  +------------------------------------------------------------+|
|  |                                                            ||
|  |  Generating preview...                                     ||
|  |                                                            ||
|  |  This may take a moment for large datasets.                ||
|  |                                                            ||
|  +------------------------------------------------------------+|
|                                                                |
+----------------------------------------------------------------+
```

### Report Generation Progress

```
+-- FULL REPORT GENERATION --------------------------------------+
|                                                                |
|  +------------------------------------------------------------+|
|  |                                                            ||
|  |           [spinner]                                        ||
|  |                                                            ||
|  |  Generating report...                                      ||
|  |                                                            ||
|  |  [================================] 65%                    ||
|  |                                                            ||
|  |  Processing 156 records                                    ||
|  |                                                            ||
|  +------------------------------------------------------------+|
|                                                                |
+----------------------------------------------------------------+
```

---

## Empty States

### No Custom Reports Yet

```
+-- MY REPORTS --------------------------------------------------+
|                                                                |
|         [report builder illustration]                          |
|                                                                |
|     No custom reports yet                                      |
|                                                                |
|  Build your first custom report by selecting                   |
|  a data source and choosing the columns you need.              |
|                                                                |
|  [+ Create Your First Report]                                  |
|                                                                |
+----------------------------------------------------------------+
```

### No Columns Selected

```
+-- PREVIEW PANEL -----------------------------------------------+
|                                                                |
|         [columns illustration]                                 |
|                                                                |
|     Select columns to see preview                              |
|                                                                |
|  Choose at least one column from the                           |
|  configuration panel to generate a preview.                    |
|                                                                |
+----------------------------------------------------------------+
```

### No Results (Filters Too Restrictive)

```
+-- PREVIEW PANEL -----------------------------------------------+
|                                                                |
|         [filter illustration]                                  |
|                                                                |
|     No matching records                                        |
|                                                                |
|  Your current filters returned 0 results.                      |
|  Try adjusting or removing some filters.                       |
|                                                                |
|  Applied filters:                                              |
|  - Total Spent > $1,000,000                                    |
|  - Status = Inactive                                           |
|                                                                |
|  [Clear All Filters]                                           |
|                                                                |
+----------------------------------------------------------------+
```

---

## Error States

### Failed to Load Data Source Schema

```
+-- DATA SOURCE -------------------------------------------------+
|                                                                |
|  [!] Couldn't load data source options                         |
|                                                                |
|  We couldn't retrieve the available data sources.              |
|  Please try again.                                             |
|                                                                |
|  [Retry]                                                       |
|                                                                |
+----------------------------------------------------------------+
```

### Preview Generation Failed

```
+-- PREVIEW PANEL -----------------------------------------------+
|                                                                |
|  [!] Preview generation failed                                 |
|                                                                |
|  We couldn't generate the preview.                             |
|  This might be due to an invalid filter configuration.         |
|                                                                |
|  Error: Invalid date format in filter                          |
|                                                                |
|  [Review Filters]  [Retry]                                     |
|                                                                |
+----------------------------------------------------------------+
```

### Failed to Save Report

```
+-- SAVE DIALOG -------------------------------------------------+
|                                                                |
|  [!] Couldn't save report                                      |
|                                                                |
|  There was a problem saving your report.                       |
|  Your work is not lost - please try again.                     |
|                                                                |
|  [Retry Save]  [Download Backup]                               |
|                                                                |
+----------------------------------------------------------------+
```

---

## Success States

### Report Saved

```
+-- TOAST SUCCESS -----------------------------------------------+
|                                                                |
|  [check] Report saved                                          |
|                                                                |
|  "Top Customers by Revenue" has been saved.                    |
|                                                                |
|  [View Saved Reports]  [x]                                     |
|                                                                |
+----------------------------------------------------------------+
```

### Report Shared

```
+-- TOAST SUCCESS -----------------------------------------------+
|                                                                |
|  [check] Report shared with team                               |
|                                                                |
|  Your team can now see "Top Customers by Revenue"              |
|  in their Shared Reports section.                              |
|                                                                |
|  [x]                                                           |
|                                                                |
+----------------------------------------------------------------+
```

### Export Complete

```
+-- TOAST SUCCESS -----------------------------------------------+
|                                                                |
|  [check] Report exported                                       |
|                                                                |
|  top-customers-2026-01-10.csv downloaded                       |
|                                                                |
|  [Open File]  [x]                                              |
|                                                                |
+----------------------------------------------------------------+
```

---

## Accessibility Specification

### ARIA Landmarks and Roles

```html
<!-- Main Builder -->
<main aria-label="Report Builder">
  <header>
    <input
      type="text"
      aria-label="Report name"
      placeholder="Untitled Report"
    />
    <button aria-label="Save report">Save</button>
  </header>

  <!-- Configuration Panel -->
  <aside aria-label="Report configuration">
    <!-- Data Source -->
    <fieldset>
      <legend>Step 1: Data Source</legend>
      <div role="radiogroup" aria-label="Select data source">
        <label><input type="radio" name="source" /> Customers</label>
        <label><input type="radio" name="source" /> Installation Orders</label>
        <label><input type="radio" name="source" /> Battery Systems</label>
      </div>
    </fieldset>

    <!-- Columns -->
    <fieldset>
      <legend>Step 2: Columns</legend>
      <div
        role="listbox"
        aria-label="Available columns"
        aria-multiselectable="true"
      >
        <div role="option" aria-selected="true" draggable="true">
          Name
        </div>
        ...
      </div>
    </fieldset>

    <!-- Filters -->
    <fieldset>
      <legend>Step 3: Filters</legend>
      <div role="list" aria-label="Applied filters">
        <div role="listitem" aria-label="Filter: Total Spent greater than $1,000">
          ...
        </div>
      </div>
    </fieldset>
  </aside>

  <!-- Preview Panel -->
  <section aria-label="Report preview" aria-live="polite">
    <table role="table" aria-label="Preview data">
      ...
    </table>
  </section>
</main>
```

### Keyboard Navigation

```
Builder Layout:
Tab Order:
1. Report name input
2. Save button
3. Export dropdown
4. Data source radio buttons
5. Column checkboxes (in order)
6. Column settings buttons
7. Filter rows (field -> operator -> value -> remove)
8. Add filter button
9. Sort dropdown
10. Group dropdown
11. Preview refresh button
12. Preview table

Column Reorder (drag handle focused):
- Space: Pick up/drop column
- Arrow Up/Down: Move column in list
- Escape: Cancel reorder

Filter Row:
- Tab: Move between field/operator/value/remove
- Enter: Confirm value
- Delete/Backspace on remove: Remove filter

Preview Table:
- Tab: Enter table navigation
- Arrow keys: Navigate cells
- Enter on header: Sort by column
```

### Screen Reader Announcements

```
On data source change:
  "Data source changed to Customers. 10 columns available."

On column add:
  "Total Spent column added to report. 4 columns selected."

On column reorder:
  "Total Spent moved to position 3."

On filter add:
  "Filter added. Total Spent is greater than $1,000."

On preview update:
  "Preview updated. Showing 10 of 156 results."

On save:
  "Report saved as Top Customers by Revenue."
```

---

## Animation Choreography

### Panel Transitions

```
Column/Filter add:
0ms   - Item fades in
        opacity: 0 -> 1
        transform: translateY(-8px) -> translateY(0)
        duration: 200ms
        easing: ease-out

Column reorder (drag):
      - Dragged item follows cursor
      - Other items animate to fill gap
        duration: 150ms
        easing: ease-out

Column/Filter remove:
0ms   - Item scales and fades
        transform: scale(1) -> scale(0.95)
        opacity: 1 -> 0
        height: auto -> 0
        duration: 200ms
```

### Preview Update

```
On configuration change:

0ms   - Preview content fades slightly
        opacity: 1 -> 0.6
        duration: 100ms

      - Debounce wait (300ms)

300ms - Fetch new preview data

      - On data received:
        opacity: 0.6 -> 1
        duration: 150ms

      - Table rows may animate in
        stagger: 20ms each row (first 10 only)
```

### Save Animation

```
Save button click:

0ms   - Button shows spinner
        width maintains size
        text fades out
        spinner fades in
        duration: 150ms

      - Save operation

On success:
0ms   - Spinner transitions to checkmark
        duration: 200ms

500ms - Toast appears
        slide in from bottom-right
        duration: 250ms

1000ms - Button returns to normal state
        checkmark fades to text
        duration: 200ms
```

---

## Component Props Interfaces (TypeScript)

```typescript
// Main Report Builder Component
interface ReportBuilderProps {
  /** Existing report to edit (null for new) */
  existingReport?: CustomReport | null;
  /** Save handler */
  onSave: (report: ReportConfig) => Promise<void>;
  /** Export handler */
  onExport: (format: 'csv' | 'excel' | 'pdf') => Promise<void>;
  /** Cancel/back handler */
  onCancel: () => void;
}

// Report Configuration
interface ReportConfig {
  /** Report name */
  name: string;
  /** Description */
  description?: string;
  /** Data source */
  dataSource: DataSource;
  /** Selected columns with configuration */
  columns: ColumnConfig[];
  /** Applied filters */
  filters: FilterConfig[];
  /** Filter match mode */
  filterMode: 'all' | 'any';
  /** Sort configuration */
  sort: SortConfig[];
  /** Group by column */
  groupBy?: string;
  /** Group options */
  groupOptions?: GroupOptions;
  /** Sharing setting */
  sharing: 'private' | 'team';
}

// Data Sources
type DataSource = 'customers' | 'orders' | 'products';

interface DataSourceSchema {
  id: DataSource;
  name: string;
  description: string;
  recordCount: number;
  columns: ColumnDefinition[];
}

interface ColumnDefinition {
  id: string;
  name: string;
  description?: string;
  type: ColumnType;
  format?: string;
  sortable: boolean;
  filterable: boolean;
  groupable: boolean;
}

type ColumnType =
  | 'text'
  | 'number'
  | 'currency'
  | 'date'
  | 'datetime'
  | 'boolean'
  | 'enum';

// Column Configuration
interface ColumnConfig {
  columnId: string;
  displayLabel?: string;
  format?: string;
  alignment?: 'left' | 'center' | 'right';
  width?: number | 'auto';
  order: number;
}

// Filter Configuration
interface FilterConfig {
  id: string;
  columnId: string;
  operator: FilterOperator;
  value: unknown;
  secondValue?: unknown; // For "between" operator
}

type FilterOperator =
  | 'equals'
  | 'not_equals'
  | 'contains'
  | 'not_contains'
  | 'starts_with'
  | 'ends_with'
  | 'greater_than'
  | 'greater_than_or_equal'
  | 'less_than'
  | 'less_than_or_equal'
  | 'between'
  | 'is_one_of'
  | 'is_empty'
  | 'is_not_empty'
  | 'is_before'
  | 'is_after'
  | 'in_last_n_days';

// Sort Configuration
interface SortConfig {
  columnId: string;
  direction: 'asc' | 'desc';
}

// Group Options
interface GroupOptions {
  showSubtotals: boolean;
  collapseByDefault: boolean;
}

// Custom Report (saved)
interface CustomReport {
  id: string;
  organizationId: string;
  userId: string;
  config: ReportConfig;
  sharing: 'private' | 'team';
  createdAt: string;
  updatedAt: string;
  lastRunAt?: string;
  sharedBy?: string;
}

// Preview Data
interface PreviewData {
  columns: ColumnDefinition[];
  rows: Record<string, unknown>[];
  totalCount: number;
  previewCount: number;
}

// Data Source Selector
interface DataSourceSelectorProps {
  /** Available data sources */
  sources: DataSourceSchema[];
  /** Selected source */
  selectedSource: DataSource | null;
  /** Selection handler */
  onSelect: (source: DataSource) => void;
  /** Loading state */
  isLoading?: boolean;
}

// Column Selector
interface ColumnSelectorProps {
  /** Available columns */
  availableColumns: ColumnDefinition[];
  /** Selected column configurations */
  selectedColumns: ColumnConfig[];
  /** Selection change handler */
  onChange: (columns: ColumnConfig[]) => void;
  /** Column settings handler */
  onColumnSettings: (columnId: string) => void;
}

// Filter Builder
interface FilterBuilderProps {
  /** Available columns for filtering */
  columns: ColumnDefinition[];
  /** Current filters */
  filters: FilterConfig[];
  /** Filter change handler */
  onChange: (filters: FilterConfig[]) => void;
  /** Filter mode */
  filterMode: 'all' | 'any';
  /** Filter mode change handler */
  onFilterModeChange: (mode: 'all' | 'any') => void;
}

// Single Filter Row
interface FilterRowProps {
  /** Filter configuration */
  filter: FilterConfig;
  /** Available columns */
  columns: ColumnDefinition[];
  /** Change handler */
  onChange: (filter: FilterConfig) => void;
  /** Remove handler */
  onRemove: () => void;
}

// Sort Selector
interface SortSelectorProps {
  /** Available columns for sorting */
  columns: ColumnDefinition[];
  /** Current sort configuration */
  sorts: SortConfig[];
  /** Change handler */
  onChange: (sorts: SortConfig[]) => void;
  /** Max sorts allowed */
  maxSorts?: number;
}

// Preview Panel
interface PreviewPanelProps {
  /** Preview data */
  data: PreviewData | null;
  /** Loading state */
  isLoading?: boolean;
  /** Error state */
  error?: string;
  /** Refresh handler */
  onRefresh: () => void;
  /** Group configuration */
  groupBy?: string;
  /** Group options */
  groupOptions?: GroupOptions;
}

// Report List
interface ReportListProps {
  /** User's reports */
  myReports: CustomReport[];
  /** Shared reports */
  sharedReports: CustomReport[];
  /** Loading state */
  isLoading?: boolean;
  /** Run report handler */
  onRun: (reportId: string) => void;
  /** Edit report handler */
  onEdit: (reportId: string) => void;
  /** Duplicate report handler */
  onDuplicate: (reportId: string) => void;
  /** Delete report handler */
  onDelete: (reportId: string) => Promise<void>;
}

// Save Dialog
interface SaveReportDialogProps {
  /** Current report config */
  config: ReportConfig;
  /** Is open */
  isOpen: boolean;
  /** Close handler */
  onClose: () => void;
  /** Save handler */
  onSave: (name: string, description: string, sharing: 'private' | 'team') => Promise<void>;
  /** Saving state */
  isSaving?: boolean;
  /** Is update (vs new) */
  isUpdate?: boolean;
}
```

---

## Component Mapping

| Wireframe Element | React Component | shadcn/ui Base |
|-------------------|-----------------|----------------|
| Report builder page | ReportBuilderPage | - |
| Builder layout | ReportBuilderLayout | - |
| Config panel | BuilderConfigPanel | - |
| Data source selector | DataSourceSelector | RadioGroup, Card |
| Column selector | ColumnSelector | Checkbox, DnD |
| Column item | ColumnItem | - |
| Column settings dialog | ColumnSettingsDialog | Dialog |
| Filter builder | FilterBuilder | - |
| Filter row | FilterRow | Select, Input |
| Sort selector | SortSelector | Select |
| Group selector | GroupSelector | Select, Checkbox |
| Preview panel | PreviewPanel | Table |
| Preview table | PreviewTable | DataTable |
| Save dialog | SaveReportDialog | Dialog |
| Report list | CustomReportList | - |
| Report card | CustomReportCard | Card |
| Report view | CustomReportView | DataTable |

---

## Performance Requirements

| Metric | Target | Measurement |
|--------|--------|-------------|
| Builder initial load | < 1s | Configuration ready |
| Data source change | < 500ms | Columns populated |
| Preview generation | < 2s | For up to 1000 records |
| Full report run | < 5s | For up to 10000 records |
| Column reorder | < 100ms | Visual feedback |
| Filter apply | < 300ms | Preview updates |
| Save report | < 1s | Confirmation shown |
| Export CSV | < 3s | Download starts |

---

## Files to Create/Modify

```
src/routes/_authed/reports/builder.tsx (create)
src/routes/_authed/reports/custom/index.tsx (create)
src/routes/_authed/reports/custom/$reportId.tsx (create)
src/components/domain/reports/builder/
  - report-builder-page.tsx (create)
  - report-builder-layout.tsx (create)
  - builder-config-panel.tsx (create)
  - data-source-selector.tsx (create)
  - column-selector.tsx (create)
  - column-item.tsx (create)
  - column-settings-dialog.tsx (create)
  - filter-builder.tsx (create)
  - filter-row.tsx (create)
  - sort-selector.tsx (create)
  - group-selector.tsx (create)
  - preview-panel.tsx (create)
  - save-report-dialog.tsx (create)
src/components/domain/reports/custom/
  - custom-report-list.tsx (create)
  - custom-report-card.tsx (create)
  - custom-report-view.tsx (create)
src/server/functions/custom-reports.ts (create)
```

---

## Related Wireframes

- [Financial Summary Report](./DOM-RPT-004.wireframe.md)
- [Report Schedule UI](./DOM-RPT-005c.wireframe.md)
- [Report Favorites](./DOM-RPT-006c.wireframe.md)

---

**Document Version:** 1.0
**Created:** 2026-01-10
**Author:** Claude Code
