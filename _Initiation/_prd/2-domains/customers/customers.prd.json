{
  "id": "DOM-CUSTOMERS",
  "name": "Customer Relationship Management System",
  "description": "Complete customer lifecycle management platform providing 360-degree customer views, relationship intelligence, segmentation, credit management, and comprehensive customer data management across the entire business ecosystem.",
  "created": "2026-01-10",
  "updated": "2026-01-10",
  "priority": 1,
  "phase": "core-business",
  "version": "1.0",
  "business_value": {
    "customer_centricity": true,
    "relationship_intelligence": true,
    "segmentation_targeting": true,
    "description": "Foundation customer management enabling personalized relationships and business intelligence"
  },
  "system_requirements": {
    "database": {
      "customers": {
        "description": "Core customer entity with comprehensive profile management",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerCode": "varchar(20) UNIQUE NOT NULL",
          "name": "varchar(255) NOT NULL",
          "legalName": "varchar(255)",
          "type": "enum('individual', 'business', 'government', 'non_profit') DEFAULT 'business'",
          "status": "enum('active', 'inactive', 'prospect', 'suspended', 'blacklisted') DEFAULT 'prospect'",
          "industry": "varchar(100)",
          "size": "enum('micro', 'small', 'medium', 'large', 'enterprise')",
          "website": "varchar(255)",
          "taxId": "varchar(50)",
          "registrationNumber": "varchar(50)",
          "parentId": "uuid REFERENCES customers(id)",
          "creditLimit": "decimal(12,2)",
          "creditHold": "boolean DEFAULT false",
          "creditHoldReason": "text",
          "healthScore": "integer CHECK (healthScore >= 0 AND healthScore <= 100)",
          "healthScoreUpdatedAt": "timestamp",
          "lifetimeValue": "decimal(12,2) DEFAULT 0",
          "firstOrderDate": "date",
          "lastOrderDate": "date",
          "totalOrders": "integer DEFAULT 0",
          "totalOrderValue": "decimal(12,2) DEFAULT 0",
          "averageOrderValue": "decimal(10,2)",
          "tags": "text[] DEFAULT '{}'",
          "customFields": "jsonb DEFAULT '{}'",
          "createdBy": "uuid NOT NULL REFERENCES users(id)",
          "updatedBy": "uuid NOT NULL REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "customerCode",
          "status",
          "type",
          "parentId",
          "healthScore",
          "lastOrderDate"
        ],
        "constraints": [
          "parentId != id"
        ]
      },
      "contacts": {
        "description": "Customer contact persons and relationship management",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerId": "uuid NOT NULL REFERENCES customers(id)",
          "firstName": "varchar(100) NOT NULL",
          "lastName": "varchar(100) NOT NULL",
          "title": "varchar(100)",
          "email": "varchar(255)",
          "phone": "varchar(20)",
          "mobile": "varchar(20)",
          "isPrimary": "boolean DEFAULT false",
          "department": "varchar(100)",
          "decisionMaker": "boolean DEFAULT false",
          "influencer": "boolean DEFAULT false",
          "lastContactedAt": "timestamp",
          "notes": "text",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "customerId",
          "email",
          "isPrimary"
        ],
        "constraints": [
          "email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$'",
          "firstName IS NOT NULL OR lastName IS NOT NULL"
        ]
      },
      "addresses": {
        "description": "Customer address management for billing and shipping",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerId": "uuid NOT NULL REFERENCES customers(id)",
          "type": "enum('billing', 'shipping', 'service', 'headquarters') DEFAULT 'billing'",
          "isPrimary": "boolean DEFAULT false",
          "street1": "varchar(255) NOT NULL",
          "street2": "varchar(255)",
          "city": "varchar(100) NOT NULL",
          "state": "varchar(50)",
          "postcode": "varchar(20) NOT NULL",
          "country": "varchar(2) DEFAULT 'AU'",
          "latitude": "decimal(10,8)",
          "longitude": "decimal(11,8)",
          "notes": "text",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "customerId",
          "type",
          "isPrimary",
          "postcode"
        ],
        "constraints": [
          "street1 IS NOT NULL",
          "city IS NOT NULL",
          "postcode IS NOT NULL"
        ]
      },
      "customerActivities": {
        "description": "Comprehensive activity logging and timeline tracking",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerId": "uuid NOT NULL REFERENCES customers(id)",
          "contactId": "uuid REFERENCES contacts(id)",
          "activityType": "enum('call', 'email', 'meeting', 'note', 'quote', 'order', 'complaint', 'feedback', 'website_visit', 'social_interaction') NOT NULL",
          "direction": "enum('inbound', 'outbound', 'internal')",
          "subject": "varchar(255)",
          "description": "text",
          "outcome": "varchar(100)",
          "duration": "integer",
          "scheduledAt": "timestamp",
          "completedAt": "timestamp",
          "assignedTo": "uuid REFERENCES users(id)",
          "createdBy": "uuid NOT NULL REFERENCES users(id)",
          "metadata": "jsonb DEFAULT '{}'",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "customerId",
          "contactId",
          "activityType",
          "scheduledAt",
          "completedAt",
          "assignedTo"
        ],
        "constraints": [
          "description IS NOT NULL"
        ]
      },
      "customerTags": {
        "description": "Dynamic customer segmentation and categorization",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "name": "varchar(50) NOT NULL",
          "description": "text",
          "color": "varchar(7) DEFAULT '#6B7280'",
          "category": "varchar(50)",
          "isActive": "boolean DEFAULT true",
          "usageCount": "integer DEFAULT 0",
          "createdBy": "uuid NOT NULL REFERENCES users(id)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "category",
          "isActive",
          "usageCount"
        ],
        "constraints": [
          "name IS NOT NULL"
        ]
      },
      "customerTagAssignments": {
        "description": "Many-to-many relationship between customers and tags",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerId": "uuid NOT NULL REFERENCES customers(id)",
          "tagId": "uuid NOT NULL REFERENCES customerTags(id)",
          "assignedBy": "uuid NOT NULL REFERENCES users(id)",
          "assignedAt": "timestamp NOT NULL DEFAULT NOW()",
          "notes": "text"
        },
        "indexes": [
          "organizationId",
          "customerId",
          "tagId"
        ],
        "unique": [
          "customerId",
          "tagId"
        ]
      },
      "customerHealthMetrics": {
        "description": "Historical health score tracking and trend analysis",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerId": "uuid NOT NULL REFERENCES customers(id)",
          "metricDate": "date NOT NULL",
          "recencyScore": "decimal(5,2) CHECK (recencyScore >= 0 AND recencyScore <= 100)",
          "frequencyScore": "decimal(5,2) CHECK (frequencyScore >= 0 AND frequencyScore <= 100)",
          "monetaryScore": "decimal(5,2) CHECK (monetaryScore >= 0 AND monetaryScore <= 100)",
          "engagementScore": "decimal(5,2) CHECK (engagementScore >= 0 AND engagementScore <= 100)",
          "overallScore": "decimal(5,2) CHECK (overallScore >= 0 AND overallScore <= 100)",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "customerId",
          "metricDate",
          "overallScore"
        ],
        "unique": [
          "customerId",
          "metricDate"
        ]
      },
      "customerPriorities": {
        "description": "Customer priority and account management settings",
        "fields": {
          "id": "uuid PRIMARY KEY",
          "organizationId": "uuid NOT NULL REFERENCES organizations(id)",
          "customerId": "uuid NOT NULL REFERENCES customers(id)",
          "priorityLevel": "enum('low', 'medium', 'high', 'vip') DEFAULT 'medium'",
          "accountManager": "uuid REFERENCES users(id)",
          "serviceLevel": "enum('standard', 'premium', 'platinum') DEFAULT 'standard'",
          "contractValue": "decimal(12,2)",
          "contractStartDate": "date",
          "contractEndDate": "date",
          "specialTerms": "text",
          "createdAt": "timestamp NOT NULL DEFAULT NOW()",
          "updatedAt": "timestamp NOT NULL DEFAULT NOW()"
        },
        "indexes": [
          "organizationId",
          "customerId",
          "priorityLevel",
          "accountManager"
        ],
        "constraints": [
          "contractEndDate > contractStartDate OR contractEndDate IS NULL"
        ]
      }
    },
    "api_endpoints": {
      "customers": {
        "list": {
          "method": "GET",
          "path": "/api/customers",
          "query_params": [
            "page",
            "limit",
            "status",
            "type",
            "tags",
            "healthScore",
            "search",
            "sortBy",
            "sortDir"
          ],
          "response": {
            "customers": "Customer[]",
            "total": "number",
            "page": "number",
            "limit": "number",
            "metrics": {
              "totalActive": "number",
              "avgHealthScore": "number",
              "totalValue": "number"
            }
          },
          "description": "List customers with advanced filtering and analytics"
        },
        "get": {
          "method": "GET",
          "path": "/api/customers/:id",
          "response": {
            "customer": "Customer",
            "contacts": "Contact[]",
            "addresses": "Address[]",
            "activities": "CustomerActivity[]",
            "tags": "CustomerTag[]",
            "healthHistory": "CustomerHealthMetrics[]",
            "relationships": {
              "parent": "Customer?",
              "children": "Customer[]"
            },
            "metrics": {
              "lifetimeValue": "number",
              "avgOrderValue": "number",
              "lastActivity": "date",
              "nextExpectedOrder": "date?"
            }
          },
          "description": "Get complete customer 360-degree view"
        },
        "create": {
          "method": "POST",
          "path": "/api/customers",
          "body": {
            "name": "string",
            "type": "CustomerType?",
            "industry": "string?",
            "website": "string?",
            "taxId": "string?",
            "contacts": "ContactInput[]?",
            "addresses": "AddressInput[]?",
            "tags": "uuid[]?"
          },
          "response": {
            "customer": "Customer"
          },
          "description": "Create new customer with related entities"
        },
        "update": {
          "method": "PUT",
          "path": "/api/customers/:id",
          "body": {
            "name": "string?",
            "status": "CustomerStatus?",
            "type": "CustomerType?",
            "industry": "string?",
            "creditLimit": "number?",
            "tags": "uuid[]?",
            "customFields": "Record<string, any>?"
          },
          "response": {
            "customer": "Customer"
          },
          "description": "Update customer information"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/customers/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Soft delete customer"
        },
        "merge": {
          "method": "POST",
          "path": "/api/customers/merge",
          "body": {
            "primaryId": "uuid",
            "secondaryId": "uuid",
            "fieldOverrides": "Record<string, any>?"
          },
          "response": {
            "customer": "Customer",
            "mergedData": "MergedData"
          },
          "description": "Merge two customer records"
        },
        "bulkUpdate": {
          "method": "PUT",
          "path": "/api/customers/bulk",
          "body": {
            "customerIds": "uuid[]",
            "updates": "Partial<Customer>"
          },
          "response": {
            "updated": "number",
            "failed": "number"
          },
          "description": "Bulk update multiple customers"
        },
        "export": {
          "method": "POST",
          "path": "/api/customers/export",
          "body": {
            "filters": "CustomerFilters",
            "format": "ExportFormat",
            "fields": "string[]"
          },
          "response": {
            "jobId": "string"
          },
          "description": "Export customers with custom field selection"
        }
      },
      "contacts": {
        "list": {
          "method": "GET",
          "path": "/api/customers/:customerId/contacts",
          "response": {
            "contacts": "Contact[]"
          },
          "description": "Get customer contacts"
        },
        "create": {
          "method": "POST",
          "path": "/api/customers/:customerId/contacts",
          "body": {
            "firstName": "string",
            "lastName": "string",
            "email": "string?",
            "phone": "string?",
            "title": "string?",
            "department": "string?",
            "isPrimary": "boolean?"
          },
          "response": {
            "contact": "Contact"
          },
          "description": "Create customer contact"
        },
        "update": {
          "method": "PUT",
          "path": "/api/contacts/:id",
          "body": {
            "firstName": "string?",
            "lastName": "string?",
            "email": "string?",
            "phone": "string?",
            "isPrimary": "boolean?"
          },
          "response": {
            "contact": "Contact"
          },
          "description": "Update contact information"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/contacts/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Delete contact"
        }
      },
      "addresses": {
        "list": {
          "method": "GET",
          "path": "/api/customers/:customerId/addresses",
          "response": {
            "addresses": "Address[]"
          },
          "description": "Get customer addresses"
        },
        "create": {
          "method": "POST",
          "path": "/api/customers/:customerId/addresses",
          "body": {
            "type": "AddressType",
            "street1": "string",
            "city": "string",
            "state": "string?",
            "postcode": "string",
            "country": "string?",
            "isPrimary": "boolean?"
          },
          "response": {
            "address": "Address"
          },
          "description": "Create customer address"
        },
        "update": {
          "method": "PUT",
          "path": "/api/addresses/:id",
          "body": {
            "street1": "string?",
            "city": "string?",
            "postcode": "string?",
            "isPrimary": "boolean?"
          },
          "response": {
            "address": "Address"
          },
          "description": "Update address"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/addresses/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Delete address"
        }
      },
      "activities": {
        "list": {
          "method": "GET",
          "path": "/api/customers/:customerId/activities",
          "query_params": [
            "page",
            "limit",
            "type",
            "assignedTo",
            "dateFrom",
            "dateTo"
          ],
          "response": {
            "activities": "CustomerActivity[]",
            "total": "number",
            "page": "number",
            "limit": "number"
          },
          "description": "Get customer activity timeline"
        },
        "create": {
          "method": "POST",
          "path": "/api/customers/:customerId/activities",
          "body": {
            "activityType": "ActivityType",
            "subject": "string",
            "description": "string",
            "assignedTo": "uuid?",
            "scheduledAt": "date?"
          },
          "response": {
            "activity": "CustomerActivity"
          },
          "description": "Create customer activity"
        },
        "update": {
          "method": "PUT",
          "path": "/api/activities/:id",
          "body": {
            "subject": "string?",
            "description": "string?",
            "outcome": "string?",
            "completedAt": "date?"
          },
          "response": {
            "activity": "CustomerActivity"
          },
          "description": "Update activity"
        },
        "complete": {
          "method": "POST",
          "path": "/api/activities/:id/complete",
          "body": {
            "outcome": "string",
            "notes": "string?"
          },
          "response": {
            "activity": "CustomerActivity"
          },
          "description": "Mark activity as completed"
        }
      },
      "tags": {
        "list": {
          "method": "GET",
          "path": "/api/customer-tags",
          "query_params": [
            "category",
            "active"
          ],
          "response": {
            "tags": "CustomerTag[]"
          },
          "description": "Get customer tags"
        },
        "create": {
          "method": "POST",
          "path": "/api/customer-tags",
          "body": {
            "name": "string",
            "description": "string?",
            "color": "string?",
            "category": "string?"
          },
          "response": {
            "tag": "CustomerTag"
          },
          "description": "Create customer tag"
        },
        "update": {
          "method": "PUT",
          "path": "/api/customer-tags/:id",
          "body": {
            "name": "string?",
            "description": "string?",
            "color": "string?",
            "isActive": "boolean?"
          },
          "response": {
            "tag": "CustomerTag"
          },
          "description": "Update tag"
        },
        "delete": {
          "method": "DELETE",
          "path": "/api/customer-tags/:id",
          "response": {
            "success": "boolean"
          },
          "description": "Delete tag"
        },
        "assign": {
          "method": "POST",
          "path": "/api/customers/:customerId/tags",
          "body": {
            "tagIds": "uuid[]"
          },
          "response": {
            "assignments": "CustomerTagAssignment[]"
          },
          "description": "Assign tags to customer"
        },
        "unassign": {
          "method": "DELETE",
          "path": "/api/customers/:customerId/tags/:tagId",
          "response": {
            "success": "boolean"
          },
          "description": "Remove tag from customer"
        }
      },
      "health": {
        "calculate": {
          "method": "POST",
          "path": "/api/customers/:customerId/health",
          "response": {
            "score": "number",
            "metrics": {
              "recency": "number",
              "frequency": "number",
              "monetary": "number",
              "engagement": "number"
            },
            "recommendations": "HealthRecommendation[]"
          },
          "description": "Calculate customer health score"
        },
        "getHistory": {
          "method": "GET",
          "path": "/api/customers/:customerId/health-history",
          "query_params": [
            "months"
          ],
          "response": {
            "metrics": "CustomerHealthMetrics[]"
          },
          "description": "Get health score history"
        },
        "bulkCalculate": {
          "method": "POST",
          "path": "/api/customers/health/bulk",
          "body": {
            "customerIds": "uuid[]"
          },
          "response": {
            "jobId": "string"
          },
          "description": "Bulk calculate health scores"
        }
      },
      "analytics": {
        "segmentation": {
          "method": "GET",
          "path": "/api/analytics/customers/segments",
          "query_params": [
            "segmentBy",
            "dateFrom",
            "dateTo"
          ],
          "response": {
            "segments": "CustomerSegment[]",
            "metrics": {
              "totalCustomers": "number",
              "avgLifetimeValue": "number",
              "avgHealthScore": "number"
            }
          },
          "description": "Customer segmentation analytics"
        },
        "lifecycle": {
          "method": "GET",
          "path": "/api/analytics/customers/lifecycle",
          "query_params": [
            "cohort",
            "period"
          ],
          "response": {
            "cohorts": "CustomerCohort[]",
            "retention": "RetentionMetrics[]",
            "churn": "ChurnMetrics[]"
          },
          "description": "Customer lifecycle analytics"
        },
        "performance": {
          "method": "GET",
          "path": "/api/analytics/customers/performance",
          "query_params": [
            "metric",
            "dateFrom",
            "dateTo"
          ],
          "response": {
            "metrics": "CustomerPerformanceMetrics[]",
            "trends": "PerformanceTrend[]",
            "benchmarks": "IndustryBenchmarks"
          },
          "description": "Customer performance analytics"
        }
      }
    },
    "ui_components": {
      "customerDirectory": {
        "description": "Central customer management and search interface",
        "listView": {
          "columns": [
            {
              "name": "Code",
              "sortable": true
            },
            {
              "name": "Name",
              "sortable": true,
              "searchable": true
            },
            {
              "name": "Type",
              "filterable": true
            },
            {
              "name": "Status",
              "filterable": true,
              "badge": true
            },
            {
              "name": "Health Score",
              "sortable": true,
              "visual": "gauge"
            },
            {
              "name": "Lifetime Value",
              "sortable": true,
              "format": "currency"
            },
            {
              "name": "Last Order",
              "sortable": true,
              "format": "relative"
            },
            {
              "name": "Tags",
              "visual": "badges"
            }
          ],
          "filters": [
            {
              "name": "Status",
              "type": "multiselect",
              "options": [
                "active",
                "inactive",
                "prospect"
              ]
            },
            {
              "name": "Type",
              "type": "multiselect",
              "options": [
                "individual",
                "business"
              ]
            },
            {
              "name": "Health Score",
              "type": "range",
              "min": 0,
              "max": 100
            },
            {
              "name": "Tags",
              "type": "multiselect",
              "dynamic": true
            },
            {
              "name": "Lifetime Value",
              "type": "range",
              "currency": true
            },
            {
              "name": "Last Activity",
              "type": "date_range"
            }
          ],
          "actions": [
            {
              "name": "View",
              "primary": true
            },
            {
              "name": "Edit",
              "permission": "write"
            },
            {
              "name": "New Order",
              "type": "quick"
            },
            {
              "name": "New Quote",
              "type": "quick"
            },
            {
              "name": "Merge",
              "type": "bulk",
              "permission": "admin"
            },
            {
              "name": "Export",
              "type": "bulk"
            }
          ]
        },
        "searchInterface": {
          "features": [
            "Real-time search across name, code, contacts, tags",
            "Advanced filters with save/load capability",
            "Search result highlighting",
            "Recent searches history",
            "Search suggestions and autocomplete",
            "Saved search filters and bookmarks"
          ]
        },
        "bulkOperations": {
          "capabilities": [
            "Bulk status updates",
            "Bulk tag assignment/removal",
            "Bulk export with field selection",
            "Bulk email campaigns",
            "Bulk data updates with validation"
          ]
        }
      },
      "customer360View": {
        "description": "Complete customer relationship dashboard",
        "overviewTab": {
          "metrics": [
            {
              "name": "Lifetime Value",
              "value": "currency",
              "trend": true
            },
            {
              "name": "Total Orders",
              "value": "number",
              "period": "all_time"
            },
            {
              "name": "Average Order Value",
              "value": "currency"
            },
            {
              "name": "Last Activity",
              "value": "relative_date"
            },
            {
              "name": "Health Score",
              "value": "gauge",
              "color": "dynamic"
            }
          ],
          "quickStats": [
            {
              "name": "Open Orders",
              "value": "count",
              "link": "orders"
            },
            {
              "name": "Open Quotes",
              "value": "count",
              "link": "opportunities"
            },
            {
              "name": "Active Contacts",
              "value": "count",
              "link": "contacts"
            },
            {
              "name": "Credit Status",
              "value": "status",
              "color": "conditional"
            }
          ]
        },
        "activityTimeline": {
          "features": [
            "Unified timeline of all customer interactions",
            "Activity type filtering (calls, emails, orders, quotes)",
            "Date range filtering with presets",
            "Activity detail expansion",
            "Quick add activity buttons",
            "Activity assignment and follow-up tracking"
          ],
          "activityTypes": [
            {
              "type": "call",
              "icon": "phone",
              "actions": [
                "log_call",
                "schedule_call"
              ]
            },
            {
              "type": "email",
              "icon": "mail",
              "actions": [
                "send_email",
                "view_thread"
              ]
            },
            {
              "type": "meeting",
              "icon": "calendar",
              "actions": [
                "schedule_meeting",
                "log_meeting"
              ]
            },
            {
              "type": "order",
              "icon": "shopping_cart",
              "actions": [
                "view_order",
                "create_order"
              ]
            },
            {
              "type": "quote",
              "icon": "file_text",
              "actions": [
                "view_quote",
                "create_quote"
              ]
            },
            {
              "type": "note",
              "icon": "sticky_note",
              "actions": [
                "add_note",
                "edit_note"
              ]
            }
          ]
        },
        "relationshipMap": {
          "visualization": [
            "Customer hierarchy tree",
            "Contact relationship mapping",
            "Account team assignments",
            "Communication frequency heat map",
            "Touch point timeline"
          ]
        }
      },
      "customerForm": {
        "description": "Comprehensive customer information management",
        "basicInformation": {
          "fields": [
            {
              "name": "customerCode",
              "type": "text",
              "required": true,
              "auto_generate": true
            },
            {
              "name": "name",
              "type": "text",
              "required": true
            },
            {
              "name": "legalName",
              "type": "text"
            },
            {
              "name": "type",
              "type": "select",
              "options": [
                "individual",
                "business",
                "government",
                "non_profit"
              ]
            },
            {
              "name": "status",
              "type": "select",
              "options": [
                "prospect",
                "active",
                "inactive",
                "suspended"
              ]
            },
            {
              "name": "industry",
              "type": "text"
            },
            {
              "name": "website",
              "type": "url"
            },
            {
              "name": "taxId",
              "type": "text"
            },
            {
              "name": "size",
              "type": "select",
              "options": [
                "micro",
                "small",
                "medium",
                "large",
                "enterprise"
              ]
            }
          ]
        },
        "financialInformation": {
          "fields": [
            {
              "name": "creditLimit",
              "type": "currency",
              "permissions": "finance"
            },
            {
              "name": "creditHold",
              "type": "boolean",
              "permissions": "finance"
            },
            {
              "name": "creditHoldReason",
              "type": "textarea",
              "conditional": "creditHold"
            }
          ]
        },
        "contactsSection": {
          "features": [
            "Primary contact designation",
            "Contact role classification (decision_maker, influencer, user)",
            "Communication preferences",
            "Contact hierarchy within customer",
            "Bulk contact import/export"
          ]
        },
        "addressesSection": {
          "features": [
            "Multiple address types (billing, shipping, service)",
            "Primary address designation",
            "Address validation and geocoding",
            "Distance calculation for service calls",
            "Address history tracking"
          ]
        },
        "tagsAndSegmentation": {
          "features": [
            "Dynamic tag assignment",
            "Tag categories and hierarchies",
            "Automated tagging rules",
            "Tag usage analytics",
            "Bulk tag operations"
          ]
        }
      },
      "customerHealthDashboard": {
        "description": "Customer health monitoring and management",
        "healthScoreVisualization": {
          "components": [
            {
              "type": "gauge",
              "metric": "overall_score",
              "range": [
                0,
                100
              ],
              "thresholds": [
                40,
                70
              ]
            },
            {
              "type": "radar_chart",
              "metrics": [
                "recency",
                "frequency",
                "monetary",
                "engagement"
              ]
            },
            {
              "type": "trend_line",
              "metric": "score_over_time",
              "period": "12_months"
            }
          ]
        },
        "healthFactors": {
          "recency": {
            "metric": "Days since last order",
            "scoring": "0-30 days: 100pts, 31-90 days: 70pts, 91-180 days: 40pts, 180+ days: 0pts",
            "actions": [
              "schedule_follow_up",
              "send_newsletter",
              "review_account"
            ]
          },
          "frequency": {
            "metric": "Orders per year",
            "scoring": "6+: 100pts, 3-5: 70pts, 1-2: 40pts, 0: 0pts",
            "actions": [
              "increase_engagement",
              "cross_sell",
              "loyalty_program"
            ]
          },
          "monetary": {
            "metric": "Lifetime value percentile",
            "scoring": "Top 25%: 100pts, 25-50%: 70pts, 50-75%: 40pts, Bottom 25%: 0pts",
            "actions": [
              "premium_support",
              "volume_discounts",
              "account_management"
            ]
          },
          "engagement": {
            "metric": "Activity and interaction score",
            "scoring": "Based on email opens, website visits, support interactions",
            "actions": [
              "personalized_communication",
              "engagement_campaigns"
            ]
          }
        },
        "riskIndicators": {
          "features": [
            "Low health score alerts (< 30)",
            "Declining trend warnings",
            "Churn risk assessment",
            "Competitive threat indicators",
            "Account health action plans"
          ]
        }
      },
      "customerSegmentation": {
        "description": "Dynamic customer segmentation and targeting",
        "segmentBuilder": {
          "criteria": [
            {
              "type": "demographic",
              "fields": [
                "industry",
                "size",
                "location",
                "type"
              ]
            },
            {
              "type": "behavioral",
              "fields": [
                "order_frequency",
                "avg_order_value",
                "product_categories"
              ]
            },
            {
              "type": "financial",
              "fields": [
                "lifetime_value",
                "payment_terms",
                "credit_status"
              ]
            },
            {
              "type": "engagement",
              "fields": [
                "health_score",
                "last_activity",
                "communication_preferences"
              ]
            }
          ],
          "operators": [
            "equals",
            "not_equals",
            "greater_than",
            "less_than",
            "between",
            "contains",
            "in_list"
          ],
          "logic": [
            "AND",
            "OR",
            "NOT",
            "parentheses_grouping"
          ]
        },
        "segmentManagement": {
          "features": [
            "Save and name segments",
            "Segment size and value calculations",
            "Segment overlap analysis",
            "Automated segment refresh",
            "Segment-based campaign targeting",
            "Segment performance tracking"
          ]
        },
        "segmentAnalytics": {
          "metrics": [
            {
              "name": "Segment Size",
              "type": "count",
              "trend": true
            },
            {
              "name": "Average Lifetime Value",
              "type": "currency",
              "benchmark": true
            },
            {
              "name": "Average Health Score",
              "type": "score",
              "distribution": true
            },
            {
              "name": "Segment Growth Rate",
              "type": "percentage",
              "period": "monthly"
            }
          ]
        }
      },
      "customerCommunicationHub": {
        "description": "Centralized customer communication management",
        "communicationChannels": [
          {
            "type": "email",
            "features": [
              "templates",
              "tracking",
              "automation"
            ]
          },
          {
            "type": "phone",
            "features": [
              "call_logging",
              "voicemail",
              "follow_up"
            ]
          },
          {
            "type": "meeting",
            "features": [
              "scheduling",
              "notes",
              "action_items"
            ]
          },
          {
            "type": "portal",
            "features": [
              "secure_messaging",
              "document_sharing"
            ]
          }
        ],
        "communicationHistory": {
          "timeline": "Unified view of all customer communications",
          "search": "Full-text search across all communication types",
          "filtering": "By channel, date, user, outcome",
          "analytics": "Communication volume, response times, effectiveness"
        },
        "communicationTemplates": {
          "categories": [
            "welcome",
            "follow_up",
            "complaint_resolution",
            "upsell",
            "reactivation"
          ],
          "personalization": "Dynamic content based on customer data",
          "automation": "Trigger-based automated communications"
        }
      }
    },
    "business_rules": {
      "customer_lifecycle": {
        "prospect_to_customer": "Lead qualification through first order conversion",
        "customer_activation": "Post-first-order onboarding and relationship building",
        "customer_growth": "Upselling, cross-selling, and account expansion",
        "customer_retention": "Ongoing engagement and satisfaction monitoring",
        "customer_reactivation": "Win-back campaigns for inactive customers",
        "customer_churn_prevention": "Early warning systems and intervention strategies"
      },
      "customer_segmentation": {
        "segmentation_criteria": "Multi-dimensional segmentation (demographic, behavioral, value-based)",
        "dynamic_segmentation": "Real-time segment updates based on customer actions",
        "segment_activation": "Segment-based marketing and sales automation",
        "segment_performance": "ROI measurement and optimization of segment strategies",
        "segment_governance": "Segment definition standards and maintenance procedures"
      },
      "customer_health_scoring": {
        "scoring_methodology": "Balanced scorecard approach (recency, frequency, monetary, engagement)",
        "scoring_algorithm": "Weighted calculation with configurable parameters",
        "scoring_calibration": "Regular recalibration based on business outcomes",
        "scoring_interpretation": "Clear thresholds and action triggers",
        "scoring_transparency": "Explainable scoring with factor breakdowns"
      },
      "customer_credit_management": {
        "credit_assessment": "Automated credit scoring and limit recommendations",
        "credit_monitoring": "Real-time credit utilization tracking",
        "credit_risk_management": "Credit hold procedures and collections workflows",
        "credit_limit_adjustment": "Dynamic credit limit management based on payment history",
        "credit_reporting": "Credit utilization and risk reporting"
      },
      "customer_communication": {
        "communication_preferences": "Customer-specified communication channels and frequencies",
        "communication_personalization": "Dynamic content based on customer profile and history",
        "communication_timing": "Optimal communication timing based on customer behavior",
        "communication_compliance": "Regulatory compliance for customer communications",
        "communication_effectiveness": "A/B testing and optimization of communication strategies"
      },
      "customer_data_management": {
        "data_accuracy": "Automated data validation and duplicate prevention",
        "data_completeness": "Profile completeness scoring and completion incentives",
        "data_consistency": "Cross-system data synchronization and conflict resolution",
        "data_privacy": "GDPR/CCPA compliance and data subject rights",
        "data_retention": "Configurable data retention policies and automated archiving"
      }
    },
    "integrations": {
      "sales_system": {
        "lead_to_customer": "Seamless conversion of leads to customer records",
        "opportunity_tracking": "Customer-centric opportunity management",
        "quote_to_order": "Customer data integration in quote-to-cash process",
        "account_management": "Dedicated account management workflows",
        "sales_forecasting": "Customer-based sales prediction and planning"
      },
      "order_management": {
        "customer_validation": "Real-time customer verification for order placement",
        "credit_checking": "Automated credit limit validation",
        "shipping_addresses": "Customer address management for shipping",
        "order_history": "Complete customer order history visibility",
        "order_preferences": "Customer-specific ordering preferences and rules"
      },
      "financial_system": {
        "customer_billing": "Customer-specific billing and payment terms",
        "credit_management": "Integrated credit limit and collection management",
        "revenue_recognition": "Customer-based revenue analytics",
        "payment_history": "Customer payment behavior analysis",
        "financial_reporting": "Customer profitability and lifetime value reporting"
      },
      "communication_system": {
        "email_integration": "Customer email tracking and preferences",
        "sms_integration": "SMS communication management",
        "call_center": "Customer service call logging and routing",
        "portal_integration": "Customer self-service portal integration",
        "notification_system": "Multi-channel customer notification management"
      },
      "marketing_system": {
        "segmentation_sync": "Customer segment data for marketing campaigns",
        "campaign_tracking": "Campaign response and attribution tracking",
        "lead_scoring": "Marketing qualified lead scoring and routing",
        "personalization": "Customer data-driven content personalization",
        "analytics_integration": "Marketing campaign performance analytics"
      },
      "external_systems": {
        "crm_sync": "Bidirectional sync with external CRM systems",
        "erp_integration": "Customer data sync with ERP systems",
        "accounting_sync": "Customer and invoice data sync with accounting systems",
        "ecommerce_platforms": "Customer data sync with e-commerce platforms",
        "marketing_automation": "Customer data sync with marketing automation tools"
      }
    },
    "performance_requirements": {
      "response_times": {
        "customer_search": "< 200 milliseconds",
        "customer_detail_load": "< 500 milliseconds",
        "customer_list": "< 1 second for 100 customers",
        "customer_save": "< 300 milliseconds",
        "health_score_calculation": "< 100 milliseconds"
      },
      "scalability": {
        "customer_database": "100,000+ customer records",
        "concurrent_users": "200+ simultaneous CRM users",
        "activity_tracking": "10,000+ daily customer activities",
        "search_performance": "Sub-second search across all customer data",
        "analytics_queries": "Real-time analytics for large customer datasets"
      },
      "reliability": {
        "uptime_target": "99.9% availability for customer services",
        "data_durability": "100% customer data durability",
        "search_accuracy": "> 99% search result accuracy",
        "sync_reliability": "99.9% integration sync success rate",
        "backup_recovery": "4-hour RTO, 1-hour RPO for customer data"
      },
      "data_quality": {
        "duplicate_prevention": "> 98% duplicate customer prevention",
        "data_completeness": "> 90% profile completeness scoring",
        "validation_accuracy": "> 99% data validation success rate",
        "enrichment_success": "> 95% automated data enrichment success",
        "privacy_compliance": "100% data privacy regulation compliance"
      }
    }
  },
  "stories": [
    {
      "id": "CUST-CORE-SCHEMA",
      "name": "Customer Core Schema",
      "description": "Create complete customer relationship management database schema",
      "type": "schema",
      "acceptance_criteria": [
        "Complete customers table with comprehensive profile fields",
        "contacts table with relationship management",
        "addresses table with multiple address types",
        "customerActivities table with timeline tracking",
        "customerTags and customerTagAssignments for segmentation",
        "customerHealthMetrics for scoring and trends",
        "customerPriorities for account management",
        "Foreign keys with ON DELETE CASCADE/RESTRICT, indexes on organizationId, customerId, createdAt, and status columns",
        "RLS policies for organization data isolation",
        "TypeScript types exported for all entities"
      ],
      "files_to_modify": [
        "src/lib/schema/customers.ts",
        "src/lib/schema/contacts.ts",
        "src/lib/schema/addresses.ts",
        "src/lib/schema/customer-activities.ts",
        "src/lib/schema/customer-tags.ts",
        "src/lib/schema/customer-health.ts",
        "src/lib/schema/customer-priorities.ts",
        "src/lib/schema/index.ts",
        "drizzle/migrations/012_customers.ts"
      ],
      "completion_promise": "CUST_CORE_SCHEMA_COMPLETE",
      "estimated_iterations": 2,
      "status": "pending"
    },
    {
      "id": "CUST-CORE-API",
      "name": "Customer Core API",
      "description": "Implement comprehensive customer lifecycle and relationship management endpoints",
      "type": "server-function",
      "acceptance_criteria": [
        "Complete customer CRUD with 360-degree view",
        "Contacts and addresses management APIs",
        "Activity logging and timeline APIs",
        "Tag management and assignment APIs",
        "Health score calculation and history APIs",
        "Customer merge and deduplication APIs",
        "Bulk operations and export APIs",
        "Zod validation on inputs; try-catch with 400/404/500 responses; RLS policies restrict access to organization's own data",
        "Comprehensive Zod validation schemas"
      ],
      "files_to_modify": [
        "src/server/functions/customers.ts",
        "src/server/functions/contacts.ts",
        "src/server/functions/addresses.ts",
        "src/server/functions/customer-activities.ts",
        "src/server/functions/customer-tags.ts",
        "src/server/functions/customer-health.ts",
        "src/server/functions/customer-analytics.ts",
        "src/lib/schemas/customers.ts"
      ],
      "dependencies": [
        "CUST-CORE-SCHEMA"
      ],
      "completion_promise": "CUST_CORE_API_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-DIRECTORY-UI",
      "name": "Customer Directory Interface",
      "description": "Advanced customer search, filtering, and management interface",
      "type": "ui-component",
      "acceptance_criteria": [
        "Responsive customer list with advanced filtering",
        "Real-time search across all customer fields",
        "Customer segmentation and tag filtering",
        "Bulk operations with progress tracking",
        "Export capabilities with field selection",
        "Customer health score visualization",
        "Saved search and filter management",
        "Mobile-optimized interface"
      ],
      "files_to_modify": [
        "src/routes/_authed/customers/index.tsx",
        "src/components/domain/customers/customer-directory.tsx",
        "src/components/domain/customers/customer-filters.tsx",
        "src/components/domain/customers/customer-table.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_DIRECTORY_UI_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-360-VIEW-UI",
      "name": "Customer 360 View Interface",
      "description": "Complete customer relationship dashboard with metrics and timeline",
      "type": "ui-component",
      "acceptance_criteria": [
        "Comprehensive metrics dashboard with KPIs",
        "Unified activity timeline across all touchpoints",
        "Customer hierarchy and relationship visualization",
        "Health score trends and recommendations",
        "Quick action buttons for common tasks",
        "Interactive data visualizations",
        "Real-time data updates",
        "Responsive design for all screen sizes"
      ],
      "files_to_modify": [
        "src/routes/_authed/customers/$customerId.tsx",
        "src/components/domain/customers/customer-360-view.tsx",
        "src/components/domain/customers/metrics-dashboard.tsx",
        "src/components/domain/customers/activity-timeline.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_360_VIEW_UI_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-FORM-MANAGEMENT",
      "name": "Customer Form Management",
      "description": "Comprehensive customer information creation and editing interface",
      "type": "ui-component",
      "acceptance_criteria": [
        "Multi-section customer creation wizard",
        "Dynamic form fields based on customer type",
        "Contact and address management integration",
        "Tag assignment and custom field support",
        "Form validation with real-time feedback",
        "Auto-save and draft functionality",
        "Bulk customer import with validation",
        "Form accessibility and keyboard navigation"
      ],
      "files_to_modify": [
        "src/components/domain/customers/customer-form.tsx",
        "src/components/domain/customers/customer-wizard.tsx",
        "src/components/domain/customers/contact-manager.tsx",
        "src/components/domain/customers/address-manager.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_FORM_MANAGEMENT_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-HEALTH-MANAGEMENT",
      "name": "Customer Health Management",
      "description": "Customer health scoring, monitoring, and improvement system",
      "type": "ui-component",
      "acceptance_criteria": [
        "Health score visualization with trend analysis",
        "Automated health score calculation",
        "Health factor breakdown and recommendations",
        "At-risk customer identification and alerts",
        "Health improvement action plans",
        "Bulk health score updates",
        "Health score reporting and analytics",
        "Integration with customer communication"
      ],
      "files_to_modify": [
        "src/components/domain/customers/health-dashboard.tsx",
        "src/components/domain/customers/health-score-gauge.tsx",
        "src/components/domain/customers/health-recommendations.tsx",
        "src/components/domain/customers/risk-alerts.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_HEALTH_MANAGEMENT_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-SEGMENTATION-UI",
      "name": "Customer Segmentation Interface",
      "description": "Dynamic customer segmentation and targeting system",
      "type": "ui-component",
      "acceptance_criteria": [
        "Visual segment builder with drag-and-drop",
        "Advanced filtering with multiple criteria types",
        "Segment size and value calculations",
        "Saved segment management",
        "Segment-based campaign targeting",
        "Segment overlap analysis",
        "Bulk segment operations",
        "Segment performance analytics"
      ],
      "files_to_modify": [
        "src/routes/_authed/customers/segments/index.tsx",
        "src/components/domain/customers/segment-builder.tsx",
        "src/components/domain/customers/segment-manager.tsx",
        "src/components/domain/customers/segment-analytics.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_SEGMENTATION_UI_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-COMMUNICATION-HUB",
      "name": "Customer Communication Hub",
      "description": "Centralized customer communication management interface",
      "type": "ui-component",
      "acceptance_criteria": [
        "Unified communication timeline",
        "Multi-channel communication logging",
        "Communication template management",
        "Bulk communication campaigns",
        "Communication analytics and reporting",
        "Communication preference management",
        "Integration with email and phone systems",
        "Communication scheduling and automation"
      ],
      "files_to_modify": [
        "src/routes/_authed/customers/communications.tsx",
        "src/components/domain/customers/communication-timeline.tsx",
        "src/components/domain/customers/communication-templates.tsx",
        "src/components/domain/customers/bulk-communications.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_COMMUNICATION_HUB_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-ANALYTICS-REPORTING",
      "name": "Customer Analytics and Reporting",
      "description": "Comprehensive customer analytics and automated reporting",
      "type": "ui-component",
      "acceptance_criteria": [
        "Customer lifecycle analytics",
        "Segmentation performance reports",
        "Health score trends and insights",
        "Customer value and profitability analysis",
        "Communication effectiveness metrics",
        "Automated report generation and scheduling",
        "Custom dashboard creation",
        "Executive customer insights dashboard"
      ],
      "files_to_modify": [
        "src/routes/_authed/reports/customers/index.tsx",
        "src/components/domain/customers/analytics-dashboard.tsx",
        "src/components/domain/customers/lifecycle-analytics.tsx",
        "src/components/domain/customers/value-analysis.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_ANALYTICS_REPORTING_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-INTEGRATION-API",
      "name": "Customer System Integration Layer",
      "description": "Integration hooks and utilities for customer system usage throughout the application",
      "type": "server-function",
      "acceptance_criteria": [
        "Customer context providers for React components",
        "Customer search and lookup utilities",
        "Customer health monitoring hooks",
        "Customer communication tracking",
        "Customer data synchronization utilities",
        "Customer permission and access control",
        "Real-time customer data broadcasting",
        "Customer relationship management utilities"
      ],
      "files_to_modify": [
        "src/contexts/customer-context.tsx",
        "src/hooks/use-customers.ts",
        "src/hooks/use-customer-health.ts",
        "src/lib/customer-utils.ts",
        "src/lib/customer-relationships.ts"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_INTEGRATION_API_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-MERGE-DEDUPLICATION",
      "name": "Customer Merge and Deduplication",
      "description": "Advanced customer record merging and duplicate prevention",
      "type": "ui-component",
      "acceptance_criteria": [
        "Duplicate customer detection algorithms",
        "Side-by-side merge comparison interface",
        "Automated merge suggestions",
        "Merge conflict resolution",
        "Bulk merge operations",
        "Merge history and audit trail",
        "Merge rollback capabilities",
        "Data integrity validation"
      ],
      "files_to_modify": [
        "src/components/domain/customers/merge-wizard.tsx",
        "src/components/domain/customers/duplicate-detection.tsx",
        "src/components/domain/customers/merge-history.tsx",
        "src/server/functions/customer-merge.ts"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_MERGE_DEDUPLICATION_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-BULK-OPERATIONS",
      "name": "Customer Bulk Operations",
      "description": "Efficient bulk customer management and processing operations",
      "type": "ui-component",
      "acceptance_criteria": [
        "Advanced customer selection interface",
        "Bulk status and tag updates",
        "Bulk communication campaigns",
        "Bulk data import and validation",
        "Bulk export with field customization",
        "Operation progress tracking and error reporting",
        "Bulk operation rollback capabilities",
        "Performance optimization for large datasets"
      ],
      "files_to_modify": [
        "src/components/domain/customers/bulk-selector.tsx",
        "src/components/domain/customers/bulk-operations.tsx",
        "src/components/domain/customers/bulk-import.tsx",
        "src/components/domain/customers/bulk-export.tsx"
      ],
      "dependencies": [
        "CUST-CORE-API"
      ],
      "completion_promise": "CUST_BULK_OPERATIONS_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "CUST-DEDUP-001",
      "name": "Real-time Duplicate Detection",
      "description": "Detect potential duplicate customers during creation. Show warning with similar matches before save.",
      "type": "ui-component",
      "acceptance_criteria": [
        "On customer name/email/phone input, check for similar existing records",
        "Fuzzy matching using PostgreSQL trigram (pg_trgm)",
        "Show 'Similar customers found' warning panel below form",
        "Panel shows: name, email, phone, customer number for each match",
        "User can click match to view, or confirm 'Create anyway'",
        "Matching threshold: 0.3 similarity score",
        "Debounce API calls (300ms)"
      ],
      "layers": ["server", "ui"],
      "files_to_modify": [
        "src/components/domain/customers/duplicate-warning-panel.tsx",
        "src/server/functions/customer-duplicates.ts",
        "src/hooks/use-duplicate-detection.ts",
        "drizzle/migrations/XXX_pg_trgm_extension.ts"
      ],
      "dependencies": [],
      "completion_promise": "CUST_DEDUP_001_COMPLETE",
      "estimated_iterations": 2,
      "status": "pending"
    },
    {
      "id": "CUST-DEDUP-002",
      "name": "Duplicate Merge Tool Enhancement",
      "description": "Enhance existing merge tool with duplicate detection scan.",
      "type": "ui-component",
      "acceptance_criteria": [
        "'Find Duplicates' button on customer list",
        "Scan identifies potential duplicate pairs",
        "Review queue with side-by-side comparison",
        "Merge selected duplicates (keep primary, archive secondary)",
        "Audit trail of merges"
      ],
      "layers": ["server", "ui"],
      "files_to_modify": [
        "src/components/domain/customers/duplicate-scan-button.tsx",
        "src/components/domain/customers/duplicate-review-queue.tsx",
        "src/components/domain/customers/duplicate-comparison.tsx",
        "src/server/functions/customer-duplicate-scan.ts",
        "src/lib/schema/customer-merge-audit.ts"
      ],
      "dependencies": ["CUST-DEDUP-001"],
      "completion_promise": "CUST_DEDUP_002_COMPLETE",
      "estimated_iterations": 2,
      "status": "pending"
    }
  ],
  "success_criteria": [
    "Complete customer relationship management system with 360-degree views",
    "Advanced customer health scoring with predictive analytics",
    "Dynamic customer segmentation and targeting capabilities",
    "Comprehensive customer communication and engagement tracking",
    "Real-time customer search and filtering across 100k+ records",
    "Automated customer lifecycle management and nurturing",
    "Customer data quality management with deduplication",
    "Multi-channel customer communication management",
    "Customer profitability and lifetime value analysis",
    "Integration with sales, marketing, and service systems",
    "GDPR-compliant customer data management",
    "Mobile-responsive customer management interfaces",
    "Real-time customer activity monitoring and alerting",
    "Advanced customer analytics and reporting capabilities",
    "Scalable architecture supporting enterprise customer volumes",
    "Customer self-service portal integration capabilities",
    "Automated customer onboarding and activation workflows",
    "Customer feedback and satisfaction tracking",
    "Multi-tenant customer data isolation and security",
    "Complete audit trail for all customer interactions"
  ],
  "out_of_scope": [
    "Customer self-service portal development",
    "External CRM system integrations",
    "Advanced marketing automation features",
    "Customer behavioral prediction AI/ML",
    "Real-time customer sentiment analysis",
    "Blockchain-based customer identity verification",
    "Advanced customer journey mapping",
    "Customer social media monitoring",
    "Voice customer service integration",
    "Advanced customer privacy and consent management"
  ],
  "migration_notes": {
    "existing_data": "If existing customer data exists, migration scripts needed to transform schema to comprehensive CRM structure",
    "contact_data": "Existing contact information needs mapping to new contact management structure",
    "activity_data": "Existing activity logs need transformation to unified timeline format",
    "tag_data": "Existing customer categories need conversion to flexible tagging system"
  },
  "pattern_references": [
    {
      "file": "_Initiation/_meta/patterns/testing-standards.md",
      "applies_to": "all stories",
      "reason": "All stories must follow testing standards including TDD flow, coverage expectations (80% server functions, 90% utilities), and story-level testing requirements"
    },
    {
      "file": "_Initiation/_meta/patterns/error-recovery.md",
      "applies_to": "CUST-CORE-API, CUST-HEALTH-SCORING, all server function stories",
      "reason": "Server stories must implement Pattern 3 (Saga Pattern) for multi-step operations like customer creation with contacts/addresses, and proper error handling for API operations"
    },
    {
      "file": "_Initiation/_meta/patterns/performance-benchmarks.md",
      "applies_to": "CUST-DIRECTORY-UI, CUST-360-VIEW-UI, all UI and API stories",
      "reason": "Customer list views must load <500ms for 100 items, detail views <300ms. Customer search must return <500ms. All queries must use pagination (limit 50)"
    },
    {
      "file": "_Initiation/_meta/patterns/ux-3-click-rule.md",
      "applies_to": "CUST-DIRECTORY-UI, CUST-360-VIEW-UI, CUST-FORM-MANAGEMENT, all UI stories",
      "reason": "Sales role uses Cmd+N for new customer (2 clicks), customer quick actions via hover preview (1 click). All high-frequency tasks must be <=3 actions"
    }
  ]
}