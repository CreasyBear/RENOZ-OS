{
  "id": "DOM-SUPPORT",
  "name": "Support/Issues Domain",
  "description": "Battery system issue tracking and technical support. Manages support workflow for battery performance, inverter errors, installation problems, and connectivity issues from creation through resolution.",
  "created": "2026-01-09",
  "priority": 9,
  "phase": "domain-v2",
  "version": "v2",
  "dependencies": {
    "phase": "Domain",
    "executionOrder": 9,
    "schemaRequired": [
      {
        "table": "organizations",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      },
      {
        "table": "users",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      },
      {
        "table": "customers",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      },
      {
        "table": "issues",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      },
      {
        "table": "activities",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      },
      {
        "table": "notifications",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      },
      {
        "table": "orders",
        "status": "EXISTS",
        "createdBy": "schema-foundation"
      }
    ],
    "schemaCreates": [
      {
        "table": "sla_configurations",
        "story": "DOM-SUP-001a",
        "note": "Uses unified SLA engine table, creates domain='support' entries"
      },
      {
        "table": "escalation_rules",
        "story": "DOM-SUP-002a"
      },
      {
        "table": "return_authorizations",
        "story": "DOM-SUP-003a"
      },
      {
        "table": "issue_templates",
        "story": "DOM-SUP-004"
      },
      {
        "table": "issue_feedback",
        "story": "DOM-SUP-005a"
      },
      {
        "table": "kb_articles",
        "story": "DOM-SUP-007a"
      },
      {
        "table": "kb_categories",
        "story": "DOM-SUP-007a"
      }
    ],
    "serverFunctionsRequired": [],
    "serverFunctionsCreates": [
      {
        "function": "createSlaConfiguration",
        "story": "DOM-SUP-001a",
        "note": "Wrapper around unified SLA engine for Support domain"
      },
      {
        "function": "getSlaConfiguration",
        "story": "DOM-SUP-001a",
        "note": "Uses unified sla_configurations table"
      },
      {
        "function": "startSlaTracking",
        "story": "DOM-SUP-001a",
        "note": "Calls SLA State Manager startTracking()"
      },
      {
        "function": "pauseSla",
        "story": "DOM-SUP-001c",
        "note": "Calls SLA State Manager pause() - unified engine"
      },
      {
        "function": "resumeSla",
        "story": "DOM-SUP-001c",
        "note": "Calls SLA State Manager resume() - unified engine"
      },
      {
        "function": "createEscalationRule",
        "story": "DOM-SUP-002a"
      },
      {
        "function": "escalateIssue",
        "story": "DOM-SUP-002a"
      },
      {
        "function": "deescalateIssue",
        "story": "DOM-SUP-002a"
      },
      {
        "function": "createRMA",
        "story": "DOM-SUP-003a"
      },
      {
        "function": "getRMA",
        "story": "DOM-SUP-003a"
      },
      {
        "function": "approveRMA",
        "story": "DOM-SUP-003b"
      },
      {
        "function": "receiveRMA",
        "story": "DOM-SUP-003b"
      },
      {
        "function": "processRMA",
        "story": "DOM-SUP-003b"
      },
      {
        "function": "createIssueTemplate",
        "story": "DOM-SUP-004"
      },
      {
        "function": "submitFeedback",
        "story": "DOM-SUP-005a"
      },
      {
        "function": "createKbArticle",
        "story": "DOM-SUP-007a"
      },
      {
        "function": "searchKbArticles",
        "story": "DOM-SUP-007b"
      }
    ],
    "prdDependencies": [
      {
        "prdId": "schema-foundation",
        "status": "REQUIRED",
        "reason": "Base schema must exist (organizations, users, customers, issues, activities)"
      },
      {
        "prdId": "DOM-ORD",
        "status": "REQUIRED",
        "reason": "RMA workflow links to order line items"
      },
      {
        "prdId": "DOM-WARRANTY",
        "status": "OPTIONAL",
        "reason": "Warranty claims may create issues"
      }
    ],
    "enables": [
      {
        "prdId": "DOM-REPORTS",
        "reason": "Reports domain uses support metrics and SLA data"
      },
      {
        "prdId": "DOM-COMMS",
        "reason": "Communications domain uses issue-related emails"
      }
    ]
  },
  "references": {
    "internal": [
      "memory-bank/_meta/glossary.md - Issue terminology",
      "src/lib/schema/issues.ts - Issue schema",
      "src/lib/schemas/issues.ts - Validation schemas",
      "src/server/functions/issues.ts - Server functions"
    ],
    "external": [
      "No external dependencies"
    ]
  },
  "current_state": {
    "implemented": [
      "Issue CRUD operations",
      "Issue types (hardware_fault, software_firmware, installation_defect, performance_degradation, connectivity, other)",
      "Issue status workflow (including 'escalated' status)",
      "Issue activities/notes",
      "Issue list with filters",
      "Issue metrics (open, urgent, overdue with hardcoded 7-day threshold)",
      "Manual escalation via status change"
    ],
    "gaps": [
      "No configurable SLA tracking with priority/standard tiers (only hardcoded 7-day threshold)",
      "No automatic escalation rules",
      "No return authorization (RMA) workflow for defective batteries/inverters",
      "No knowledge base with battery troubleshooting guides and inverter error codes",
      "No issue templates for common battery/inverter issues",
      "No customer satisfaction tracking for support resolution quality",
      "No dedicated support dashboard with battery-specific metrics"
    ]
  },
  "stories": [
    {
      "id": "DOM-SUP-001a",
      "name": "SLA Schema and Basic Tracking (Unified Engine Integration)",
      "description": "Integrate with unified SLA engine at src/lib/sla/. Create domain-specific sla_configurations entries for Priority (4h response) and Standard (24h response) tiers. Issues link to sla_tracking table via FK instead of inline SLA columns.",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Uses unified sla_configurations table (NOT domain-specific sla_policies)",
        "Create default Support SLA configs: Priority (4h response, 24h resolution), Standard (24h response, 72h resolution)",
        "issues table has sla_tracking_id FK (replaces inline slaResponseDue, slaResolutionDue, slaPolicyId)",
        "Migration script runs without errors",
        "CreateIssueSchema updated with optional slaConfigurationId",
        "createIssue function calls SLA State Manager startTracking() to create sla_tracking record",
        "SLA due dates calculated using unified SLA Calculator with business hours support",
        "Types exported from lib/schema/index.ts",
        "TypeScript compiles without errors"
      ],
      "remediation_notes": {
        "source": "_meta/remediation-sla-engine.md",
        "key_changes": [
          "Replace sla_policies table with sla_configurations (unified engine)",
          "Replace inline SLA columns with sla_tracking_id FK",
          "Use src/lib/sla/state-manager.ts for starting/pausing/resuming SLA",
          "Use src/lib/sla/calculator.ts for due date calculations with business hours"
        ],
        "tables_used": ["sla_configurations", "sla_tracking", "sla_events", "business_hours_config"],
        "implementation_notes": [
          "SLA engine provides unified pause/resume logic - DO NOT implement domain-specific pause handling",
          "Business hours and holidays are organization-level config - use business_hours_config and organization_holidays tables",
          "sla_tracking.is_paused and paused_at fields replace issues.slaWaitingOnCustomerSince",
          "At-risk threshold is configurable per sla_configuration (default 25%)"
        ]
      },
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_001A_COMPLETE",
      "uiPatterns": {
        "components": [
          "form.tsx - SLA configuration settings form",
          "select.tsx - SLA tier dropdown",
          "input.tsx - Response/resolution inputs with unit selector",
          "dialog.tsx - SLA configuration creation modal"
        ],
        "referenceFiles": [
          "_reference/.midday-reference/apps/dashboard/src/components/support-form.tsx - Form pattern",
          "_reference/.reui-reference/registry/default/ui/form.tsx - Form components"
        ],
        "notes": "Settings page pattern for SLA configuration management. Use sla_configurations table, not sla_policies."
      }
    },
    {
      "id": "DOM-SUP-001b",
      "name": "SLA Breach Detection and Warnings",
      "description": "Use unified SLA Breach Detector for at-risk and breach detection. Display SLA state from sla_tracking table.",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "getIssueListMetrics queries sla_tracking table for breach/at-risk status",
        "Uses SLA State Manager getState() to compute remaining time and at-risk status",
        "Issue list shows SLA breach warning badge (yellow = at risk per atRiskThresholdPercent, red = breached)",
        "Issue detail page shows SLA status section with response and resolution times from sla_tracking",
        "SLA status considers response vs resolution separately (responseBreached, resolutionBreached flags)",
        "At-risk threshold configurable per sla_configuration (default 25%)",
        "TypeScript compiles without errors"
      ],
      "remediation_notes": {
        "source": "_meta/remediation-sla-engine.md",
        "key_changes": [
          "Use SLA State Manager getState() for computed SLA snapshot",
          "At-risk warnings based on configurable atRiskThresholdPercent",
          "Breach status from sla_tracking.responseBreached / resolutionBreached"
        ]
      },
      "dependencies": [
        "DOM-SUP-001a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_001B_COMPLETE",
      "uiPatterns": {
        "components": [
          "badge.tsx - SLA breach indicators (yellow/red variants)",
          "alert.tsx - SLA warning notifications",
          "card.tsx - SLA status section on detail page",
          "progress.tsx - Time remaining visualization"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/badge.tsx",
          "_reference/.reui-reference/registry/default/ui/alert.tsx"
        ],
        "notes": "Use color-coded badges for breach states: default (on-track), yellow (at-risk <25% remaining), red (breached)"
      }
    },
    {
      "id": "DOM-SUP-001c",
      "name": "SLA Dashboard and Pause Feature (Unified Engine)",
      "description": "Add SLA widgets to dashboard and implement pause/resume using unified SLA State Manager.",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Changing to 'on_hold' status with reason 'waiting_on_customer' calls SLA State Manager pause()",
        "Resuming from on_hold calls SLA State Manager resume() which recalculates due dates",
        "Pause/resume uses sla_tracking table fields (is_paused, paused_at, total_paused_duration_seconds)",
        "SLA breach count shown on support dashboard/metrics (query sla_tracking for responseBreached/resolutionBreached)",
        "SLA report by issue type available using sla_tracking join with issues",
        "SLA events audit trail created for pause/resume actions",
        "TypeScript compiles without errors"
      ],
      "remediation_notes": {
        "source": "_meta/remediation-sla-engine.md",
        "key_changes": [
          "DO NOT add issues.slaWaitingOnCustomerSince - use sla_tracking.paused_at instead",
          "Use SLA State Manager pause() and resume() methods from src/lib/sla/state-manager.ts",
          "Pause/resume creates sla_events records for audit trail",
          "total_paused_duration_seconds accumulates across multiple pause/resume cycles"
        ]
      },
      "dependencies": [
        "DOM-SUP-001b"
      ],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_001C_COMPLETE",
      "uiPatterns": {
        "components": [
          "card.tsx - Dashboard widgets for SLA metrics",
          "chart.tsx - SLA breach trends over time",
          "button.tsx - Pause/resume SLA buttons",
          "dialog.tsx - Pause reason confirmation",
          "counting-number.tsx - Animated SLA breach count"
        ],
        "referenceFiles": [
          "_reference/.midday-reference/apps/dashboard/src/components/metrics/*.tsx - Dashboard patterns",
          "_reference/.reui-reference/registry/default/ui/chart.tsx"
        ],
        "notes": "Dashboard should show: total breaches, breach rate %, avg response time, avg resolution time by issue type. Query sla_tracking table, not inline issue fields."
      }
    },
    {
      "id": "DOM-SUP-002a",
      "name": "Escalation Schema and Manual Improvements",
      "description": "Add escalation_rules table and improve manual escalation with history tracking.",
      "priority": 4,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "escalation_rules table created (id, name, condition, action, organizationId)",
        "issues.escalatedAt column added",
        "Escalation recorded as activity with metadata (escalatedBy, reason)",
        "De-escalate action available with notes",
        "Escalation history visible in issue timeline",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_002A_COMPLETE",
      "uiPatterns": {
        "components": [
          "dialog.tsx - Escalation reason modal",
          "form.tsx - Escalation form with reason textarea",
          "button.tsx - Escalate/de-escalate action buttons",
          "badge.tsx - Escalated status indicator",
          "tabs.tsx - Timeline view for escalation history"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/dialog.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/support-form.tsx"
        ],
        "notes": "Timeline should show escalation events with timestamp, actor, reason. Use destructive variant for escalate button."
      }
    },
    {
      "id": "DOM-SUP-002b",
      "name": "Automatic Escalation Engine",
      "description": "Implement background job for time-based and rule-based automatic escalation.",
      "priority": 5,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Trigger.dev job runs every 15 minutes to check escalation rules",
        "Time-based escalation works (e.g., after 24h unresponded)",
        "VIP customer escalation works (if customer has VIP flag)",
        "Manager notification sent on auto-escalation",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-002a",
        "DOM-SUP-001a"
      ],
      "estimated_iterations": 3,
      "completion_promise": "DOM_SUP_002B_COMPLETE",
      "uiPatterns": {
        "components": [
          "form.tsx - Escalation rule builder form",
          "select.tsx - Rule condition dropdowns",
          "input.tsx - Time threshold inputs",
          "table.tsx - Escalation rules list",
          "badge.tsx - Auto-escalated indicator"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/table.tsx",
          "_reference/.reui-reference/registry/default/ui/form.tsx"
        ],
        "notes": "Rule builder should allow: condition type (time/customer type), threshold value, escalation action (notify/reassign)"
      }
    },
    {
      "id": "DOM-SUP-003a",
      "name": "RMA Schema and Basic CRUD",
      "description": "Create return_authorizations table for defective battery/inverter returns with basic CRUD operations.",
      "priority": 6,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "return_authorizations table created (id, rmaNumber, issueId, status, items, notes, organizationId)",
        "RMA number generation function (RMA-000001 format)",
        "CreateRMASchema and UpdateRMASchema implemented",
        "createRMA and getRMA server functions work",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_003A_COMPLETE",
      "uiPatterns": {
        "components": [
          "form.tsx - RMA creation form",
          "input.tsx - RMA notes textarea",
          "badge.tsx - RMA number display",
          "card.tsx - RMA detail card"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/form.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/support-form.tsx"
        ],
        "notes": "Form should include: issue selector, item selection, defect description, return reason"
      }
    },
    {
      "id": "DOM-SUP-003b",
      "name": "RMA Workflow and Status Transitions",
      "description": "Implement RMA workflow with proper status transitions and validation.",
      "priority": 7,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "RMA workflow statuses: requested, approved, received, processed, rejected",
        "Status transition validation (cannot skip states)",
        "approveRMA, receiveRMA, processRMA server functions",
        "RMA items linked to original order line items",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-003a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_003B_COMPLETE",
      "uiPatterns": {
        "components": [
          "badge.tsx - Status indicators (requested/approved/received/processed/rejected)",
          "button.tsx - Workflow action buttons",
          "dialog.tsx - Status transition confirmation modals",
          "alert.tsx - Validation error messages",
          "separator.tsx - Workflow step dividers"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/badge.tsx",
          "_reference/.reui-reference/registry/default/ui/alert-dialog.tsx"
        ],
        "notes": "Use stepper pattern to show workflow progression. Disable invalid transitions. Color-code status badges."
      }
    },
    {
      "id": "DOM-SUP-003c",
      "name": "RMA UI and Issue Integration",
      "description": "Build RMA form for battery/inverter returns, workflow UI, and integrate with issue detail page.",
      "priority": 8,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "RMA creation button on issue detail (for return type issues)",
        "RMA form with item selection from linked order",
        "RMA workflow status display and transition buttons",
        "Receipt inspection logging form",
        "RMA list visible on customer and issue detail pages",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-003b"
      ],
      "estimated_iterations": 3,
      "completion_promise": "DOM_SUP_003C_COMPLETE",
      "uiPatterns": {
        "components": [
          "dialog.tsx - RMA creation modal",
          "form.tsx - RMA form with item checkboxes",
          "checkbox.tsx - Item selection",
          "data-grid.tsx - RMA list table",
          "button.tsx - Status transition buttons",
          "tabs.tsx - Issue detail with RMA tab"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/data-grid.tsx",
          "_reference/.reui-reference/registry/default/ui/checkbox.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/support-form.tsx"
        ],
        "notes": "RMA list should show: RMA number, status, items count, created date, actions. Filter by status."
      }
    },
    {
      "id": "DOM-SUP-004",
      "name": "Add Issue Templates",
      "description": "Pre-configured templates for common battery/inverter issues (e.g., 'Battery Not Charging', 'Inverter Error Code', 'Performance Degradation') with defaults for quick creation.",
      "priority": 9,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "issue_templates table (id, name, type, defaultPriority, defaultAssignee, descriptionPrompt, requiredFields, usageCount, organizationId)",
        "Template management UI in settings",
        "Quick issue creation from template",
        "Template includes: description prompts, required fields",
        "Most used templates suggested on issue creation (sorted by usageCount)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 4,
      "completion_promise": "DOM_SUP_004_COMPLETE",
      "uiPatterns": {
        "components": [
          "dialog.tsx - Template selector modal",
          "card.tsx - Template cards with preview",
          "form.tsx - Template builder form",
          "data-grid.tsx - Template management table",
          "badge.tsx - Usage count badge",
          "button.tsx - Quick create from template button"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/card.tsx",
          "_reference/.reui-reference/registry/default/ui/dialog.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/support-form.tsx"
        ],
        "notes": "Template selector should show: template name, issue type icon, usage count, quick preview. Sort by usage. Settings page for CRUD."
      }
    },
    {
      "id": "DOM-SUP-005a",
      "name": "CSAT Schema and Internal Entry",
      "description": "Create issue_feedback table and internal rating entry capability.",
      "priority": 10,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "issue_feedback table (id, issueId, rating, comment, submittedAt, submittedBy, token)",
        "CreateFeedbackSchema implemented",
        "Server function to submit feedback (internal use)",
        "Rating display on issue detail page",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_005A_COMPLETE",
      "uiPatterns": {
        "components": [
          "rating.tsx - Star rating component (1-5 stars)",
          "card.tsx - Feedback display card",
          "form.tsx - Internal feedback form",
          "badge.tsx - Rating score badge"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/rating.tsx",
          "_reference/.reui-reference/registry/default/ui/form.tsx"
        ],
        "notes": "Use star rating component for 1-5 scale. Show average rating as badge on issue card."
      }
    },
    {
      "id": "DOM-SUP-005b",
      "name": "CSAT Email and Public Form",
      "description": "Send rating request email on resolution and public form for customers.",
      "priority": 11,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Email sent on issue resolution with rating link (token-based)",
        "Public rating form (no auth required, token validation)",
        "Simple 1-5 star rating with optional comment",
        "Feedback stored with customer context",
        "Rate limiting on submissions",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-005a"
      ],
      "estimated_iterations": 3,
      "completion_promise": "DOM_SUP_005B_COMPLETE",
      "uiPatterns": {
        "components": [
          "rating.tsx - Public star rating",
          "form.tsx - Public feedback form (minimal auth)",
          "button.tsx - Submit feedback button",
          "card.tsx - Thank you confirmation card",
          "alert.tsx - Rate limit warning"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/rating.tsx",
          "_reference/.midday-reference/apps/dashboard/src/components/support-form.tsx"
        ],
        "notes": "Public form should be minimal: star rating, optional comment, submit. Show thank you message on success."
      }
    },
    {
      "id": "DOM-SUP-005c",
      "name": "CSAT Dashboard and Follow-up",
      "description": "Display CSAT score on dashboard and trigger follow-up on low ratings.",
      "priority": 12,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "CSAT average score on support metrics/dashboard",
        "Low rating (1-2) creates follow-up notification/task",
        "CSAT trend visible over time",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-005b",
        "DOM-SUP-006"
      ],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_005C_COMPLETE",
      "uiPatterns": {
        "components": [
          "card.tsx - CSAT score widget on dashboard",
          "chart.tsx - CSAT trend line chart",
          "badge.tsx - Score visualization (color-coded)",
          "alert.tsx - Low rating notifications",
          "counting-number.tsx - Animated average score"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/chart.tsx",
          "_reference/.reui-reference/registry/default/ui/counting-number.tsx"
        ],
        "notes": "Dashboard widget should show: avg CSAT (1-5), trend arrow, distribution chart. Color-code: green >=4, yellow 3-4, red <3"
      }
    },
    {
      "id": "DOM-SUP-006",
      "name": "Create Support Dashboard",
      "description": "Support team performance overview dashboard.",
      "priority": 13,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Support dashboard page at /support/dashboard",
        "Widgets: open issues, SLA breaches, avg resolution time",
        "Issue breakdown by type, priority, status",
        "Team performance comparison",
        "Trend charts over time",
        "Quick actions: create issue, view queue",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-001c"
      ],
      "estimated_iterations": 4,
      "completion_promise": "DOM_SUP_006_COMPLETE",
      "uiPatterns": {
        "components": [
          "card.tsx - Dashboard metric cards",
          "chart.tsx - Trend charts (line, bar, pie)",
          "data-grid.tsx - Issue queue table",
          "button.tsx - Quick action buttons",
          "tabs.tsx - Dashboard sections",
          "counting-number.tsx - Animated metrics",
          "badge.tsx - Status indicators"
        ],
        "referenceFiles": [
          "_reference/.midday-reference/apps/dashboard/src/components/metrics/*.tsx",
          "_reference/.reui-reference/registry/default/ui/chart.tsx",
          "_reference/.reui-reference/registry/default/ui/card.tsx"
        ],
        "notes": "Layout: 4 metric cards (open, breached, avg response, avg resolution), 2 charts (type breakdown, priority distribution), issue queue table. Quick actions in header."
      }
    },
    {
      "id": "DOM-SUP-007a",
      "name": "Knowledge Base Schema and Basic CRUD",
      "description": "Create kb_articles table for battery troubleshooting guides, inverter error code documentation, and installation guides. Basic article management.",
      "priority": 14,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "kb_articles table (id, title, content, category, tags, status, viewCount, organizationId)",
        "kb_categories table (id, name, parentId, organizationId)",
        "Article CRUD server functions",
        "Basic article list and detail pages",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_007A_COMPLETE",
      "uiPatterns": {
        "components": [
          "form.tsx - Article editor form",
          "input.tsx - Title, tags inputs",
          "textarea.tsx - Rich text content editor",
          "select.tsx - Category dropdown",
          "data-grid.tsx - Article list table",
          "card.tsx - Article preview card",
          "badge.tsx - Status, view count badges"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/form.tsx",
          "_reference/.reui-reference/registry/default/ui/data-grid.tsx"
        ],
        "notes": "Article form should support: title, category, tags (comma-separated), status (draft/published), markdown content editor"
      }
    },
    {
      "id": "DOM-SUP-007b",
      "name": "Knowledge Base Search and Categories",
      "description": "Add search functionality and category management.",
      "priority": 15,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Full-text search across article title and content",
        "Category CRUD and hierarchy support",
        "Article tags for filtering",
        "Category management in settings",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-007a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_007B_COMPLETE",
      "uiPatterns": {
        "components": [
          "input.tsx - Search input with icon",
          "command.tsx - Search command palette",
          "accordion.tsx - Category hierarchy tree",
          "badge.tsx - Tag filters",
          "dialog.tsx - Category CRUD modals",
          "breadcrumb.tsx - Category navigation"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/command.tsx",
          "_reference/.reui-reference/registry/default/ui/accordion.tsx",
          "_reference/.reui-reference/registry/default/ui/breadcrumb.tsx"
        ],
        "notes": "Search should show instant results as typing. Category tree allows nesting. Tag badges are clickable filters."
      }
    },
    {
      "id": "DOM-SUP-007c",
      "name": "Knowledge Base Issue Integration",
      "description": "Integrate KB search into issue form and track article helpfulness.",
      "priority": 16,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Search articles from issue creation form",
        "Link article to issue resolution",
        "Helpfulness rating on articles (was this helpful?)",
        "View count tracking on article access",
        "Most viewed/helpful articles displayed",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-007b"
      ],
      "estimated_iterations": 2,
      "completion_promise": "DOM_SUP_007C_COMPLETE",
      "uiPatterns": {
        "components": [
          "command.tsx - Inline article search in issue form",
          "card.tsx - Article suggestion cards",
          "button.tsx - Helpful/not helpful buttons",
          "badge.tsx - View count badge",
          "popover.tsx - Article quick preview"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/command.tsx",
          "_reference/.reui-reference/registry/default/ui/popover.tsx",
          "_reference/.reui-reference/registry/default/ui/card.tsx"
        ],
        "notes": "Issue form sidebar shows relevant KB articles based on issue type/description. Quick preview on hover. Track helpful votes."
      }
    },
    {
      "id": "DOM-SUP-008",
      "name": "Enhance Issue Workflow",
      "description": "Kanban board view, bulk actions, and related issues.",
      "priority": 17,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Issue board (Kanban) view by status",
        "Drag-drop status change with note prompt",
        "Quick filters: my issues, unassigned, SLA at risk",
        "Bulk actions: assign, change priority",
        "Related issues linking (manual)",
        "Issue duplication detection (same customer + similar title)",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-SUP-001b"
      ],
      "estimated_iterations": 5,
      "completion_promise": "DOM_SUP_008_COMPLETE",
      "uiPatterns": {
        "components": [
          "kanban.tsx - Kanban board with drag-drop",
          "card.tsx - Issue cards in kanban columns",
          "dialog.tsx - Status change note prompt",
          "checkbox.tsx - Bulk selection checkboxes",
          "dropdown-menu.tsx - Bulk actions menu",
          "badge.tsx - Status, priority, SLA indicators",
          "filters.tsx - Quick filter chips",
          "alert.tsx - Duplicate detection warnings"
        ],
        "referenceFiles": [
          "_reference/.reui-reference/registry/default/ui/kanban.tsx",
          "_reference/.reui-reference/registry/default/ui/data-grid-table-dnd.tsx",
          "_reference/.reui-reference/registry/default/ui/filters.tsx"
        ],
        "notes": "Kanban columns: new, open, in_progress, on_hold, resolved, closed. Drag to change status. Bulk select with shift+click. Filter bar at top."
      }
    }
  ],
  "success_criteria": [
    "SLAs tracked with Priority (4h) and Standard (24h) tiers enforced",
    "Escalation prevents battery/inverter issues falling through",
    "RMAs formalize defective battery/inverter returns",
    "Templates speed up creation of common battery/inverter issues",
    "CSAT measures customer satisfaction with technical support resolution",
    "Dashboard shows battery-specific support metrics",
    "Knowledge base contains battery troubleshooting and inverter error code guides",
    "npm run typecheck passes",
    "No support functionality regressions"
  ],
  "out_of_scope": [
    "Customer self-service portal",
    "Live chat integration",
    "AI-powered issue routing",
    "Public knowledge base"
  ],
  "pattern_references": [
    {
      "file": "_Initiation/_meta/patterns/testing-standards.md",
      "applies_to": "all stories",
      "reason": "All stories must follow testing standards"
    },
    {
      "file": "_Initiation/_meta/patterns/mobile-ui-patterns.md",
      "applies_to": "DOM-SUP-001b, DOM-SUP-001c, DOM-SUP-003c, DOM-SUP-006, DOM-SUP-008, all UI stories",
      "reason": "Use AlertDialog (not window.confirm) for all confirmations (RMA approval, ticket closure, escalation). Use loading skeletons, label associations, memoized list items. Applies to desktop UI as well."
    }
  ]
}
