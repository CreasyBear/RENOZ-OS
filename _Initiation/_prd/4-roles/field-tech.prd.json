{
  "id": "ROLE-FIELD",
  "name": "Field Technician Role Optimization",
  "description": "Mobile-first experience for Field Technicians. Focus on offline capability, simple task completion, and easy documentation.",
  "created": "2026-01-09",
  "priority": 3,
  "phase": "role",
  "persona": "Field Technician",
  "dependencies": {
    "phase": "Role",
    "executionOrder": 6,
    "schemaRequired": [
      {
        "table": "users",
        "status": "EXISTS"
      },
      {
        "table": "job-assignments",
        "status": "EXISTS"
      },
      {
        "table": "orders",
        "status": "EXISTS"
      },
      {
        "table": "customers",
        "status": "EXISTS"
      }
    ],
    "prdDependencies": [
      {
        "prdId": "DOM-JOBS",
        "status": "REQUIRED",
        "reason": "Field tech role needs job management domain for scheduling, time tracking, and checklists"
      },
      {
        "prdId": "DOM-CUST",
        "status": "OPTIONAL",
        "reason": "Field tech may view customer details for job context"
      }
    ],
    "enables": []
  },
  "ui_spec": {
    "target_role": "field-tech",
    "primary_device": "mobile",
    "priority_actions": [
      "Start Job",
      "Complete Job",
      "Take Photo"
    ],
    "accessibility": {
      "keyboard_navigation": true,
      "screen_reader_support": true,
      "color_contrast": "WCAG AA",
      "focus_indicators": "visible ring on all interactive elements",
      "touch_targets": "min 44px - critical for outdoor/gloved use"
    },
    "dashboard_layout": {
      "type": "mobile-first-list",
      "primary_section": "todays-jobs",
      "widget_arrangement": [
        {
          "widget": "next-job-highlight",
          "position": "top",
          "prominence": "hero"
        },
        {
          "widget": "todays-schedule",
          "position": "main",
          "prominence": "primary"
        },
        {
          "widget": "sync-status",
          "position": "bottom-sticky",
          "prominence": "status"
        }
      ]
    },
    "quick_action_panel": {
      "position": "bottom floating FAB",
      "actions": [
        {
          "label": "Start Job",
          "icon": "play",
          "gesture": "tap"
        },
        {
          "label": "Take Photo",
          "icon": "camera",
          "gesture": "tap"
        },
        {
          "label": "Log Time",
          "icon": "clock",
          "gesture": "tap"
        }
      ]
    },
    "notification_preferences": {
      "new_job_assigned": {
        "default": true,
        "channels": [
          "push",
          "in-app"
        ],
        "timing": "immediate"
      },
      "schedule_change": {
        "default": true,
        "channels": [
          "push",
          "in-app"
        ],
        "timing": "immediate"
      },
      "sync_failed": {
        "default": true,
        "channels": [
          "in-app"
        ],
        "timing": "immediate"
      }
    },
    "mobile_optimization": {
      "bottom_nav": true,
      "swipe_gestures": true,
      "large_touch_targets": true,
      "simplified_views": true,
      "offline_first": true,
      "one_handed_use": "optimized for right-hand thumb reach"
    }
  },
  "references": {
    "internal": [
      "memory-bank/VISION.md - User personas",
      "memory-bank/_meta/assumptions.md - Mobile strategy"
    ],
    "external": []
  },
  "current_state": {
    "implemented": [
      "Job list view",
      "Basic job detail",
      "Photo capture",
      "Public sign-off page",
      "PWA with service worker",
      "IndexedDB offline storage",
      "Sync manager",
      "GPS location checking",
      "Offline indicator",
      "InstallerShell mobile layout"
    ],
    "gaps": [
      "Touch targets not 44px",
      "Swipe gestures not integrated",
      "Offline photo queuing not wired up",
      "GPS not recorded on job events",
      "No pull-to-refresh",
      "Time tracking needs schema",
      "Checklists need schema"
    ]
  },
  "stories": [
    {
      "id": "ROLE-FIELD-001",
      "name": "Enhance Mobile Touch Targets and Swipe Gestures",
      "description": "Add 44px touch targets and integrate SwipeableRow for job cards",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Primary action buttons have min-h-[44px] class",
        "Job cards in today.tsx use SwipeableRow for swipe-to-start",
        "Swipe right reveals Start Job action",
        "Test passes on 375px viewport",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_001_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Start Job",
          "View Details",
          "Navigate"
        ],
        "accessibility": {
          "touch_targets": "min 44x44px for all interactive elements",
          "spacing": "min 8px gap between touch targets",
          "swipe_alternative": "visible button for non-swipe users",
          "haptic_feedback": "vibration on swipe action trigger"
        },
        "layout": {
          "job_card": {
            "height": "min 72px for easy tap",
            "swipe_area": "full card width",
            "action_reveal": "right side, 80px width"
          },
          "button_sizes": {
            "primary": "min-h-[48px] w-full",
            "secondary": "min-h-[44px]",
            "icon_button": "min-w-[44px] min-h-[44px]"
          }
        },
        "gestures": {
          "swipe_right": "Start Job (green background)",
          "swipe_threshold": "40% of card width",
          "cancel_swipe": "Return to start if not past threshold"
        }
      }
    },
    {
      "id": "ROLE-FIELD-003a",
      "name": "Add Sync Conflict Detection on Server",
      "description": "Add version-based conflict detection for offline sync",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Server functions check version field before update",
        "Conflict response returned when version mismatch",
        "Conflict includes both server and client versions",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_003A_COMPLETE"
    },
    {
      "id": "ROLE-FIELD-003b",
      "name": "Add Sync Conflict Resolution UI",
      "description": "UI for viewing and resolving failed syncs",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Failed syncs list accessible from OfflineIndicator tap",
        "Each failed item shows error message and timestamp",
        "Retry individual item button",
        "Discard item option with confirmation",
        "Clear all failed option",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "ROLE-FIELD-003a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_003B_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Retry Sync",
          "Discard Item",
          "View Details"
        ],
        "accessibility": {
          "touch_targets": "Large buttons for retry/discard",
          "error_visibility": "Red indicator with icon, not just color",
          "screen_reader_support": "Error message and timestamp announced"
        },
        "layout": {
          "access_point": "Tap offline indicator in header",
          "panel_type": "Bottom sheet sliding up",
          "item_display": {
            "content": "Entity type, action, timestamp, error message",
            "actions": "Retry button, Discard button with confirmation"
          }
        },
        "interaction": {
          "retry": "Attempts sync immediately, shows spinner",
          "discard": "Confirmation dialog before removing",
          "clear_all": "Bulk discard with double confirmation"
        }
      }
    },
    {
      "id": "ROLE-FIELD-004",
      "name": "Quick Time Entry Mobile UI",
      "description": "Fast time logging from mobile with start/stop timer",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Start/stop timer with one tap",
        "Manual time entry option",
        "Time entries per job",
        "Break time handling",
        "Travel time separate category",
        "Daily time summary",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-JOBS-003a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_004_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Start Timer",
          "Stop Timer",
          "Log Break"
        ],
        "accessibility": {
          "touch_targets": "Extra large 56px timer button",
          "visual_feedback": "Pulsing animation when timer running",
          "color_coding": "Green=work, Blue=travel, Gray=break"
        },
        "layout": {
          "timer_widget": {
            "position": "sticky top of job detail",
            "display": "Large digital clock format HH:MM:SS",
            "button": "Full-width Start/Stop toggle"
          },
          "time_entry_form": {
            "type": "bottom sheet",
            "fields": [
              "Category (Work/Travel/Break)",
              "Start Time",
              "End Time",
              "Notes"
            ],
            "quick_entry": "duration wheel picker"
          },
          "daily_summary": {
            "position": "expandable section at bottom",
            "content": "Total hours, breakdown by category, by job"
          }
        },
        "interaction": {
          "single_tap_start": "Starts timer immediately",
          "single_tap_stop": "Stops and opens category selection",
          "running_indicator": "Visible from any screen in app"
        }
      }
    },
    {
      "id": "ROLE-FIELD-005",
      "name": "Simple Punchlist Completion Mobile UI",
      "description": "Easy checklist completion on mobile with large touch targets",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Checklist items as large checkboxes (44px+)",
        "Tap to complete item",
        "Add note per item inline",
        "Photo attachment per item",
        "Progress indicator (X of Y)",
        "Mark all complete action",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "DOM-JOBS-004a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_005_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Check Item",
          "Add Note",
          "Attach Photo"
        ],
        "accessibility": {
          "touch_targets": "48px checkbox tap area",
          "spacing": "16px between checklist items",
          "progress_announcement": "Screen reader announces X of Y complete"
        },
        "layout": {
          "checklist_view": {
            "type": "vertical list",
            "item_height": "min 64px to accommodate checkbox + actions",
            "checkbox_position": "left side, 48px tap area"
          },
          "item_expanded": {
            "reveal": "tap item text to expand",
            "content": "Note input field, photo attachment button"
          },
          "progress_bar": {
            "position": "sticky top",
            "display": "visual bar + X of Y text"
          }
        },
        "interaction": {
          "tap_checkbox": "Toggle complete with animation",
          "tap_item_text": "Expand for notes/photos",
          "long_press": "Quick photo capture",
          "mark_all": "Floating button when >50% complete"
        }
      }
    },
    {
      "id": "ROLE-FIELD-006",
      "name": "Offline Photo Queuing Integration",
      "description": "Integrate IndexedDB photo storage for offline capture with compression",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Photos saved to IndexedDB when offline",
        "Upload queue indicator per photo (pending/uploading/done/failed)",
        "Auto-sync when online via syncPhotos",
        "Compression to max 1920px dimension before storage",
        "Quality reduced to 0.7 for smaller file size",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_006_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Take Photo",
          "View Queue",
          "Retry Upload"
        ],
        "accessibility": {
          "status_indicators": "Icon + text for upload status",
          "progress_visibility": "Clear percentage or spinner per photo",
          "screen_reader_support": "Announce upload status changes"
        },
        "layout": {
          "photo_capture": {
            "button": "Large camera FAB or full-width button",
            "preview": "Thumbnail grid after capture"
          },
          "upload_indicator": {
            "position": "overlay on each photo thumbnail",
            "states": {
              "pending": "Clock icon, gray overlay",
              "uploading": "Spinner with percentage",
              "done": "Green checkmark",
              "failed": "Red X with retry button"
            }
          },
          "queue_summary": {
            "position": "header or status bar",
            "content": "X photos pending upload"
          }
        },
        "behavior": {
          "auto_compress": "Before storage, max 1920px, quality 0.7",
          "auto_sync": "When online, background upload",
          "retry": "Tap failed photo to retry"
        }
      }
    },
    {
      "id": "ROLE-FIELD-007a",
      "name": "Add GPS Location Fields to Job Schema",
      "description": "Add fields to record GPS on job start and complete",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Add startLocation JSONB field to jobAssignments (lat, lng, accuracy, timestamp)",
        "Add completeLocation JSONB field to jobAssignments",
        "Migration runs successfully",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_007A_COMPLETE"
    },
    {
      "id": "ROLE-FIELD-007b",
      "name": "Capture GPS on Job Start and Complete",
      "description": "Record GPS location when starting and completing jobs",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "startJob server function captures and stores GPS from client",
        "completeJob server function captures and stores GPS from client",
        "Location displayed on job detail page when available",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "ROLE-FIELD-007a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_007B_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Allow Location",
          "Start Job",
          "Complete Job"
        ],
        "accessibility": {
          "permission_request": "Clear explanation of why location needed",
          "fallback": "Allow job start without location (with warning)"
        },
        "layout": {
          "location_display": {
            "position": "job detail header",
            "content": "Map pin icon + address or coordinates",
            "tap_action": "Open in maps app"
          },
          "permission_prompt": {
            "timing": "On first job start attempt",
            "content": "Explain location used for verification"
          }
        },
        "behavior": {
          "auto_capture": "Get location on start/complete button tap",
          "accuracy_threshold": "Accept if accuracy < 100m",
          "timeout": "5 second location timeout, proceed without if fails"
        }
      }
    },
    {
      "id": "ROLE-FIELD-007c",
      "name": "Add Job Locations Map View",
      "description": "Map view showing job locations for the day",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Map route at /installer/map or toggle on schedule",
        "Map markers for each job location",
        "Marker color indicates job status (scheduled/in_progress/completed)",
        "Tap marker shows job card popup",
        "Navigate to job action from popup",
        "TypeScript compiles without errors"
      ],
      "dependencies": [
        "ROLE-FIELD-007b"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_007C_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "View Map",
          "Navigate to Job",
          "Switch to List"
        ],
        "accessibility": {
          "map_alternative": "List view always available",
          "marker_labels": "Job number visible on markers",
          "popup_accessibility": "Popup content focusable and readable"
        },
        "layout": {
          "map_view": {
            "type": "full-screen map",
            "toggle": "Tab or FAB to switch list/map",
            "current_location": "Blue dot for technician position"
          },
          "markers": {
            "scheduled": "Blue pin",
            "in_progress": "Orange pin with pulse",
            "completed": "Green pin with checkmark"
          },
          "job_popup": {
            "trigger": "Tap marker",
            "content": "Customer name, address, scheduled time",
            "actions": [
              "View Details",
              "Navigate (open maps app)"
            ]
          }
        },
        "interaction": {
          "center_on_me": "FAB to center map on current location",
          "fit_all": "Auto-zoom to show all day's jobs"
        }
      }
    },
    {
      "id": "ROLE-FIELD-008",
      "name": "Today View Enhancements",
      "description": "Add pull-to-refresh, next job highlighting, and navigation on cards",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Pull-to-refresh gesture triggers query refetch",
        "Next scheduled job has prominent styling (border, background)",
        "Navigate button on job cards (not just detail page)",
        "Jobs sorted by scheduled time",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_FIELD_008_COMPLETE",
      "ui_spec": {
        "target_role": "field-tech",
        "primary_device": "mobile",
        "priority_actions": [
          "Refresh",
          "Navigate",
          "Start Next Job"
        ],
        "accessibility": {
          "pull_to_refresh": "Also accessible via button for motor impairments",
          "next_job_highlight": "Border + background + 'Next' badge",
          "screen_reader_support": "Announce 'Next job' status"
        },
        "layout": {
          "pull_indicator": {
            "type": "spinner revealed on pull",
            "threshold": "60px pull to trigger",
            "feedback": "Haptic on trigger"
          },
          "next_job_card": {
            "styling": "Thicker border, subtle background tint, 'NEXT' badge",
            "position": "Always first in list when not started"
          },
          "job_card_actions": {
            "navigate_button": "Right side icon button, opens maps",
            "swipe_action": "Swipe right to start (existing)"
          }
        },
        "interaction": {
          "pull_threshold": "60px",
          "debounce": "500ms between refreshes",
          "loading_state": "Skeleton cards during refresh"
        }
      }
    }
  ],
  "success_criteria": [
    "Field techs can work offline",
    "Job completion from mobile < 2 minutes",
    "Photos document work easily",
    "Time tracking accurate",
    "npm run typecheck passes"
  ],
  "out_of_scope": [
    "Native mobile apps",
    "Push notifications (PWA)",
    "Real-time location tracking"
  ],
  "pattern_references": [
    {
      "file": "_Initiation/_meta/patterns/testing-standards.md",
      "applies_to": "all stories",
      "reason": "All stories must follow testing standards"
    },
    {
      "file": "_Initiation/_meta/patterns/ux-3-click-rule.md",
      "applies_to": "ui layer stories",
      "reason": "UI must comply with 3-click rule"
    },
    {
      "file": "_Initiation/_meta/patterns/performance-benchmarks.md",
      "applies_to": "server and ui stories",
      "reason": "Must meet response time targets"
    },
    {
      "file": "_Initiation/_meta/patterns/error-recovery.md",
      "applies_to": "offline sync stories",
      "reason": "Offline conflicts must follow error recovery patterns"
    }
  ]
}
