{
  "id": "ROLE-SALES",
  "name": "Sales Role Optimization",
  "description": "Optimized experience for Sales/Account Managers. Focus on fast quote creation (<5 min), customer 360 views, and pipeline visibility.",
  "created": "2026-01-09",
  "priority": 1,
  "phase": "role",
  "persona": "Sales / Account Manager",
  "dependencies": {
    "phase": "Role",
    "executionOrder": 6,
    "schemaRequired": [
      {
        "table": "users",
        "status": "EXISTS"
      },
      {
        "table": "customers",
        "status": "EXISTS"
      },
      {
        "table": "contacts",
        "status": "EXISTS"
      },
      {
        "table": "opportunities",
        "status": "EXISTS"
      },
      {
        "table": "products",
        "status": "EXISTS"
      }
    ],
    "prdDependencies": [
      {
        "prdId": "DOM-CUST",
        "status": "REQUIRED",
        "reason": "Sales role needs customer domain for 360 views and quick actions"
      },
      {
        "prdId": "DOM-PIPE",
        "status": "REQUIRED",
        "reason": "Sales role needs pipeline domain for opportunity management and forecasting"
      },
      {
        "prdId": "DOM-PROD",
        "status": "OPTIONAL",
        "reason": "Quote creation uses product catalog"
      }
    ],
    "enables": []
  },
  "ui_spec": {
    "target_role": "sales",
    "primary_device": "desktop",
    "priority_actions": [
      "Create Quote",
      "View Pipeline",
      "Log Follow-up"
    ],
    "accessibility": {
      "keyboard_navigation": true,
      "screen_reader_support": true,
      "color_contrast": "WCAG AA",
      "focus_indicators": "visible ring on all interactive elements"
    },
    "dashboard_layout": {
      "type": "multi-column",
      "columns": 3,
      "primary_section": "pipeline-overview",
      "widget_arrangement": [
        {
          "widget": "pipeline-summary",
          "position": "top-left",
          "span": 2
        },
        {
          "widget": "todays-followups",
          "position": "top-right",
          "span": 1
        },
        {
          "widget": "expiring-quotes",
          "position": "middle-left",
          "span": 1
        },
        {
          "widget": "forecast-chart",
          "position": "middle-center",
          "span": 2
        },
        {
          "widget": "recent-activity",
          "position": "bottom",
          "span": 3
        }
      ]
    },
    "quick_action_panel": {
      "position": "top-right sticky",
      "actions": [
        {
          "label": "New Quote",
          "icon": "file-plus",
          "shortcut": "Cmd+Q"
        },
        {
          "label": "New Customer",
          "icon": "user-plus",
          "shortcut": "Cmd+N"
        },
        {
          "label": "Log Call",
          "icon": "phone",
          "shortcut": "Cmd+L"
        }
      ]
    },
    "notification_preferences": {
      "quote_expiring": {
        "default": true,
        "channels": [
          "in-app",
          "email"
        ],
        "timing": "3 days before"
      },
      "follow_up_due": {
        "default": true,
        "channels": [
          "in-app"
        ],
        "timing": "morning of"
      },
      "deal_won": {
        "default": true,
        "channels": [
          "in-app"
        ],
        "timing": "immediate"
      },
      "deal_lost": {
        "default": true,
        "channels": [
          "in-app"
        ],
        "timing": "immediate"
      }
    }
  },
  "references": {
    "internal": [
      "memory-bank/VISION.md - User personas",
      "memory-bank/_meta/assumptions.md - Performance targets"
    ],
    "external": []
  },
  "current_state": {
    "implemented": [
      "Quote builder with line items and GST calculation",
      "Customer list and detail",
      "Pipeline Kanban view with drag-drop",
      "Global search with Cmd+K (command-palette.tsx)",
      "Customer hover preview cards with stats",
      "Pipeline metrics by stage",
      "Follow-up dialog for emails"
    ],
    "gaps": [
      "No guided quote wizard with timer",
      "No quote templates library",
      "No dedicated sales dashboard with forecasting",
      "No quote expiry alerts widget",
      "No follow-up date field on opportunities",
      "No win/loss analysis"
    ]
  },
  "stories": [
    {
      "id": "ROLE-SALES-001",
      "name": "Quote Creation Wizard (<5 min)",
      "description": "Step-by-step quote wizard wrapping existing quote-builder.tsx with timer",
      "priority": 1,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Wizard completes full quote in < 5 minutes (timed test)",
        "Steps: Customer -> Products -> Pricing -> Review -> Send",
        "Customer search/create inline (reuse existing selector)",
        "Product quick-add with qty (reuse existing quote-builder)",
        "Auto-calculate totals with GST (already implemented)",
        "Preview before send",
        "Timer visible during creation",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "ui"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_001_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "Next Step",
          "Add Product",
          "Send Quote"
        ],
        "accessibility": {
          "keyboard_navigation": "Full wizard navigation via Tab and Enter",
          "screen_reader_support": "Step announcements and progress updates",
          "focus_management": "Auto-focus first field of each step"
        },
        "layout": {
          "type": "stepper-wizard",
          "timer_position": "top-right corner, always visible",
          "progress_indicator": "horizontal stepper with step labels",
          "action_bar": "sticky bottom with Back/Next/Cancel buttons"
        },
        "responsive": {
          "desktop": "side-by-side preview panel",
          "tablet": "collapsible preview below form"
        }
      }
    },
    {
      "id": "ROLE-SALES-003",
      "name": "Customer 360 Quick Actions",
      "description": "Add quick action buttons to existing customer hover preview card",
      "priority": 2,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Quick action buttons added to EntityPreviewCard: Call, Email, New Quote",
        "Call opens tel: link",
        "Email opens mailto: link",
        "New Quote navigates to opportunity creation with customer pre-filled",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "ui"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_003_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "Call",
          "Email",
          "New Quote"
        ],
        "accessibility": {
          "keyboard_navigation": "Tab through action buttons",
          "screen_reader_support": "Action labels clearly announced",
          "focus_indicators": "Visible focus ring on hover card actions"
        },
        "layout": {
          "type": "hover-card",
          "action_bar": "bottom of card, horizontal button row",
          "button_style": "icon + label, min-height 36px"
        },
        "interaction": {
          "hover_delay": "200ms",
          "dismiss_on_click_outside": true,
          "persist_on_action_hover": true
        }
      }
    },
    {
      "id": "ROLE-SALES-004a",
      "name": "Sales Dashboard Route",
      "description": "Create /sales route as sales role landing page with pipeline focus",
      "priority": 3,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "New route /sales created",
        "Sales role users land on this page by default",
        "Shows pipeline summary widgets (value by stage)",
        "Quick filters: my deals, all deals, closing this month",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "ui"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_004a_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "Filter Deals",
          "View Pipeline",
          "Create Quote"
        ],
        "accessibility": {
          "keyboard_navigation": "Filter tabs accessible via arrow keys",
          "screen_reader_support": "Dashboard regions labeled with ARIA landmarks",
          "skip_links": "Skip to main content, skip to pipeline"
        },
        "layout": {
          "type": "dashboard-grid",
          "header": "Page title with quick filter toggle buttons",
          "main_area": "3-column grid on desktop, stack on mobile",
          "sidebar": "optional collapsed quick actions"
        },
        "navigation": {
          "default_landing": true,
          "breadcrumb": false,
          "back_navigation": "none (root page)"
        }
      }
    },
    {
      "id": "ROLE-SALES-004b",
      "name": "Forecasting Widgets",
      "description": "Add weighted pipeline widgets (after DOM-PIPE-001 complete)",
      "priority": 4,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Weighted pipeline total widget (value x probability)",
        "Forecast by month chart",
        "Aging opportunities highlight (time in stage)",
        "Trend comparison to previous period",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "ui"
      ],
      "dependencies": [
        "PIPE-FORECASTING-API"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_004b_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "View Forecast",
          "Drill into Month",
          "Compare Periods"
        ],
        "accessibility": {
          "chart_accessibility": "Data table alternative for screen readers",
          "keyboard_navigation": "Arrow keys navigate chart data points",
          "color_independence": "Patterns/shapes in addition to colors for trends"
        },
        "layout": {
          "type": "widget-card",
          "chart_type": "bar chart with trend line overlay",
          "data_display": "hover tooltips with exact values",
          "comparison_indicator": "up/down arrow with percentage change"
        },
        "interaction": {
          "drill_down": "Click month bar to filter pipeline",
          "period_toggle": "This Quarter / Last Quarter / YTD"
        }
      }
    },
    {
      "id": "ROLE-SALES-005a",
      "name": "Follow-up Date Schema",
      "description": "Add followUpDate field to opportunities schema",
      "priority": 5,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Add followUpDate column to opportunities table",
        "Migration runs successfully",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "schema"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_005a_COMPLETE"
    },
    {
      "id": "ROLE-SALES-005b",
      "name": "Follow-up Server Functions",
      "description": "Server functions for follow-up queries and notifications",
      "priority": 6,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "getTodaysFollowUps server function",
        "getOverdueFollowUps server function",
        "updateFollowUpDate server function",
        "logFollowUpOutcome server function",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "server"
      ],
      "dependencies": [
        "ROLE-SALES-005a"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_005b_COMPLETE"
    },
    {
      "id": "ROLE-SALES-005c",
      "name": "Follow-up Dashboard Widget and UI",
      "description": "Today's follow-ups widget and opportunity form updates",
      "priority": 7,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Today's follow-ups widget on sales dashboard",
        "Set follow-up date on opportunity form",
        "Snooze/complete actions on follow-up items",
        "Overdue follow-ups highlighted in red",
        "Log follow-up outcome dialog",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "ui"
      ],
      "dependencies": [
        "ROLE-SALES-005b"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_005c_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "Complete Follow-up",
          "Snooze",
          "Log Outcome"
        ],
        "accessibility": {
          "color_independence": "Overdue items have icon indicator in addition to red color",
          "keyboard_navigation": "Tab through follow-up items, Enter to expand actions",
          "screen_reader_support": "Announce overdue status and due date"
        },
        "layout": {
          "type": "list-widget",
          "item_layout": "Customer name, opportunity title, due date, action buttons",
          "overdue_styling": "red border-left, warning icon, bold date",
          "empty_state": "Celebration message when no follow-ups due"
        },
        "interaction": {
          "snooze_options": [
            "Tomorrow",
            "Next Week",
            "Custom Date"
          ],
          "complete_action": "Opens outcome dialog",
          "click_item": "Navigate to opportunity detail"
        }
      }
    },
    {
      "id": "ROLE-SALES-006",
      "name": "Quote Templates Library",
      "description": "Create and apply templates for common quote types",
      "priority": 8,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Template library accessible from quote wizard",
        "Templates include: products, default pricing, notes",
        "Create template from existing quote",
        "Apply template as starting point",
        "Templates organized by category",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "schema",
        "server",
        "ui"
      ],
      "dependencies": [
        "ROLE-SALES-001"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_006_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "Select Template",
          "Create from Quote",
          "Edit Template"
        ],
        "accessibility": {
          "keyboard_navigation": "Grid navigation for template cards",
          "screen_reader_support": "Template name, category, and product count announced",
          "focus_management": "Focus returns to trigger after dialog close"
        },
        "layout": {
          "type": "modal-grid",
          "template_card": "Name, category badge, product count, last used date",
          "categories": "sidebar filter or tab navigation",
          "preview_panel": "right side showing template contents"
        },
        "interaction": {
          "double_click": "Apply template immediately",
          "single_click": "Select and show preview",
          "apply_button": "Primary action in footer"
        }
      }
    },
    {
      "id": "ROLE-SALES-007",
      "name": "Quote Expiry Alerts Widget",
      "description": "Dashboard widget for expiring quotes with quick actions",
      "priority": 9,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Dashboard widget: expiring this week",
        "Notification 3 days before expiry",
        "Expired quotes visually flagged (already partial)",
        "Link to extend expiry (uses DOM-PIPE-004 when available)",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "ui"
      ],
      "dependencies": [],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_007_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "View Quote",
          "Extend Expiry",
          "Send Reminder"
        ],
        "accessibility": {
          "urgency_indicators": "Icon and text label for expiry urgency, not just color",
          "keyboard_navigation": "Tab through expiring quotes list",
          "screen_reader_support": "Days until expiry announced with each item"
        },
        "layout": {
          "type": "alert-widget",
          "urgency_zones": {
            "critical": "Expires today or expired (red)",
            "warning": "Expires in 1-3 days (amber)",
            "info": "Expires in 4-7 days (blue)"
          },
          "item_display": "Customer, quote value, expiry date, days remaining"
        },
        "interaction": {
          "extend_action": "Opens date picker dialog",
          "reminder_action": "Sends follow-up email to customer"
        }
      }
    },
    {
      "id": "ROLE-SALES-008",
      "name": "Win/Loss Analysis View",
      "description": "Analyze conversion patterns and loss reasons",
      "priority": 10,
      "status": "pending",
      "passes": false,
      "acceptance_criteria": [
        "Win/loss report page",
        "Win rate by: product, customer type, value range",
        "Loss reasons breakdown (requires DOM-PIPE-005)",
        "Average sales cycle duration",
        "Comparison to previous periods",
        "TypeScript compiles without errors"
      ],
      "layers": [
        "server",
        "ui"
      ],
      "dependencies": [
        "PIPE-WINLOSS-API"
      ],
      "estimated_iterations": 2,
      "completion_promise": "ROLE_SALES_008_COMPLETE",
      "ui_spec": {
        "target_role": "sales",
        "primary_device": "desktop",
        "priority_actions": [
          "Filter by Period",
          "Drill into Segment",
          "Export Report"
        ],
        "accessibility": {
          "chart_accessibility": "All charts have data table alternatives",
          "keyboard_navigation": "Tab through filter controls and chart segments",
          "color_independence": "Patterns differentiate win/loss segments"
        },
        "layout": {
          "type": "report-page",
          "header": "Date range selector, segment filters",
          "main_area": "2x2 grid of analysis charts",
          "charts": [
            "Win rate funnel by stage",
            "Loss reasons pie/bar chart",
            "Win rate by segment (product/customer/value)",
            "Sales cycle duration histogram"
          ]
        },
        "interaction": {
          "chart_click": "Drills down to filtered opportunity list",
          "export_options": [
            "PDF",
            "CSV",
            "PNG charts"
          ]
        }
      }
    }
  ],
  "success_criteria": [
    "Quote creation < 5 minutes (timed)",
    "Pipeline visibility aids forecasting",
    "Follow-ups never missed",
    "Templates speed up common quotes",
    "npm run typecheck passes"
  ],
  "out_of_scope": [
    "CPQ engine",
    "Territory management",
    "Commission tracking"
  ],
  "pattern_references": [
    {
      "file": "_Initiation/_meta/patterns/testing-standards.md",
      "applies_to": "all stories",
      "reason": "All stories must follow testing standards"
    },
    {
      "file": "_Initiation/_meta/patterns/ux-3-click-rule.md",
      "applies_to": "ui layer stories",
      "reason": "UI must comply with 3-click rule"
    },
    {
      "file": "_Initiation/_meta/patterns/performance-benchmarks.md",
      "applies_to": "server and ui stories",
      "reason": "Must meet response time targets"
    }
  ]
}
