{
  "id": "INT-ERROR-TRACKING",
  "name": "Error Tracking Integration",
  "description": "Sentry integration for error monitoring, performance tracking, and error boundaries. Provides visibility into production issues.",
  "created": "2026-01-13",
  "updated": "2026-01-13",
  "priority": 1,
  "phase": "integration",
  "version": "1.0",
  "business_value": {
    "reliability": true,
    "debugging": true,
    "user_experience": true,
    "description": "Enables proactive error detection and faster debugging of production issues"
  },
  "system_requirements": {
    "infrastructure": {
      "sentry": {
        "description": "Error and performance monitoring via Sentry",
        "packages": ["@sentry/react", "@sentry/node"],
        "features": ["Error tracking", "Performance monitoring", "Session replay"],
        "required": true
      }
    },
    "environment_variables": {
      "required": ["SENTRY_DSN"],
      "optional": ["SENTRY_ENVIRONMENT", "SENTRY_RELEASE"]
    }
  },
  "stories": [
    {
      "id": "ERR-001",
      "name": "Sentry Server Setup",
      "description": "Configure Sentry SDK for server-side error tracking",
      "type": "server",
      "acceptance_criteria": [
        "File src/lib/monitoring/sentry-server.ts initializes Sentry.init() with SENTRY_DSN",
        "Environment set from SENTRY_ENVIRONMENT (defaults to 'development')",
        "Release set from SENTRY_RELEASE or package.json version",
        "tracesSampleRate set to 0.1 (10% of transactions)",
        "Integrations include: Http, Express (if applicable)",
        "beforeSend filters out non-error warnings",
        "File imported in server entry point (src/entry-server.tsx or equivalent)",
        "Graceful no-op if SENTRY_DSN not set (dev environment)",
        "bun run typecheck passes"
      ],
      "files_to_modify": [
        "src/lib/monitoring/sentry-server.ts",
        "src/lib/monitoring/index.ts",
        "src/entry-server.tsx"
      ],
      "dependencies": [],
      "completion_promise": "ERR_001_COMPLETE",
      "estimated_iterations": 2,
      "status": "pending"
    },
    {
      "id": "ERR-002",
      "name": "Sentry Client Setup",
      "description": "Configure Sentry SDK for client-side error tracking",
      "type": "ui",
      "acceptance_criteria": [
        "File src/lib/monitoring/sentry-client.ts initializes Sentry.init() for browser",
        "Uses @sentry/react package",
        "tracesSampleRate set to 0.1",
        "replaysSessionSampleRate set to 0.1 (10% session replay)",
        "replaysOnErrorSampleRate set to 1.0 (100% replay on error)",
        "Integrations include: BrowserTracing, Replay",
        "Sets user context when available: Sentry.setUser({ id, email })",
        "File imported in client entry point (src/entry-client.tsx)",
        "Graceful no-op if SENTRY_DSN not set",
        "bun run typecheck passes"
      ],
      "files_to_modify": [
        "src/lib/monitoring/sentry-client.ts",
        "src/entry-client.tsx"
      ],
      "dependencies": [],
      "completion_promise": "ERR_002_COMPLETE",
      "estimated_iterations": 2,
      "status": "pending"
    },
    {
      "id": "ERR-003",
      "name": "Error Boundary Component",
      "description": "Create React error boundary with Sentry reporting",
      "type": "ui",
      "acceptance_criteria": [
        "File src/components/shared/error-boundary.tsx exports ErrorBoundary component",
        "Uses Sentry.ErrorBoundary from @sentry/react as wrapper",
        "Props: { children, fallback?: ReactNode }",
        "Default fallback shows: AlertTriangle icon, 'Something went wrong', 'Try refreshing the page' text, 'Report Issue' button",
        "Report Issue button calls Sentry.showReportDialog()",
        "Includes eventId display for support reference",
        "beforeCapture callback adds component stack to Sentry scope",
        "Exported from src/components/shared/index.ts",
        "ARIA: role='alert' on fallback",
        "bun run typecheck passes"
      ],
      "files_to_modify": [
        "src/components/shared/error-boundary.tsx",
        "src/components/shared/index.ts"
      ],
      "dependencies": ["ERR-002"],
      "completion_promise": "ERR_003_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    },
    {
      "id": "ERR-004",
      "name": "App Error Boundary Integration",
      "description": "Wrap app with error boundary and add route-level boundaries",
      "type": "ui",
      "acceptance_criteria": [
        "Root layout wraps children with ErrorBoundary component",
        "Each route group (_authenticated, _public) has its own ErrorBoundary",
        "Route-level boundaries have contextual fallback messages",
        "Dashboard error: 'Dashboard failed to load'",
        "Settings error: 'Settings failed to load'",
        "404 page uses custom NotFound component (not error boundary)",
        "Error boundaries reset on navigation via useLocation() key",
        "Critical routes (login, payment) have extra resilient error handling",
        "bun run typecheck passes"
      ],
      "files_to_modify": [
        "src/routes/__root.tsx",
        "src/routes/_authenticated.tsx",
        "src/components/shared/route-error-boundary.tsx"
      ],
      "dependencies": ["ERR-003"],
      "completion_promise": "ERR_004_COMPLETE",
      "estimated_iterations": 3,
      "status": "pending"
    }
  ],
  "cross_prd_dependencies": {
    "note": "Integrates with app shell for root-level error handling",
    "required_prds": ["FOUND-SHARED", "FOUND-APPSHELL"],
    "rationale": "FOUND-SHARED for UI primitives; FOUND-APPSHELL for root layout integration"
  },
  "success_criteria": [
    "Sentry initialized on both server and client",
    "Errors automatically reported to Sentry",
    "User context attached to error reports",
    "Error boundaries catch React rendering errors",
    "Session replay captures error context",
    "TypeScript compiles with no errors",
    "All 4 stories have testable acceptance criteria"
  ],
  "out_of_scope": [
    "Custom error dashboard UI",
    "Error alerting configuration (use Sentry dashboard)",
    "Performance monitoring dashboard",
    "Source map uploads (configure in CI/CD)"
  ],
  "migration_notes": {
    "sentry_setup": "Create Sentry project, obtain DSN, configure alerts in Sentry dashboard"
  }
}
